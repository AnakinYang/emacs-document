<!DOCTYPE html>
<html lang="en">
<head>
  <title>为程序员和计算机科学从业者所写的emacs-calc教程 - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <!-- <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="https://lujun9972.github.io/emacs-document/">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="https://lujun9972.github.io/emacs-document/years/">Years</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/authors/">Authors</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/tags/">Tags</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">为程序员和计算机科学从业者所写的emacs-calc教程</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2871237">1. Introduction</a>
<ul>
<li><a href="#org6ae912a">1.1. Why Emacs?</a></li>
</ul>
</li>
<li><a href="#orga943175">2. Numeral System</a>
<ul>
<li><a href="#orge322e50">2.1. Enter Numbers with different Base</a></li>
<li><a href="#org217e122">2.2. Change Radix Mode</a></li>
</ul>
</li>
<li><a href="#org17fa347">3. Binary Number Operation</a></li>
<li><a href="#orgbe1ebc2">4. Units</a></li>
<li><a href="#org8ca072f">5. Conclusion</a></li>
</ul>
</div>
</div>

<div id="outline-container-org2871237" class="outline-2">
<h2 id="org2871237"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
作为信息工程专业的研究生兼程序员,我常常需要计算内存地址,转换数据传输速率,进行二进制数与十六进制数的互转. 这些工作都可以由计算机来完成. 我是个Emacs nerd,但是我通常是使用<a href="https://duckduckgo.com/">duckduckgo</a> 和 <a href="http://www.wolframalpha.com/">wolfram alpha</a> 来进行这些计算的. 
这些工具都挺不错的,但是过程比较繁琐,尤其是wlffram,有时候运行起来非常缓慢. 因此,我仔细研究了一下Emacs Calc以寻找在Emacs完成这些计算的方法.
</p>
</div>

<div id="outline-container-org6ae912a" class="outline-3">
<h3 id="org6ae912a"><span class="section-number-3">1.1</span> Why Emacs?</h3>
<div class="outline-text-3" id="text-1-1">
<p>
我不明白为何会有此问. 我用Emacs编程,我用org-mode来记录我实验的进程和想法. 因此很自然的我会想用Emacs来完成这项任务. 此外,使用Emacs Calc有三大优势:
</p>

<ol class="org-ol">
<li>Calc与Emacs本身一样,都是开源而可扩展的. 你无需等待下一个版本的发布. 若你足够的好奇,你可以完全搞明白Calc是怎么实现的. 而且,与Emacs其他mode一样,你可以以多种方式扩展Calc. 我将会在Units这章展示如何为Calc扩展更多的支持单位.</li>
<li>Calc可以支持超复杂的计算. 它能够处理向量和矩阵,有理数,复数的计算. Karathik 将Calc比作<a href="https://vimeo.com/14742598">穷人的mathematica</a>.</li>
<li>若你对快捷键和<a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">RPN (逆波兰表示法)</a>  熟悉的话,你的效率会很高. 研究<a href="http://www.sciencedirect.com/science/article/pii/0003687080901143">表明</a> RPN在计算速度和精度上都要比代数表示法更好.</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orga943175" class="outline-2">
<h2 id="orga943175"><span class="section-number-2">2</span> Numeral System</h2>
<div class="outline-text-2" id="text-2">
<p>
我在大学里学到的一个令人吃惊的真相是: 数值的值与它的表示是相分离的. 比如,数值5,可以被表示为5,V,five或101,但它的值总是不变的. 也就是说,数值5总是存在的,即使不存在一个系统来表示它.
然而,作为一名程序员和计算机科学家,你总要面对数值的不同表现形式,可能是二进制的,可能是十六进制的,也可能是八进程的. 那么,就让我们来看一下Calc在这方面能够做些什么吧.
</p>
</div>

<div id="outline-container-orge322e50" class="outline-3">
<h3 id="orge322e50"><span class="section-number-3">2.1</span> Enter Numbers with different Base</h3>
<div class="outline-text-3" id="text-2-1">
<p>
若你在Calc输入一个数值,该数值会以当前基数的基数计数法显示(关于如何更改当前基,我会在下一章说明). 默认情况下,基数为10进制表示法(base 10). 若你想以不同基数表示的方式输入数值,你需要按格式 <code>&lt;number_of_base&gt;#number</code> 输入. 
下面是一些例子:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Description</th>
<th scope="col" class="org-right">Emacs Calc</th>
<th scope="col" class="org-right">Base 10</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Binary</td>
<td class="org-right">2#11110101</td>
<td class="org-right">245</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Octal</td>
<td class="org-right">8#27</td>
<td class="org-right">23</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Hexadecimal</td>
<td class="org-right">16#FFFF</td>
<td class="org-right">65535</td>
</tr>
</tbody>
</table>

<p>
很简单对不对! 然而,二进制数有两种表示方式:有符号整型和无符号整型. 让我们假设有w个bit,则其无符号整型的表示范围为0到2^w-1,而有符号整型的表示范围为-2^(w-1) 到 2^(w-1)-1. 后一种表示方法称为二进制补码. 
默认情况下,Calc使用32个bit的字长来表示数值, 但你可以使用 <code>b w (calc-word-size)</code> 来改变字长. 你可以通过输入两次#的方式直接输入二进制补码,比如在字长为8的情况下输入 <code>2##11110101</code> 则其值为-11而不是245. 
而且我前面也提过的,所有输入的数值都会被自动转换成以当前基数来表示.
</p>
</div>
</div>

<div id="outline-container-org217e122" class="outline-3">
<h3 id="org217e122"><span class="section-number-3">2.2</span> Change Radix Mode</h3>
<div class="outline-text-3" id="text-2-2">
<p>
也就是说,你输入的数字和显示的数字是不一样的. 要修改显示数字的方式,你需要修改当前的基数,方法是按下 <code>d r (calc-radix)</code> 然后再输入基数(支持的范围为2-36). 当然,对于一些常见的基数,也有更快捷的快捷键进行修改:
</p>

<p>
<del>-----------------------------------</del>                                     
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Shortcut</th>
<th scope="col" class="org-left">Representation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">d 2</td>
<td class="org-left">Binary</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">O d 2</td>
<td class="org-left">Two-complement Binary</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">d 6</td>
<td class="org-left">Hexadecimal</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">d 8</td>
<td class="org-left">Octal</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">d 0</td>
<td class="org-left">Decimal</td>
</tr>
</tbody>
</table>
<p>
<del>-----------------------------------</del>                                     
</p>

<p>
这使得输入任意表达方式的数字都很方便,而且可以很方便的将之转换成其他基数的表示方式. 为了更好的比较以二进制形式表示的数字,可以按下 <code>d z (calc-leading-zeros)</code> 来在开启leading zero功能,该功能会在较短的数字前面补上0. 
上面说的都是关于数字的表示方面的内容,下面让我们来看看如何操作这些二进制数.
</p>
</div>
</div>
</div>

<div id="outline-container-org17fa347" class="outline-2">
<h2 id="org17fa347"><span class="section-number-2">3</span> Binary Number Operation</h2>
<div class="outline-text-2" id="text-3">
<p>
Calc提供了一个函数 <code>b c (calc-clip)</code> 来现符号/无符号整型的切换. This function clips the current number by reducing it by 2^w.
若字长为8bits,则你将是将符号整型转换为非符号整型,若字长为-8bits,则你是将非符号整型转换为符号整型. 下面是个例子:
</p>


<div class="figure">
<p><img src="https://florian.adamsky.it/assets/emacs-calc-binary-clip.gif" alt="emacs-calc-binary-clip.gif" />
</p>
</div>

<p>
字长的符号也会影响到下面二进制操作的结果:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">输入</th>
<th scope="col" class="org-left">Calc函数</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">b a</td>
<td class="org-left">(calc-and)</td>
<td class="org-left">Bitwise AND</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">b o</td>
<td class="org-left">(calc-or)</td>
<td class="org-left">Bitwise OR</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">b x</td>
<td class="org-left">(calc-xor)</td>
<td class="org-left">Bitwise XOR</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">b n</td>
<td class="org-left">(calc-not)</td>
<td class="org-left">Bitwise NOT</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">b d</td>
<td class="org-left">(calc-diff)</td>
<td class="org-left">Bitwise difference</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">b r</td>
<td class="org-left">(calc-rshift-binary)</td>
<td class="org-left">Bitwise right shift by 1 bit</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">b l</td>
<td class="org-left">(calc-lshift-binary)</td>
<td class="org-left">Bitwise left shift by 1 bit</td>
</tr>
</tbody>
</table>

<p>
你是否算过424242的二进制表达式中有多少个1呢? 没算过? 让我来告诉你怎样用Calc来得出答案吧. 先输入 <code>424242</code> 让它入栈,然后按下 <code>b u</code> 将该数字拆到集合中,然后按下 <code>v #</code> 算出1的个数,结果是10.
</p>
</div>
</div>

<div id="outline-container-orgbe1ebc2" class="outline-2">
<h2 id="orgbe1ebc2"><span class="section-number-2">4</span> Units</h2>
<div class="outline-text-2" id="text-4">
<p>
Calc能够理解单位,并且预置了许多单位. 你可以按下 <code>u v (calc-enter-units-table)</code> 来看看Cacl预置了哪些单位. 要将带单位的数字入栈,需要输入 <code>m a (calc-algebraic-entry)</code> 然后再输入带单位的数字,例如 <code>23m</code>. 
假设你想将单位转换为cm,只需要输入 <code>u c (calc-convert-units)</code> 然后再输入cm. 你甚至可以带单位进行计算. 你可以试试将23m和42cm累加起来. Calc会显示结果为 <code>23 m + 42 cm</code>, 若你再按下 <code>u s (calc-simplify-units)</code>,结果显示为23.42m
</p>

<p>
但是很可惜,如果你仔细检查预定义的单位会发现并没有数字信息方面的单位. 但是不要紧,我们用的可是Emacs,我们可以按自己喜欢更改任何东西. Calc中有个教 <code>math-additional-units</code> 的变量可以用来添加新的单位. 
该变量的格式必须准照 <code>math-standard-units</code> 那样. 下面这段Emacs Lisp代码能够为Calc添加数字信息单位:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> math-additional-units
      '<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>bit    nil           <span style="color: #2d9574;">"Bit"</span><span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span>byte   <span style="color: #2d9574;">"8 * bit"</span>     <span style="color: #2d9574;">"Byte"</span><span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span>bps    <span style="color: #2d9574;">"bit / s"</span>     <span style="color: #2d9574;">"Bit per second"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
      math-units-table nil<span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
该代码片段还设置 <code>math-units-table</code> 为nil,以重建 <code>the combined units table</code>. 代码片段中无需定义以 (K)ilo, (M)ega or (G)iga开头的单位,因为Calc会自动处理这些前缀.
下面这个gif展示了如何使用这些单位:
</p>


<div class="figure">
<p><img src="https://florian.adamsky.it/assets/emacs-calc-units-convert.gif" alt="emacs-calc-units-convert.gif" />
</p>
</div>
</div>
</div>

<div id="outline-container-org8ca072f" class="outline-2">
<h2 id="org8ca072f"><span class="section-number-2">5</span> Conclusion</h2>
<div class="outline-text-2" id="text-5">
<p>
Emacs Calc十分强大,你可以使用 <code>C-x * c</code> 退出Calc. 这篇文章我只关注那些对程序员和计算机科学家可能有用的特性.<a href="https://www.gnu.org/software/emacs/manual/html_node/calc/index.html">它的manual也很不错</a>, 推荐阅读.
</p>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2016-07-07</span>
            <span title="last modification date" class="post-info">2016-07-07</span>
            <span title="tags" class="post-info">:N/A:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a></span>
        </div>
    <script src="https://lujun9972.github.io/emacs-document/media/js/jquery-2.1.3.min.js"></script>
    <script src="https://lujun9972.github.io/emacs-document/media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="https://lujun9972.github.io/emacs-document/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="https://lujun9972.github.io/emacs-document//instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
