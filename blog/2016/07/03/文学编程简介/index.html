<!DOCTYPE html>
<html lang="en">
<head>
  <title>文学编程简介 - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #ds-thread #ds-reset .ds-comment-body p a {color: #ff0;}
   #ds-thread #ds-reset .ds-comment-body p a:hover {color: #0ff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/main.css" type="text/css"/>
  <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/comment.css" type="text/css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="https://lujun9972.github.io/emacs-document/">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <div class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" fill="#ffff00"/>
          <path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" fill="#ffff00"/>
          <path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" fill="#ffff00"/>
        </svg>
      </div>
      <ul class="trigger">
        <li><a href="https://lujun9972.github.io/emacs-document/years/">Years</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/authors/">Authors</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/tags/">Tags</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">文学编程简介</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1e58ef7">1. 必要条件</a></li>
<li><a href="#orgdf0d5b4">2. 背景知识</a>
<ul>
<li><a href="#orgf2d87a2">2.1. 为什么使用文学编程?</a></li>
</ul>
</li>
<li><a href="#org8cea01c">3. 为什么使用Org?</a></li>
<li><a href="#org49d7d07">4. 使用Org有什么优势?</a></li>
<li><a href="#orgf6e6847">5. 警告</a></li>
<li><a href="#org049d866">6. 导出文档</a></li>
<li><a href="#orgdf65c02">7. 基础知识</a>
<ul>
<li><a href="#orge9a2d7a">7.1. 快捷方式</a></li>
<li><a href="#org15cfaee">7.2. 推荐配置</a></li>
</ul>
</li>
<li><a href="#org6499edf">8. 支持的语言</a>
<ul>
<li><a href="#org5553f03">8.1. Ruby案例</a></li>
<li><a href="#org1518cbc">8.2. Python案例</a></li>
<li><a href="#org16c5928">8.3. shell案例</a></li>
<li><a href="#orgd57abb6">8.4. 其他语言</a></li>
</ul>
</li>
<li><a href="#org1a2e9e6">9. 代码块设置</a>
<ul>
<li><a href="#org3593998">9.1. 例子: dir参数</a></li>
<li><a href="#org59204f6">9.2. 设置头参数的位置</a></li>
<li><a href="#orgfd739b8">9.3. 太多参数了?</a></li>
<li><a href="#orgef7e0e1">9.4. 设置某一标题下面所有代码块的默认头参数</a></li>
<li><a href="#orgb1dd849">9.5. 指定特定语言的默认头参数</a></li>
<li><a href="#orgdf23d7d">9.6. 为文档内的所有代码块设置默认参数</a></li>
</ul>
</li>
<li><a href="#org0ecf340">10. 头参数的类型</a></li>
<li><a href="#org01c2c28">11. 执行类参数</a>
<ul>
<li><a href="#org844baa2">11.1. results参数</a></li>
<li><a href="#orgb87783b">11.2. 影响输出格式的结果</a>
<ul>
<li><a href="#org5eae918">11.2.1. 输出成列表</a></li>
<li><a href="#org0ed037e">11.2.2. 原样输出</a></li>
<li><a href="#org923876c">11.2.3. Session</a></li>
</ul>
</li>
<li><a href="#orgd76277e">11.3. 将结果写入到文件中</a></li>
<li><a href="#org81bb13c">11.4. 导出</a></li>
</ul>
</li>
<li><a href="#orgbfc299c">12. 文学编程</a>
<ul>
<li><a href="#org04256b5">12.1. Tangling</a></li>
</ul>
</li>
<li><a href="#org52a2f3a">13. 注释</a>
<ul>
<li><a href="#org0e043ef">13.1. Shebang</a></li>
<li><a href="#org94ebccc">13.2. Noweb</a>
<ul>
<li><a href="#orgdaa8990">13.2.1. 关于Noweb的警告</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd1c8ead">14. 变量</a>
<ul>
<li><a href="#org3dec68e">14.1. 将代码块的结果作为值传递给另一个代码块</a></li>
<li><a href="#org89cc1bf">14.2. 表格形式的变量数据</a></li>
<li><a href="#org6079818">14.3. 表格分片</a></li>
<li><a href="#org59737c4">14.4. Reprocessing</a></li>
</ul>
</li>
<li><a href="#org295f663">15. 保持代码块的整洁</a>
<ul>
<li><a href="#org39839a8">15.1. 设置环境</a></li>
<li><a href="#org06e0563">15.2. Using RVM</a></li>
<li><a href="#org3e61f72">15.3. 对结果进行修正</a></li>
</ul>
</li>
<li><a href="#orgd95601b">16. 其他特性</a>
<ul>
<li><a href="#org75fd362">16.1. 调用代码块</a></li>
<li><a href="#org54c4f11">16.2. 嵌入运算结果</a></li>
<li><a href="#org9689651">16.3. Library of Babel</a></li>
</ul>
</li>
<li><a href="#org9b0c727">17. 专用语言</a>
<ul>
<li><a href="#org8283f0c">17.1. SQL</a></li>
<li><a href="#org70a8ecc">17.2. Graphviz</a></li>
<li><a href="#orgb6ae167">17.3. PlantUML</a></li>
<li><a href="#org2106828">17.4. Calc</a></li>
</ul>
</li>
<li><a href="#org7b98ea1">18. 总结</a></li>
</ul>
</div>
</div>
<p>
欢迎来到文学编程的世界! 本文会简单介绍一下如何使用org-mode进行文学编程
</p>

<p>
本文的内容来源于PDX Emacs Hackers举办的研讨会, 但是考虑到很少人能够现场参加该研讨会,因此我决定把它写成一片指南. 我假设你已经有了一定的<a href="http://howardism.org/Technical/Emacs/getting-started.html">Emacs基础</a> 并且对<a href="http://howardism.org/Technical/Emacs/learning-org-mode.html">org-mode也比较熟悉</a> ,至少知道如何导出文档.
</p>

<p>
众所周知,Org的功能太多了, 它具有在一个文档中编写,执行和连接代码块的能力,这种能力十分强大, 要把这些功能都写成文档是件让人觉的恐怖的任务. 我希望这份指南能开个好头, 若你发现我遗漏了什么,请<a href="http://howardism.org/formmail/mail?to=howardism">告之</a>.
</p>

<p>
<b>警告</b> :下面的例子都写得很蹩脚.
</p>

<div id="outline-container-org1e58ef7" class="outline-2">
<h2 id="org1e58ef7"><span class="section-number-2">1</span> 必要条件</h2>
<div class="outline-text-2" id="text-1">
<p>
本文基于<a href="http://orgmode.org">org-mode</a> v8.2.10(或更新). 由于Emacs已经内置了org, 你需要通过 <code>C-h v &lt;RET&gt; org-version</code> 来看所使用的org是否符合要求,以保障本指南例子能够正确运行(大多数的例子应该没问题,但是也不好说…).
</p>

<p>
若你的org版本太旧,请运行下面这段代码:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">when</span> <span style="color: #bc6ec5;">(</span>&gt;= emacs-major-version <span style="color: #a45bad;">24</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">require</span> '<span style="color: #a45bad;">package</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>add-to-list 'package-archives
               '<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"org"</span> . <span style="color: #2d9574;">"http://orgmode.org/elpa/"</span><span style="color: #2d9574;">)</span>
               t<span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>package-initialize<span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>package-refresh-contents<span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>package-install <span style="color: #2d9574;">"org"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
然后应该就装上了最新的org了. 此外你还需要安装 <a href="http://orgmode.org/worg/org-contrib/">org-plus-contrib</a>.
</p>

<p>
在这篇指南中,我会向你展示多种语言的接口,但这也意味着你需要在本地安装大量的解释器,你至少需要安装下面几个解释器:
</p>

<ul class="org-ul">
<li>Shell (很抱歉,对于Windows用户来说,这一点恐怕比较难实现)</li>
<li>Python</li>
<li>Ruby</li>
</ul>

<p>
当然,你是个聪明人,把这些例子修改成你所使用的语言应该是很容易的.
</p>
</div>
</div>

<div id="outline-container-orgdf0d5b4" class="outline-2">
<h2 id="orgdf0d5b4"><span class="section-number-2">2</span> 背景知识</h2>
<div class="outline-text-2" id="text-2">
<p>
在我们开始学习使用<a href="http://orgmode.org">org-mode</a> 进行文学编程之前,我先简单介绍一下文学编程吧.
</p>
</div>

<div id="outline-container-orgf2d87a2" class="outline-3">
<h3 id="orgf2d87a2"><span class="section-number-3">2.1</span> 为什么使用文学编程?</h3>
<div class="outline-text-3" id="text-2-1">
<p>
文学编程最初是由Donald Knuth于20世纪80年代提出来的,旨在加强团队成员中的交流. 如<a href="http://www.brainyquote.com/quotes/authors/d/donald_knuth.html#0RwBBIoWjqiKPb2Y.99">Donald Knuth</a> 所说过的
</p>

<blockquote>
<p>
让我们改变针对程序结构的传统看法吧. 不要把我们的任务看成是向计算机描述怎么去作,而是向其他人解释我们想让计算机做什么.
</p>
</blockquote>

<p>
文学编程希望能做到写得程序适于人阅读,文档描述能遵循问题逻辑的顺序,同时不受制于编程语言的缺陷. 下面是一份文学编程的例子,对人来说,这是份可阅读的文档,同时它还是源代码文件:
</p>


<div class="figure">
<p><img src="http://howardism.org/Technical/Emacs/literate-programming-tangling.png" alt="literate-programming-tangling.png" />
</p>
</div>

<p>
其背后的思想是反转注释与代码之间的关系,以前是代码中点缀着些注释,现在则是在文档中内嵌一些代码.
</p>

<p>
由于从文学编程文档中抽取出来的源代码与直接编写的源代码无异,因此这一做法并不需要现有的编程环境做出什么改变.(although it is used, to various degrees, in niche circles).
</p>
</div>
</div>
</div>

<div id="outline-container-org8cea01c" class="outline-2">
<h2 id="org8cea01c"><span class="section-number-2">3</span> 为什么使用Org?</h2>
<div class="outline-text-2" id="text-3">
<p>
Knuth最开始认为文学编程只需要使用最简单功能的编辑器就行, 因为他只是谢了noweb程序来创建文学编程文档并从中抽取源代码.
</p>

<p>
依我的观点,文学编程必须依赖编辑器的帮助,<a href="http://ipython.org/notebook.html">iPython’s notebook</a>就是个例子. 但是我认为文档内容应该以可读文本的方式存储,而不是存储为JSON格式的文件. 就像 <a href="http://transcriptvids.com/v/oJTwQvgfgMM.html">Carsten Dominik</a> 说过的:
</p>

<blockquote>
<p>
在第三个千禧年,使用文本文件是否还有意义? 文本文件是唯一真正可以说是可移植的文件格式. 用文本文件保存的数据永远不会丢失.
</p>
</blockquote>

<p>
因此若你想进行文学编程,org-mode是个很好的选择,更何况我们本来就已经在用org-mode作许多事情了, 对吧?
</p>
</div>
</div>

<div id="outline-container-org49d7d07" class="outline-2">
<h2 id="org49d7d07"><span class="section-number-2">4</span> 使用Org有什么优势?</h2>
<div class="outline-text-2" id="text-4">
<p>
使用org-mode进行文学编程有如下几点优势:
</p>

<ul class="org-ul">
<li>代码更易理解</li>
<li>方便团队讨论问题</li>
<li>针对复杂状况更容易思考的清晰一点</li>
<li>学习新库和API时,可以一边实验一边记笔记</li>
<li>可以同时使用多种语言,每种语言只完成自己擅长的任务(例如可以使用通用语言来查询,维护数据库)</li>
<li>org具有组织化的能力,它提供了类似Agenda和task这类的工具</li>
</ul>
</div>
</div>

<div id="outline-container-orgf6e6847" class="outline-2">
<h2 id="orgf6e6847"><span class="section-number-2">5</span> 警告</h2>
<div class="outline-text-2" id="text-5">
<p>
1980年的软件世界与今天的情况相比,已经发生了翻天覆地的改变. 现在的工程师们连接的更紧密了,且常常以团队的形式进行工作. 虽然如此,但各个工程师所使用的工具还是各不相同的. 即使你的团队并不使用Emacs, 你依然会觉得org-mode的方法很有用处.
</p>

<p>
首先,org-mode很适合用于设计复杂算法,当你有什么灵感的时候,可以立即写下最终的代码(你所写下的记录会成为代码中的注释), 当你毫无进展时,你可以直接把记录发给团队中的其他人敬候回应.
</p>

<p>
其次,org-mode文件可以被认为是一个repl环境,因为其中的每个代码块都能被分别执行,并且代码块的执行结果还能传递给其他的代码块… but I’m getting a head of myself.
</p>
</div>
</div>

<div id="outline-container-org049d866" class="outline-2">
<h2 id="org049d866"><span class="section-number-2">6</span> 导出文档</h2>
<div class="outline-text-2" id="text-6">
<p>
使用org-mode的主要原因是可以将org文件导出成HTML,电子邮件信息,Wiki等许多格式的文档. Org特别适合于写科技类的文章,我主要用它来程序代码相关的东西.
</p>

<p>
org-mode还支持LaTex,下面是个例子:
</p>

<div class="org-src-container">
<pre class="src src-org">- <span style="font-weight: bold;">Unicode References ::</span> for instance, \alpha, \beta and \gamma.
- <span style="font-weight: bold;">Subscripts ::</span> like Hydrogen atoms, H_2, and Water, H_{2}O.
- <span style="font-weight: bold;">Superscripts ::</span> The mass of the sun is 1.989 x 10^30 kg.
- <span style="font-weight: bold;">Embedded Equations ::</span> Surrounded with either single <span style="color: #4f97d7;">=$=</span>, like $a^2=b$,
or escaped parenthesis, like: \( b=\frac{1}{2} \)
- <span style="font-weight: bold;">Separated equations ::</span> Either in double <span style="color: #4f97d7;">=$$=</span> or escaped brackets, like
this: $$ a=\frac{1}{2}\sqrt{2} $$ or this: \[ a=-\sqrt{2} \] or this:
\begin{equation}
x=\sqrt{b}
\end{equation}

<span style="color: #9f8766;">#+OPTIONS: tex:t</span>
</pre>
</div>

<p>
上面那段内容可以转换成下面的HTML展示:
</p>

<div class="org-src-container">
<pre class="src src-text">Unicode References
    for instance, &#945;, &#946; and &#947;.
Subscripts
    like Hydrogen atoms, H[2], and Water, H[2]O.
Superscripts
    The mass of the sun is 1.989 x 10^30 kg.
Embedded Equations
    Surrounded with either single $, like \(a^2=b\), or escaped parenthesis, like: \( b=\frac{1}{2} \)
Separated equations

    Either in double $$ or escaped brackets, like this: \[ a=\frac{1}{2}\sqrt{2} \] or this: \[ a=-\sqrt{2} \]
    or this:

    \begin{equation} x=\sqrt{b} \end{equation}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf65c02" class="outline-2">
<h2 id="orgdf65c02"><span class="section-number-2">7</span> 基础知识</h2>
<div class="outline-text-2" id="text-7">
<p>
这篇指南来源于一场研讨会, 那么让我们运行Emacs,创建一个org-mode文件,然后开始操作.
</p>

<p>
让我们输入以下代码块(大小写无关):
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC emacs-lisp</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">directory-files </span><span style="color: #2d9574; background-color: #2f2b33;">"."</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<ul class="org-ul">
<li>按下 <code>C-c C-c</code> 会执行该命令,并且将结果插入到文件后面 … we’ll use that to our advantage later.</li>
<li>按下 <code>C-c '(单引号)</code> 可以以指定语言的mode来编辑这段代码. 这样你就可以利用 <code>paredit</code> 或者类似的插件来帮你编辑代码了.</li>
</ul>

<p>
注意: 发现我的例子有错误后(注意,我并没有说"如果"), 去查一下 <a href="http://orgmode.org/org.html#toc_Working-with-source-code">the org-mode manual</a>,然后将勘误发给我.
</p>
</div>

<div id="outline-container-orge9a2d7a" class="outline-3">
<h3 id="orge9a2d7a"><span class="section-number-3">7.1</span> 快捷方式</h3>
<div class="outline-text-3" id="text-7-1">
<p>
若你使用比较新版本的Emacs(新于v22)或这时比较新版本的org-mode(你可能直接从ELPA中安装),那么你可以使用 <a href="http://orgmode.org/org.html#Easy-templates">Org Templates</a>,它提供了如下功能:
</p>

<ul class="org-ul">
<li>输入 <code>&lt;s &lt;TAB&gt;</code> 可以快速创建一个代码块</li>
<li>如果没有创建代码块,或许你可以试试 <a href="https://github.com/capitaomorte/yasnippet">yasnippets</a></li>
<li>从代码块的 <code>BEGIN</code> 到 <code>END</code> 部分的任意位置,你都可以通过按下 <code>C-c C-c</code> 来执行代码</li>
<li>使用 <code>C-c M-f</code> 跳转到文件中下一个代码块位置,使用 <code>C-c M-b</code> 跳转到上一个代码块位置</li>
</ul>
</div>
</div>

<div id="outline-container-org15cfaee" class="outline-3">
<h3 id="org15cfaee"><span class="section-number-3">7.2</span> 推荐配置</h3>
<div class="outline-text-3" id="text-7-2">
<p>
要想语法高亮代码块中的代码,可以将下面代码放到 <code>.emacs</code> 初始化文件中:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> org-confirm-babel-evaluate nil
      org-src-fontify-natively t
      org-src-tab-acts-natively t<span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
将 <code>org-confirm-babel-evalute</code> 设置为nil,可以在你用 <code>C-c C-c</code> 执行代码块时,不再提示“Do you want to execute”
</p>
</div>
</div>
</div>

<div id="outline-container-org6499edf" class="outline-2">
<h2 id="org6499edf"><span class="section-number-2">8</span> 支持的语言</h2>
<div class="outline-text-2" id="text-8">
<p>
Org-mode<a href="http://orgmode.org/org.html#Languages">支持许多的编程语言</a>, 但还是有些语言是不支持的(当然,你可以为Org-mode添加新语言的支持,这并不难). 
</p>

<p>
我会展示一些比较流行的语言案例,从中你也可以看出不同语言之间的些许差别.
</p>
</div>

<div id="outline-container-org5553f03" class="outline-3">
<h3 id="org5553f03"><span class="section-number-3">8.1</span> Ruby案例</h3>
<div class="outline-text-3" id="text-8-1">
<p>
让我们将上面lisp的例子修改为Ruby:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">Dir</span><span style="color: #cbc1d5; background-color: #2f2b33;">.entries</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #2d9574; background-color: #2f2b33;">'.'</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
你再按下 <code>C-c C-c</code> 发现没有反映, 这是因为你需要预先加载好Ruby语言的支持: <code>M-x load-library &lt;RET&gt; ob-ruby</code>
</p>

<p>
你也可以将下面配置放到 <code>.emacs</code> 中:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">require</span> '<span style="color: #a45bad;">ob-ruby</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1518cbc" class="outline-3">
<h3 id="org1518cbc"><span class="section-number-3">8.2</span> Python案例</h3>
<div class="outline-text-3" id="text-8-2">
<p>
需要注意的是,Ruby和Lisp类似,会自动将最后表达式的值作为代码块的返回值. 然而,Python语言,需要明确的 <code>return</code> 语句:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC python</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">from</span><span style="color: #cbc1d5; background-color: #2f2b33;"> os </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">import</span><span style="color: #cbc1d5; background-color: #2f2b33;"> listdir</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">return</span><span style="color: #cbc1d5; background-color: #2f2b33;"> listdir</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #2d9574; background-color: #2f2b33;">"."</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org16c5928" class="outline-3">
<h3 id="org16c5928"><span class="section-number-3">8.3</span> shell案例</h3>
<div class="outline-text-3" id="text-8-3">
<p>
大多数的语言使用返回值作为结果,然而shell语言使用输出到标准输入的内容作为结果:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">#+BEGIN_SRC sh
ls <span style="color: #a45bad;">-1</span>
#+END_SRC
</pre>
</div>

<p>
若按下 <code>C-c C-c</code> 没反映,你需要执行: <code>M-x load-library &lt;RET&gt; ob-sh</code>
</p>
</div>
</div>

<div id="outline-container-orgd57abb6" class="outline-3">
<h3 id="orgd57abb6"><span class="section-number-3">8.4</span> 其他语言</h3>
<div class="outline-text-3" id="text-8-4">
<p>
若你像我一样,是个多语言开发者,你可以添加类似下面的配置到 <code>.emacs</code> 文件中:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>org-babel-do-load-languages
 'org-babel-load-languages
 '<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>sh         . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>js         . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>emacs-lisp . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>perl       . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>scala      . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>clojure    . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>python     . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>ruby       . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>dot        . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>css        . t<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>plantuml   . t<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1a2e9e6" class="outline-2">
<h2 id="org1a2e9e6"><span class="section-number-2">9</span> 代码块设置</h2>
<div class="outline-text-2" id="text-9">
<p>
通过设置不同的代码块参数(也称为"头参数")可以产生各种有趣的结果. 代码块可以有0个或多个头参数.
</p>

<p>
首先我们先讨论一下几种设置头参数的方式,然后在讨论这些参数的意义. 让我先以一个头参数为例.
</p>
</div>

<div id="outline-container-org3593998" class="outline-3">
<h3 id="org3593998"><span class="section-number-3">9.1</span> 例子: dir参数</h3>
<div class="outline-text-3" id="text-9-1">
<p>
下面以<a href="http://orgmode.org/org.html#dir">dir</a> 参数为例来看如何设置一个参数, 该参数会设置代码块执行的工作目录:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :dir /etc</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  ls</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
按下 <code>C-c C-c</code> 执行代码块,你会看到列出了许多 <code>/etc</code> 目录下的内容,当然前提是你有 <code>/etc</code> 目录&#x2026;
</p>

<p>
该参数的一个有趣的用法是,可以通过Tramp实现在远程服务器上执行代码:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  hostname -f</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: blobfish</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :dir /howardabrams.com:</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  hostname -f</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: goblin.howardabrams.com</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org59204f6" class="outline-3">
<h3 id="org59204f6"><span class="section-number-3">9.2</span> 设置头参数的位置</h3>
<div class="outline-text-3" id="text-9-2">
<p>
不同位置设置参数所影响的作用域也不一样. 下面几个位置都可以用于设置头参数,以作用域从特殊到一般的顺序列出.
</p>

<ul class="org-ul">
<li>头参数嵌入到代码块中,或者在代码块上面</li>
<li>设置某一标题下面所有代码块的默认头参数</li>
<li>设置整个文档中所有代码块的默认头参数</li>
<li>设置所有文档中所有代码块的默认头参数</li>
</ul>

<p>
对我来说,为所有文档设置某个参数没有什么意义. 但若你需要,可以设置下列参数:
</p>

<ul class="org-ul">
<li>org-babel-default-header-args</li>
<li>org-babel-default-header-args:&lt;lang&gt;</li>
</ul>

<p>
<b>注意</b>:你可以在代码块被调用时设置头参数. 我们还会在下面接着提到.
</p>
</div>
</div>

<div id="outline-container-orgfd739b8" class="outline-3">
<h3 id="orgfd739b8"><span class="section-number-3">9.3</span> 太多参数了?</h3>
<div class="outline-text-3" id="text-9-3">
<p>
以将参数嵌入代码块的方式设置少量头参数还行,但是org-mode本身支持许多的参数, 若你需要设置许多的参数的话, 可以考虑将一个或多个参数放到代码块的上面去. 比如下面几个例子都是等价的:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :dir /etc :var USER="howard"</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  grep $</span><span style="color: #7590db; background-color: #2f2b33;">USER</span><span style="color: #cbc1d5; background-color: #2f2b33;"> passwd</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+HEADER: :dir /etc</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :var USER="howard"</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  grep $</span><span style="color: #7590db; background-color: #2f2b33;">USER</span><span style="color: #cbc1d5; background-color: #2f2b33;"> passwd</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+HEADER: :dir /etc</span>
<span style="color: #9f8766;">#+HEADER: :var USER="howard"</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  grep $</span><span style="color: #7590db; background-color: #2f2b33;">USER</span><span style="color: #cbc1d5; background-color: #2f2b33;"> passwd</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef7e0e1" class="outline-3">
<h3 id="orgef7e0e1"><span class="section-number-3">9.4</span> 设置某一标题下面所有代码块的默认头参数</h3>
<div class="outline-text-3" id="text-9-4">
<p>
若某一标题下面的代码块使用相同的头参数,则可以将头参数的设置放入标题下的属性drawer中. 你可以试试按照下面步骤操作:
</p>

<ol class="org-ol">
<li>在org文件中创建一个标题</li>
<li>输入 <code>C-c C-x p</code></li>
<li>输入属性名称:dir</li>
<li>输入属性值: /etc</li>
</ol>

<p>
将光标定位到 <code>:PROPERTIES:</code> 处,然后按下 <code>TAB</code> 键就会显示出隐藏的内容. 整个内容看起来应该如下所示:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #4f97d7; font-size: 130%; font-weight: bold;">* A New Section</span>
<span style="color: #bc6ec5;">:PROPERTIES:</span>
<span style="color: #bc6ec5;">:dir:</span> /etc
<span style="color: #bc6ec5;">:END:</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">File</span><span style="color: #cbc1d5; background-color: #2f2b33;">.absolute_path</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #2d9574; background-color: #2f2b33;">"."</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: /etc</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1dd849" class="outline-3">
<h3 id="orgb1dd849"><span class="section-number-3">9.5</span> 指定特定语言的默认头参数</h3>
<div class="outline-text-3" id="text-9-5">
<p>
你可以指定<a href="http://orgmode.org/org.html#Language-specific%20header%20arguments%20in%20Org%20mode%20properties">特定语言的头参数</a>. 步骤如下:
</p>

<ul class="org-ul">
<li>在标题上按下 <code>C-c C-x p</code></li>
<li>输入属性名称 <code>header-args:sh</code></li>
<li>输入属性值 <code>:dir /etc</code></li>
<li>输入 <code>C-c C-x p</code></li>
<li>输入属性名称 <code>header-args:ruby</code></li>
<li>输入属性值 <code>:dir /</code></li>
</ul>

<p>
你会得到如下结果:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #4f97d7; font-size: 130%; font-weight: bold;">* Another Section</span>
<span style="color: #bc6ec5;">:PROPERTIES:</span>
<span style="color: #bc6ec5;">:header-args:sh:</span> :dir /etc
<span style="color: #bc6ec5;">:header-args:ruby:</span> :dir /
<span style="color: #bc6ec5;">:END:</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  ls -d $</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #fa8072; background-color: #2f2b33;">pwd</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: /etc</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">File</span><span style="color: #cbc1d5; background-color: #2f2b33;">.absolute_path</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #2d9574; background-color: #2f2b33;">'.'</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: /</span>
</pre>
</div>

<p>
注意: 有些参数智能通过 <code>header-args</code> 的方式设置.
</p>
</div>
</div>

<div id="outline-container-orgdf23d7d" class="outline-3">
<h3 id="orgdf23d7d"><span class="section-number-3">9.6</span> 为文档内的所有代码块设置默认参数</h3>
<div class="outline-text-3" id="text-9-6">
<p>
通过将 <code>#+PROPERTY:</code> 设置项放到文档中,可以为该文档中的所有代码块设置默认参数
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+PROPERTY:    dir ~/Work</span>
</pre>
</div>

<p>
<b>注意:</b> 这些参数并没有在前面带上冒号
</p>

<p>
要为特定语言的代码块设置,需要进行如下操作:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+PROPERTY:    header-args:sh  :tangle no</span>
</pre>
</div>

<p>
注意: 你需要在设置项上按下 <code>C-c C-c</code>,否则该配置项不生效.
</p>
</div>
</div>
</div>

<div id="outline-container-org0ecf340" class="outline-2">
<h2 id="org0ecf340"><span class="section-number-2">10</span> 头参数的类型</h2>
<div class="outline-text-2" id="text-10">
<p>
基础的东西已经讲完了,剩下的内容就是讲讲各参数的意义了. 我按这些参数的用处将之分为以下几类:
</p>

<dl class="org-dl">
<dt>执行类参数</dt><dd>以 <code>dir</code> 为代表,这类参数影响代码块如何执行</dd>
<dt>导出类参数</dt><dd>该类参数影响了当把org文件导出成HTML(或其他格式)时,代码块以及代码块的执行结果如何展示</dd>
<dt>文学编程类参数</dt><dd>将代码块连接起来,可能会改变实际的源代码</dd>
<dt>变脸类参数</dt><dd>通过不同方式设置代码块中的变脸</dd>
<dt>杂类 输入/输出</dt><dd>其他参数</dd>
</dl>
</div>
</div>

<div id="outline-container-org01c2c28" class="outline-2">
<h2 id="org01c2c28"><span class="section-number-2">11</span> 执行类参数</h2>
<div class="outline-text-2" id="text-11">
<p>
下列参数会影响到代码的执行情况.
</p>
</div>

<div id="outline-container-org844baa2" class="outline-3">
<h3 id="org844baa2"><span class="section-number-3">11.1</span> results参数</h3>
<div class="outline-text-3" id="text-11-1">
<p>
当你执行代码块时,你希望得到哪个结果呢?
</p>

<ul class="org-ul">
<li>是表达式的返回值呢?</li>
<li>还是代码的输出结果?</li>
</ul>

<p>
以下面Ruby代码块为例. 默认情况下,你的到的是最后表达式的返回值:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    </span><span style="color: #4f97d7; background-color: #2f2b33;">puts</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">'Hello World'</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    </span><span style="color: #a45bad; background-color: #2f2b33;">5</span><span style="color: #cbc1d5; background-color: #2f2b33;"> * </span><span style="color: #a45bad; background-color: #2f2b33;">6</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: 30</span>
</pre>
</div>

<p>
若将<a href="http://orgmode.org/org.html#Results%20of%20evaluation">:results</a> 头参数的值修改为 <code>output</code>, 则的的结果是程序的输出:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :results output</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    </span><span style="color: #4f97d7; background-color: #2f2b33;">puts</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">'Hello World'</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    </span><span style="color: #a45bad; background-color: #2f2b33;">5</span><span style="color: #cbc1d5; background-color: #2f2b33;"> * </span><span style="color: #a45bad; background-color: #2f2b33;">6</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: Hello World</span>
</pre>
</div>

<p>
注意: sh代码块的 <code>:results</code> 默认值为 <code>output</code>.
</p>
</div>
</div>

<div id="outline-container-orgb87783b" class="outline-3">
<h3 id="orgb87783b"><span class="section-number-3">11.2</span> 影响输出格式的结果</h3>
<div class="outline-text-3" id="text-11-2">
<p>
代码的执行结果会插入到文档中,它可能以以下几种格式出入.
</p>

<dl class="org-dl">
<dt>table</dt><dd>若结果为单个数组,则插入一行,若结果为数组的数组,则插入一个表格</dd>
<dt>list</dt><dd>按照普通org-mode列表的格式插入一个无序列表</dd>
<dt>verbatim</dt><dd>原样输出</dd>
<dt>file</dt><dd>将结果写入到文件中</dd>
<dt>html</dt><dd>认为执行的结果是HTML代码,导出时原样导出</dd>
<dt>code</dt><dd>认为执行的结果还是原语言的代码</dd>
<dt>silent</dt><dd>只在mini-buffer中显示执行的结果</dd>
</dl>

<p>
之所以有这么多的变种,是因为执行结果本身也可以被导出(可以以HTML,或Email等格式导出), 同时这些执行结果还能作为其他代码的输入变量. 这是文学编程中最有意思的部分了,我们后面还会再提到.
</p>
</div>

<div id="outline-container-org5eae918" class="outline-4">
<h4 id="org5eae918"><span class="section-number-4">11.2.1</span> 输出成列表</h4>
<div class="outline-text-4" id="text-11-2-1">
<p>
注意到之前的输出是以表格的格式插入的,这次我们以列表的格式来插入:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :results list</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">Dir</span><span style="color: #cbc1d5; background-color: #2f2b33;">.entries</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #2d9574; background-color: #2f2b33;">'.'</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span><span style="color: #cbc1d5; background-color: #2f2b33;">.sort.select </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">do</span><span style="color: #cbc1d5; background-color: #2f2b33;"> |file|</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">     file</span><span style="color: #4f97d7; background-color: #2f2b33;">[</span><span style="color: #a45bad; background-color: #2f2b33;">0</span><span style="color: #4f97d7; background-color: #2f2b33;">]</span><span style="color: #cbc1d5; background-color: #2f2b33;"> != </span><span style="color: #2d9574; background-color: #2f2b33;">'.'</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">end</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
- for-the-host.el
- instructions.org
- literate-programming-tangling.png
- literate-programming-tangling2.png
</pre>
</div>

<p>
上面是以Ruby为例,你可以试着使用你喜欢的语言来列出目录中的文件列表.
</p>
</div>
</div>

<div id="outline-container-org0ed037e" class="outline-4">
<h4 id="org0ed037e"><span class="section-number-4">11.2.2</span> 原样输出</h4>
<div class="outline-text-4" id="text-11-2-2">
<p>
Shell命令和日志输出比较适合使用原样输出,例如:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :results verbatim :exports both</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  ssh -v goblin.howardabrams.com ls mossandcrow</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
OpenSSH_6.6.1, OpenSSL 1.0.1f 6 Jan 2014
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: /etc/ssh/ssh_config line 19: Applying options for *
debug1: Connecting to goblin.howardabrams.com [162.243.135.186] port 22.
debug1: Connection established.
debug1: identity file <span style="font-style: italic;">/home/howard/</span>.ssh/id_rsa type 1
debug1: identity file <span style="font-style: italic;">/home/howard/</span>.ssh/id_rsa-cert type -1
...
</pre>
</div>
</div>
</div>

<div id="outline-container-org923876c" class="outline-4">
<h4 id="org923876c"><span class="section-number-4">11.2.3</span> Session</h4>
<div class="outline-text-4" id="text-11-2-3">
<p>
默认情况下,每个代码块在每次运行时都会重启自己的一个解释器. 通过为<a href="http://orgmode.org/org.html#session">:session</a> 头参数设置一个标签值,则所有拥有同一标签的代码块在运行时都在同一个解释器session中. 为什么要这样做呢? 因为每次都重启解释器有以下几个问题:
</p>

<ul class="org-ul">
<li>有的解释器启动时间很长,例如Clojure</li>
<li>使用Tramp登录远程机器很慢</li>
<li>代码块共享函数定义与状态</li>
</ul>


<p>
注意: 由于不同代码块之间可以传递值,因此最后那个问题实际上可以绕过.
</p>

<p>
下面的例子说明了每个代码块执行时都会重启自己的解释器:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC python</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">avar</span><span style="color: #cbc1d5; background-color: #2f2b33;"> = </span><span style="color: #a45bad; background-color: #2f2b33;">42</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">return</span><span style="color: #cbc1d5; background-color: #2f2b33;"> avar</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: 42</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC python</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">return</span><span style="color: #cbc1d5; background-color: #2f2b33;"> avar / </span><span style="color: #a45bad; background-color: #2f2b33;">2</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
NameError: global name 'avar' is not defined
</pre>
</div>

<p>
而基于 <code>:session</code> 的解释器不会重启:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :session foobar</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  avar = </span><span style="color: #a45bad; background-color: #2f2b33;">42</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: 42</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :session foobar</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  avar / </span><span style="color: #a45bad; background-color: #2f2b33;">2</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: 21</span>
</pre>
</div>

<p>
<code>:session</code> 常常设置为标题属性. 另外,你其实可以切换到 <code>*foobar*</code> 这个buffer中直接与解释器进行交互,你可以在那设置变量及其他状态,然后再执行代码块
</p>

<p>
下面的例子中有什么问题呢?
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #4f97d7; font-size: 130%; font-weight: bold;">* Confusing Stuff</span>
<span style="color: #bc6ec5;">:PROPERTIES:</span>
<span style="color: #bc6ec5;">:session:</span>  stateful
<span style="color: #bc6ec5;">:END:</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :results silent</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">NUM_USERS</span><span style="color: #cbc1d5; background-color: #2f2b33;">=$</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #fa8072; background-color: #2f2b33;">grep</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">'bash'</span><span style="color: #cbc1d5; background-color: #2f2b33;"> /etc/passwd | wc -l --</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

We have access to them:
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">echo</span><span style="color: #cbc1d5; background-color: #2f2b33;"> $</span><span style="color: #7590db; background-color: #2f2b33;">NUM_USERS</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: 2</span>

This doesn't return... why?
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #a45bad; background-color: #2f2b33;">21</span><span style="color: #cbc1d5; background-color: #2f2b33;"> * </span><span style="color: #a45bad; background-color: #2f2b33;">2</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
<b>警告</b>: 为整个section设置的 <code>:session</code> 参数会影响到每个代码块,而不管该代码块是哪种编程语言. 这可能不是你想要的.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd76277e" class="outline-3">
<h3 id="orgd76277e"><span class="section-number-3">11.3</span> 将结果写入到文件中</h3>
<div class="outline-text-3" id="text-11-3">
<p>
创建并执行下面这个代码块:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :results output :file primes.txt</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">require</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">'prime'</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">Prime</span><span style="color: #cbc1d5; background-color: #2f2b33;">.each</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #a45bad; background-color: #2f2b33;">5000</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">do</span><span style="color: #cbc1d5; background-color: #2f2b33;"> |prime|</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    </span><span style="color: #4f97d7; background-color: #2f2b33;">p</span><span style="color: #cbc1d5; background-color: #2f2b33;"> prime</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">end</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
你会发现执行的结果是插入了一个指向文件的链接. 点击该连接会在buffer中加载该文件.
</p>

<p>
注意: <code>:file</code> 参数需要与 <code>:results output</code> 共用,因为它不知道以哪种格式输出内部值
</p>
</div>
</div>

<div id="outline-container-org81bb13c" class="outline-3">
<h3 id="org81bb13c"><span class="section-number-3">11.4</span> 导出</h3>
<div class="outline-text-3" id="text-11-4">
<p>
按下 <code>C-c C-e h o</code> 会导出成HTML文件,并用浏览器打开.
</p>

<p>
<a href="http://orgmode.org/org.html#exports">:exports</a> 头参数指明了哪些内容会被导出:
</p>

<dl class="org-dl">
<dt>code</dt><dd>只导出代码</dd>
<dt>results</dt><dd>只导出结果</dd>
<dt>both</dt><dd>同时导出代码与结果</dd>
<dt>none</dt><dd>跳过该代码块,什么都不导出</dd>
</dl>

<p>
注意: <code>:exports</code> 一般被设置成文件属性.
</p>

<p>
若导出成HTML时希望保持语法高亮,只需要加载<a href="https://www.emacswiki.org/emacs/Htmlize">htmlize</a> 库即可:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">require</span> '<span style="color: #a45bad;">htmlize</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
该功能只在最近版本的org-mode中引入. 若没有新版本的org-mode,可以从ELPA上安装.
</p>
</div>
</div>
</div>

<div id="outline-container-orgbfc299c" class="outline-2">
<h2 id="orgbfc299c"><span class="section-number-2">12</span> 文学编程</h2>
<div class="outline-text-2" id="text-12">
<p>
编程时,有时需要从org-mode文件中抽取出源代码来创建源代码文件,这个过程成为tangling
</p>
</div>

<div id="outline-container-org04256b5" class="outline-3">
<h3 id="org04256b5"><span class="section-number-3">12.1</span> Tangling</h3>
<div class="outline-text-3" id="text-12-1">
<p>
<code>:tangle</code> 参数会将所有同类语言的代码快中内容都写入指定的源码文件中.
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :tangle double-space.rb</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">while</span><span style="color: #cbc1d5; background-color: #2f2b33;"> s = gets</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    </span><span style="color: #4f97d7; background-color: #2f2b33;">print</span><span style="color: #cbc1d5; background-color: #2f2b33;"> s ; puts</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">end</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
输入 <code>C-c C-v t</code> 生成 <a href="http://howardism.org/Technical/Emacs/double-space.rb">double-space.rb</a>
</p>

<p>
拥有相同=:tangle= 值的代码块内容会按顺序写入到同一个文件中. 若 <code>:tangle</code> 参数值为 <code>yes</code> 则写入的文件其名称与原org文件名称一样(文件后缀不一样而已).
</p>

<p>
也可以使用 <code>PROPERTY</code> 来为整个文件的所有代码快指定一个值:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+PROPERTY:    tangle ~/.emacs.d/elisp/bling-mode.el</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org52a2f3a" class="outline-2">
<h2 id="org52a2f3a"><span class="section-number-2">13</span> 注释</h2>
<div class="outline-text-2" id="text-13">
<p>
若我需要与他人分享代码,我可以讲文档内容转换成<a href="http://orgmode.org/org.html#comments">注释</a>:
</p>

<div class="org-src-container">
<pre class="src src-org">Precede each line in the text from standard in (or file) with the 
current line number. 
See <span style="color: #2aa1ae; text-decoration: underline;"><a href="http://benoithamelin.tumblr.com/ruby1line">one liners</a></span>.

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">while</span><span style="color: #cbc1d5; background-color: #2f2b33;"> s = gets</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    </span><span style="color: #4f97d7; background-color: #2f2b33;">puts</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">"</span><span style="color: #7590db; background-color: #2f2b33;">#{$&lt;.file.lineno}</span><span style="color: #2d9574; background-color: #2f2b33;">: </span><span style="color: #7590db; background-color: #2f2b33;">#{s}</span><span style="color: #2d9574; background-color: #2f2b33;">"</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">end</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+PROPERTY: tangle lineno.rb</span>
<span style="color: #9f8766;">#+PROPERTY: comments org</span>
</pre>
</div>

<p>
会tangle出下面这样的Ruby代码:
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Precede each line in the text from standard in (or file) with the</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">current line number.</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">See [[http://benoithamelin.tumblr.com/ruby1line][one liners]].</span>

<span style="color: #4f97d7; font-weight: bold;">while</span> s = gets
  <span style="color: #4f97d7;">puts</span> <span style="color: #2d9574;">"</span><span style="color: #7590db;">#{$&lt;.file.lineno}</span><span style="color: #2d9574;">: </span><span style="color: #7590db;">#{s}</span><span style="color: #2d9574;">"</span>
<span style="color: #4f97d7; font-weight: bold;">end</span>
</pre>
</div>

<p>
<a href="http://orgmode.org/manual/comments.html#comments">:comments</a> 参数指明了是否将以及如何将文档内容作为注释插入tangle出的代码. 其值为org表示将文档内容作为org code来格式化再作为注释插入. 
注意: 只有代码快上面的内容才会作为注释插入.
</p>

<p>
若 <code>:comments</code> 的值为 <code>link</code>, 则插入的注释为链接到原org文件的连接. 
由于基本上我只看文学编程的原文档内容(例如我的<a href="https://github.com/howardabrams/dot-files">.emacs文件</a>)&#x2013;我几乎不会去看tangle出来的源代码,因此我觉得这个功能作用不大.
</p>

<p>
默认值为 <code>no</code>,意味着不插入任何注释.
</p>
</div>

<div id="outline-container-org0e043ef" class="outline-3">
<h3 id="org0e043ef"><span class="section-number-3">13.1</span> Shebang</h3>
<div class="outline-text-3" id="text-13-1">
<p>
当创建脚本时,常常会指定脚本运行的解释器. 该解释器可以通过<a href="http://orgmode.org/org.html#shebang">:shebang</a> 参数来指定(可以以代码块的header或文档属性的方式来指定)
</p>

<div class="org-src-container">
<pre class="src src-org">Precede each line in the text from standard in (or file) with the
current line number.
See <span style="color: #2aa1ae; text-decoration: underline;"><a href="http://benoithamelin.tumblr.com/ruby1line">one liners</a></span>.

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :shebang "#!/usr/local/bin/ruby"</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">while</span><span style="color: #cbc1d5; background-color: #2f2b33;"> s = gets</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    </span><span style="color: #4f97d7; background-color: #2f2b33;">puts</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">"</span><span style="color: #7590db; background-color: #2f2b33;">#{$&lt;.file.lineno}</span><span style="color: #2d9574; background-color: #2f2b33;">: </span><span style="color: #7590db; background-color: #2f2b33;">#{s}</span><span style="color: #2d9574; background-color: #2f2b33;">"</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">end</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+PROPERTY: shebang #!/bin/ruby</span>
<span style="color: #9f8766;">#+PROPERTY: tangle lineno</span>
<span style="color: #9f8766;">#+PROPERTY: comments org</span>
</pre>
</div>

<p>
导出的结果为:
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">!/usr/local/bin/ruby</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Precede each line in the text from standard in (or file) with the</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">current line number.</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">See [[http://benoithamelin.tumblr.com/ruby1line][one liners]].</span>

<span style="color: #4f97d7; font-weight: bold;">while</span> s = gets
  <span style="color: #4f97d7;">puts</span> <span style="color: #2d9574;">"</span><span style="color: #7590db;">#{$&lt;.file.lineno}</span><span style="color: #2d9574;">: </span><span style="color: #7590db;">#{s}</span><span style="color: #2d9574;">"</span>
<span style="color: #4f97d7; font-weight: bold;">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org94ebccc" class="outline-3">
<h3 id="org94ebccc"><span class="section-number-3">13.2</span> Noweb</h3>
<div class="outline-text-3" id="text-13-2">
<p>
若你为某个代码快命了名,则其他代码块就可以包含该代码快了.… 如标题所示,使用<a href="http://orgmode.org/org.html#noweb">:noweb</a> 参数.<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup> . 假设有如下一个Org文件:
</p>

<div class="org-src-container">
<pre class="src src-org">Print the last field of each line.

<span style="color: #9f8766;">#+NAME: the-script</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">puts</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #7590db; background-color: #2f2b33;">$F</span><span style="color: #cbc1d5; background-color: #2f2b33;">.last</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :noweb yes :tangle last-col.sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  ruby -ane </span><span style="color: #2d9574; background-color: #2f2b33;">'&lt;&lt;the-script&gt;&gt;'</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
会创建一个名为 <code>last-col.sh</code> 的源代码文件,其内容为:
</p>

<div class="org-src-container">
<pre class="src src-sh">ruby -ane <span style="color: #2d9574;">'puts $F.last'</span>
</pre>
</div>

<p>
这个功能有什么用呢?
</p>

<p>
Donald Knuth当时所使用的老式语言,要求所有的变量和函数需要先定义后使用. 也就是说你需要从下到上的写代码.
然而有些代码适合以从上倒下的方式进行解释. 对于某些算法来说,比较适合使用web和tangle.
</p>
</div>

<div id="outline-container-orgdaa8990" class="outline-4">
<h4 id="orgdaa8990"><span class="section-number-4">13.2.1</span> 关于Noweb的警告</h4>
<div class="outline-text-4" id="text-13-2-1">
<p>
假设我们有一个包含多行的代码块,如下所示:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: prime</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">require</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">"prime"</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">Prime</span><span style="color: #cbc1d5; background-color: #2f2b33;">.prime?</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">ARG</span><span style="color: #bc6ec5; background-color: #2f2b33;">[</span><span style="color: #a45bad; background-color: #2f2b33;">0</span><span style="color: #bc6ec5; background-color: #2f2b33;">]</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :noweb yes :tangle primes.sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  cat </span><span style="color: #4f97d7; background-color: #2f2b33;">$*</span><span style="color: #cbc1d5; background-color: #2f2b33;"> | xargs ruby -ne </span><span style="color: #2d9574; background-color: #2f2b33;">'&lt;&lt;prime&gt;&gt;'</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
noweb引用前的文本会被当成最初的注释字符来看待(Treats the preceding text before the noweb reference like initial comment characters), 因此其产生的结果如下:
</p>

<div class="org-src-container">
<pre class="src src-sh">cat $<span style="color: #7590db;">*</span> | xargs ruby -ne <span style="color: #2d9574;">'require "prime"</span>
<span style="color: #2d9574;">cat $* | xargs ruby -ne '</span>Prime.prime?<span style="color: #4f97d7;">(</span>ARG<span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">0</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span><span style="color: #2d9574;">'</span>
</pre>
</div>

<p>
这需要shell中的here docs或单引号. 或者是Python中的三引号(This requires either <a href="http://ss64.com/bash/syntax-here.html">here docs</a> or single quotes in a shell, or triple quotes in Python):
</p>

<div class="org-src-container">
<pre class="src src-sh">cat $<span style="color: #7590db;">*</span> | xargs ruby -ne <span style="color: #2d9574;">'</span>
<span style="color: #2d9574;">'</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd1c8ead" class="outline-2">
<h2 id="orgd1c8ead"><span class="section-number-2">14</span> 变量</h2>
<div class="outline-text-2" id="text-14">
<p>
Org能够以变量的形式传递一个或多个值到你的代码块中. 下面演示一个静态地设置变量的例子:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC python :var interest=13</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">return</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #a45bad; background-color: #2f2b33;">313</span><span style="color: #cbc1d5; background-color: #2f2b33;"> * </span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">interest / </span><span style="color: #a45bad; background-color: #2f2b33;">100</span><span style="color: #cbc1d5; background-color: #2f2b33;">.</span><span style="color: #a45bad; background-color: #2f2b33;">0</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: 40.69</span>
</pre>
</div>

<p>
当然你可以再一行或多行位置上同时定义多个变量,下面是一个例子
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+HEADER: :var a=42 d=56 :var f=23</span>
<span style="color: #9f8766;">#+HEADERS: :var b=79 e=79</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :var c=3 g=2</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">[</span><span style="color: #cbc1d5; background-color: #2f2b33;"> a, b, c, d, e, f, g </span><span style="color: #4f97d7; background-color: #2f2b33;">]</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #b2b2b2; background-color: #293239;">| 42 | 79 | 3 | 56 | 79 | 23 | 2 |</span>
</pre>
</div>

<p>
但是像这样静态地设置变量的值有什么意义呢?
</p>
</div>

<div id="outline-container-org3dec68e" class="outline-3">
<h3 id="org3dec68e"><span class="section-number-3">14.1</span> 将代码块的结果作为值传递给另一个代码块</h3>
<div class="outline-text-3" id="text-14-1">
<p>
创建一个命名的代码块,如下所示:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: twelve-primes</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">require</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">'prime'</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">Prime</span><span style="color: #cbc1d5; background-color: #2f2b33;">.first </span><span style="color: #a45bad; background-color: #2f2b33;">12</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS: twelve-primes</span>
<span style="color: #b2b2b2; background-color: #293239;">| 2 | 3 | 5 | 7 | 11 | 13 | 17 | 19 | 23 | 29 | 31 | 37 |</span>
</pre>
</div>

<p>
注意到 <code>RESULTS:</code> 部分的名字与代码块的名字一样. 我们可以将该计算结果作为数组变量传递给另一个代码块:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC python :var primes=twelve-primes</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">return</span><span style="color: #cbc1d5; background-color: #2f2b33;"> primes</span><span style="color: #4f97d7; background-color: #2f2b33;">[</span><span style="color: #cbc1d5; background-color: #2f2b33;">-</span><span style="color: #a45bad; background-color: #2f2b33;">1</span><span style="color: #4f97d7; background-color: #2f2b33;">]</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: 37</span>
</pre>
</div>

<p>
这也许是第一次Ruby与Python能够合作完成任务.
</p>
</div>
</div>

<div id="outline-container-org89cc1bf" class="outline-3">
<h3 id="org89cc1bf"><span class="section-number-3">14.2</span> 表格形式的变量数据</h3>
<div class="outline-text-3" id="text-14-2">
<p>
再下面的例子中,我需要一个填充了数字的表格. 我会通过一小段lisp程序来生成这个表格,但是你也可以用自己喜欢的语言来生成:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: cool-numbers</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC emacs-lisp</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">mapcar </span><span style="color: #bc6ec5; background-color: #2f2b33;">(</span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">lambda</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">i</span><span style="color: #2d9574; background-color: #2f2b33;">)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">            </span><span style="color: #2d9574; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">list i          </span><span style="color: #67b11d; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">random </span><span style="color: #a45bad; background-color: #2f2b33;">10</span><span style="color: #67b11d; background-color: #2f2b33;">)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">                  </span><span style="color: #67b11d; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">expt i </span><span style="color: #a45bad; background-color: #2f2b33;">2</span><span style="color: #67b11d; background-color: #2f2b33;">)</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #67b11d; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">random </span><span style="color: #a45bad; background-color: #2f2b33;">100</span><span style="color: #67b11d; background-color: #2f2b33;">)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">                  </span><span style="color: #67b11d; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">expt i </span><span style="color: #a45bad; background-color: #2f2b33;">3</span><span style="color: #67b11d; background-color: #2f2b33;">)</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #67b11d; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">random </span><span style="color: #a45bad; background-color: #2f2b33;">1000</span><span style="color: #67b11d; background-color: #2f2b33;">)</span><span style="color: #2d9574; background-color: #2f2b33;">)</span><span style="color: #bc6ec5; background-color: #2f2b33;">)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">          </span><span style="color: #bc6ec5; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">number-sequence </span><span style="color: #a45bad; background-color: #2f2b33;">1</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #a45bad; background-color: #2f2b33;">10</span><span style="color: #bc6ec5; background-color: #2f2b33;">)</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS: cool-numbers</span>
<span style="color: #b2b2b2; background-color: #293239;">|  1 | 1 |   1 | 14 |    1 |  74 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  2 | 7 |   4 | 25 |    8 | 823 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  3 | 2 |   9 | 68 |   27 | 402 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  4 | 4 |  16 | 17 |   64 | 229 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  5 | 6 |  25 |  4 |  125 | 208 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  6 | 7 |  36 | 67 |  216 | 203 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  7 | 0 |  49 | 96 |  343 | 445 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  8 | 0 |  64 | 58 |  512 | 908 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  9 | 2 |  81 | 15 |  729 | 465 |</span>
<span style="color: #b2b2b2; background-color: #293239;">| 10 | 0 | 100 | 61 | 1000 | 798 |</span>
</pre>
</div>

<p>
你无需拷贝这段源代码然后运行这段代码,你只需直接把这个充满数字的表格拷贝到你的文档就行了,像这样:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: cool-numbers</span>
<span style="color: #b2b2b2; background-color: #293239;">|  1 | 1 |   1 | 14 |    1 |  74 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  2 | 7 |   4 | 25 |    8 | 823 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  3 | 2 |   9 | 68 |   27 | 402 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  4 | 4 |  16 | 17 |   64 | 229 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  5 | 6 |  25 |  4 |  125 | 208 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  6 | 7 |  36 | 67 |  216 | 203 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  7 | 0 |  49 | 96 |  343 | 445 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  8 | 0 |  64 | 58 |  512 | 908 |</span>
<span style="color: #b2b2b2; background-color: #293239;">|  9 | 2 |  81 | 15 |  729 | 465 |</span>
<span style="color: #b2b2b2; background-color: #293239;">| 10 | 0 | 100 | 61 | 1000 | 798 |</span>
</pre>
</div>

<p>
这并不会改变我们使用和处理这些数字的方式. 随便说一下,我经常创建数据表格,并使用表格中的数据作为测试函数时用的参数值,我会展示给你看我是如何操作的.
</p>

<p>
这个g名为 cool-numbers 的表格再代码块中会被替换成一个数组或数组的数组, 这里我们使用Python推导式来将该值分解为一个长长的数组. 然后对其中的每个数字加一
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC python :var nums=cool-numbers :results list</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">return</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33;">[</span><span style="color: #cbc1d5; background-color: #2f2b33;"> cell + </span><span style="color: #a45bad; background-color: #2f2b33;">1</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">for</span><span style="color: #cbc1d5; background-color: #2f2b33;"> row </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">in</span><span style="color: #cbc1d5; background-color: #2f2b33;"> nums </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">for</span><span style="color: #cbc1d5; background-color: #2f2b33;"> cell </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">in</span><span style="color: #cbc1d5; background-color: #2f2b33;"> row </span><span style="color: #4f97d7; background-color: #2f2b33;">]</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
- 2
- 4
- 2
- 23
- 2
- 955
- 3
- 7
- 5
- 43
- 9
...
</pre>
</div>
</div>
</div>

<div id="outline-container-org6079818" class="outline-3">
<h3 id="org6079818"><span class="section-number-3">14.3</span> 表格分片</h3>
<div class="outline-text-3" id="text-14-3">
<p>
我们可以只传递表格中的某一行,方法是指定一个索引编号. 你可以试试下面这短Ruby代码块:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC ruby :var fifth=cool-numbers[4]</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  fifth</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #b2b2b2; background-color: #293239;">| 5 | 9 | 25 | 93 | 125 | 524 |</span>
</pre>
</div>

<p>
用类似的方法,我们也能只传递表格中的某一列数据. 下面是一个例子,其中的都号表示任意行,后面的4则限制了只取第5列的数字:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: cubes</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC elisp :var cubes=cool-numbers[,4]</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  cubes</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS: cubes</span>
<span style="color: #b2b2b2; background-color: #293239;">| 1 | 8 | 27 | 64 | 125 | 216 | 343 | 512 | 729 | 1000 |</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org59737c4" class="outline-3">
<h3 id="org59737c4"><span class="section-number-3">14.4</span> Reprocessing</h3>
<div class="outline-text-3" id="text-14-4">
<p>
名为cool-numbers的表格被名为cubes的代码块所使用,然后cubes代码快的结果值又可以传递给其他代码块:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: roots_of_list</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC python :var lst=cubes :results list</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">import</span><span style="color: #cbc1d5; background-color: #2f2b33;"> math</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">return</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33;">[</span><span style="color: #cbc1d5; background-color: #2f2b33;"> math.sqrt</span><span style="color: #bc6ec5; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">n</span><span style="color: #bc6ec5; background-color: #2f2b33;">)</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">for</span><span style="color: #cbc1d5; background-color: #2f2b33;"> n </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">in</span><span style="color: #cbc1d5; background-color: #2f2b33;"> lst </span><span style="color: #4f97d7; background-color: #2f2b33;">]</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS: roots_of_list</span>
- 1.0
- 2.8284271247461903
- 5.196152422706632
- 8.0
- 11.180339887498949
- 14.696938456699069
- 18.520259177452136
- 22.627416997969522
- 27.0
- 31.622776601683793
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org295f663" class="outline-2">
<h2 id="org295f663"><span class="section-number-2">15</span> 保持代码块的整洁</h2>
<div class="outline-text-2" id="text-15">
<p>
代码块执行时可能与其他事物有关. 若一段代码需要执行,但这段代码并不需要告诉其他人,则这段代码可以放置再代码块的外部, 下面是一些例子.
</p>
</div>

<div id="outline-container-org39839a8" class="outline-3">
<h3 id="org39839a8"><span class="section-number-3">15.1</span> 设置环境</h3>
<div class="outline-text-3" id="text-15-1">
<p>
我经常使用nova命令查询OpenStack的实例. 该命令会从环境变量中读取数字证书, 这些环境变量一般设置在resource文件中. 一个典型的工作流程可能像下面这样:
</p>

<pre class="example">
$ source openrc
$ nova list
</pre>

<p>
这里我想执行的代码是 <code>nova list</code>, 但是在执行该代码之前还需要执行source命令. 而该source命令我又不希望被导出. 则可以将这种不可见的代码放置在<a href="http://orgmode.org/org.html#prologue">prologue</a> 中
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+HEADER: :prologue "source openrc"</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  nova list</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
<code>:prologue</code> 中的代码不会背导出, 我的同事也只能看到 <code>nova list</code> 命令及其执行结果
</p>
</div>
</div>

<div id="outline-container-org06e0563" class="outline-3">
<h3 id="org06e0563"><span class="section-number-3">15.2</span> Using RVM</h3>
<div class="outline-text-3" id="text-15-2">
<p>
类似Python和Ruby这类语言,经常会需要指定解释器. 你可以再 <code>:prologue</code> 的命令后加上两个反斜杠来表示代码块执行时的前缀(只对shell调用有效):
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :prologue "~/.rvm/bin/rvm 1.9.3@msw exec \\"</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  gem list</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
注意: Ruby或Python代码的执行时基于<a href="http://www.emacswiki.org/emacs/RvmEl">rvm</a>, <a href="http://github.com/jorgenschaefer/pyvenv">pyvenv</a> 或 <a href="https://github.com/jorgenschaefer/elpy/wiki">ELPY</a> 的.
</p>
</div>
</div>

<div id="outline-container-org3e61f72" class="outline-3">
<h3 id="org3e61f72"><span class="section-number-3">15.3</span> 对结果进行修正</h3>
<div class="outline-text-3" id="text-15-3">
<p>
有时代码块的执行结果并不就是我们想导出到文档中的样子. While we could probably change the code, perhaps our point is the code as written.
</p>

<p>
例如, shell命令 <code>ls -l</code> 的结果会在最开始的地方添加一个指明有多少总数的行:
</p>

<p>
下例中的 <code>ls</code> 命令带了一个 <code>time-style</code> 参数:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  ls -lhG --time-style long-iso</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #b2b2b2; background-color: #293239;">| total      | 5.8M |        |      |            |       |                                     |</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 6.0K | 2015-09-02 | 17:36 | emacs-init.org                      |</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 22K  | 2015-07-05 | 11:13 | eshell-fun.org                      |</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 3.0K | 2015-07-05 | 11:13 | eshell.org                          |</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 4.3K | 2015-09-02 | 12:52 | getting-started2.org                |</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 5.1K | 2015-03-30 | 18:08 | getting-started.org                 |</span>
...
</pre>
</div>

<p>
第一行搞乱了我们的表格. 我们可以使用 <code>tail</code> 命令来修正我们的代码:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  ls -lhG --time-style long-iso | tail -n +2</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
然而,在该例中,我想讲的时 <code>ls</code> 命令而不是 <code>tail</code> 命令. =tail=命令在这很突兀.
</p>

<p>
我们可以使用<a href="http://orgmode.org/org.html#post">:post</a> 参数来修正代码块的执行结果, 这样我们可以不修改代码块而获得想要的结果.
</p>

<p>
在本例中,要删除掉第一行,我们要创建一个代码块处理器来返回除了第一行之外的所有行. 我设定该代码块处理器的 <code>:exports</code> 参数为 <code>none</code> 因为我不希望它被导出. 
请注意data变量:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: skip_first</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC elisp :var data="" :exports none</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">cdr data</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
现在我们的代码块中可以只包含 <code>ls -l</code> 命令了,但是我们还需要讲结果传递给 <code>skip_first</code> 代码块进行处理. 
我们为data变量赋值为 <code>*this*</code> (表示当前代码块的输出结果). 现在我们的结果中只包含文件了:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :post skip_first(data=*this*)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  ls -lhG --time-style long-iso</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 6.0K | 2015-09-02 | 17:36 | emacs-init.org                      |</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 22K  | 2015-07-05 | 11:13 | eshell-fun.org                      |</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 3.0K | 2015-07-05 | 11:13 | eshell.org                          |</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 4.3K | 2015-09-02 | 12:52 | getting-started2.org                |</span>
<span style="color: #b2b2b2; background-color: #293239;">| -rw-rw-r-- |    1 | howard | 5.1K | 2015-03-30 | 18:08 | getting-started.org                 |</span>
...
</pre>
</div>

<p>
当我们在后面讨论Tower of Babel时,就会发现 <code>:post</code> 参数真的很有用, 因为我们可以创建一系列的输出处理器,在其他文档中使用.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd95601b" class="outline-2">
<h2 id="orgd95601b"><span class="section-number-2">16</span> 其他特性</h2>
<div class="outline-text-2" id="text-16">
<p>
以下是一些不好分类的参数和特性.
</p>
</div>

<div id="outline-container-org75fd362" class="outline-3">
<h3 id="org75fd362"><span class="section-number-3">16.1</span> 调用代码块</h3>
<div class="outline-text-3" id="text-16-1">
<p>
目前为止,我们是通过 <code>:var</code> 参数来为代码块设置值的, 我们还可以再调用代码块是给代码块赋值.
</p>

<p>
还记得我们之前创建过的那个名为roots_of_list的代码块吗? 该代码块接受一个名为lst的变量. 下面来演示一下如果使用一个不同的值来为该变量赋值:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+CALL: roots_of_list( lst='(16 144 81 61) )</span>

<span style="color: #9f8766;">#+Results:</span>
<span style="color: #b2b2b2; background-color: #293239;">| 4.0 | 12.0 | 9.0 | 7.810249675906654 |</span>
</pre>
</div>

<p>
我们还可以使用其他代码块的输出结果. 下面例子中就使用的时 cool-numbers 表格中的一列作为被传递的值.
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+CALL: roots_of_list( lst=cool-numbers[,2] )</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #b2b2b2; background-color: #293239;">| 1.0 | 2.0 | 3.0 | 4.0 | 5.0 | 6.0 | 7.0 | 8.0 | 9.0 | 10.0 |</span>
</pre>
</div>

<p>
注意: 你可以在中括号内为代码块设置其他头参数的值. 详情请参见 <a href="http://orgmode.org/org.html#Evaluating-code-blocks">Evaluating code blocks</a>.
</p>

<p>
那么调用代码块在导出时是怎样的呢? 这个得看了. 若代码块运算结果像下例一样返回单个值:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: cube</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC elisp :var n=0 :exports none</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">* n n n</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
那么,在设定结果为table格式的情况下调用它,其结果与平常没什么不同:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+CALL: cube[:results table](n=3)</span>
</pre>
</div>

<p>
但过在设定结果为list格式的情况下调用它,则导出的结果是嵌入 <code>&lt;pre&gt;</code> 块中. 
</p>
</div>
</div>

<div id="outline-container-org54c4f11" class="outline-3">
<h3 id="org54c4f11"><span class="section-number-3">16.2</span> 嵌入运算结果</h3>
<div class="outline-text-3" id="text-16-2">
<p>
如果你想得快速得到一门语言片段的计算结果,你可以在大括号内嵌入这段代码. 例如,可以试试将下面内容输入你的org文件中,然后在行首按下 <code>C-c C-c</code> 看看结果:
</p>

<div class="org-src-container">
<pre class="src src-org">src_ruby{ 5+6 } <span style="color: #4f97d7;">=11=</span>
</pre>
</div>

<p>
其结果,11,会添加在代码块后面. 当导出时,只有计算结果会被导出(源代码不会被导出).
</p>

<p>
我想这项功能应该常用于生成文档内容,像下面这样:
</p>

<div class="org-src-container">
<pre class="src src-org">We will be bringing src_ruby{ 5+6 } children.
</pre>
</div>

<p>
注意: 计算的结果会被嵌入到HTML的 <code>&lt;code&gt;</code> 标签中.
</p>

<p>
你也可以插入shell脚本的执行结果:
</p>

<div class="org-src-container">
<pre class="src src-org">Why do I have src_sh{ ls /tmp | wc -l } files?
</pre>
</div>

<p>
甚至可以插入Emacs Lisp函数的返回值:
</p>

<div class="org-src-container">
<pre class="src src-org">src_elisp{ org-agenda-files }
</pre>
</div>

<p>
也支持插入调用代码块的值. 例如,假设我们定义了一个名为roots_of_list的代码块,则可以这样:
</p>

<div class="org-src-container">
<pre class="src src-org">call_roots_of_list( lst=cool-numbers[,2] )
<span style="color: #b2b2b2; background-color: #293239;">| 1.0 | 2.0 | 3.0 | 4.0 | 5.0 | 6.0 | 7.0 | 8.0 | 9.0 | 10.0 |</span>
</pre>
</div>

<p>
警告: 当我再演示这项功能时,发现若你在 <code>src_XYZ</code> 上按下了 <code>C-c C-c</code> 会插入代码块的计算结果. 然后再导出时会内嵌两次结果. 一次是执行代码块时生成的结果,一次是内嵌的那个结果(这个问题现在已经被修复).
</p>
</div>
</div>

<div id="outline-container-org9689651" class="outline-3">
<h3 id="org9689651"><span class="section-number-3">16.3</span> Library of Babel</h3>
<div class="outline-text-3" id="text-16-3">
<p>
<code>Library of Babel</code> 是一系列可以在任意org-mode文件总调用的代码块. 就好像时Ruby中的Gem源一样, 你需要指定哪些包含有命名代码块的文件是可访问的.
</p>

<p>
按照以下步骤进行操作:
</p>

<ul class="org-ul">
<li>新建一个org文件,并添加至少一个命名了的代码块</li>
<li>按下 <code>C-c C-v i</code></li>
<li>选择你新建的这个org文件,表示将该文件加入babel集合中.</li>
</ul>

<p>
用一个你常用的代码块时试一试:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: take</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC elisp :var data='() only=5</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">require</span><span style="color: #cbc1d5; background-color: #2f2b33;"> '</span><span style="color: #a45bad; background-color: #2f2b33;">cl</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">flet</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #bc6ec5; background-color: #2f2b33;">(</span><span style="color: #2d9574; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">take </span><span style="color: #67b11d; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">remaining lst</span><span style="color: #67b11d; background-color: #2f2b33;">)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">               </span><span style="color: #67b11d; background-color: #2f2b33;">(</span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">if</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #b1951d; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">&gt; remaining </span><span style="color: #a45bad; background-color: #2f2b33;">0</span><span style="color: #b1951d; background-color: #2f2b33;">)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">                 </span><span style="color: #b1951d; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">cons </span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">car lst</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">take </span><span style="color: #bc6ec5; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">1- remaining</span><span style="color: #bc6ec5; background-color: #2f2b33;">)</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #bc6ec5; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">cdr lst</span><span style="color: #bc6ec5; background-color: #2f2b33;">)</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span><span style="color: #b1951d; background-color: #2f2b33;">)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">                 '</span><span style="color: #b1951d; background-color: #2f2b33;">(</span><span style="color: #2d9574; background-color: #2f2b33;">"..."</span><span style="color: #b1951d; background-color: #2f2b33;">)</span><span style="color: #67b11d; background-color: #2f2b33;">)</span><span style="color: #2d9574; background-color: #2f2b33;">)</span><span style="color: #bc6ec5; background-color: #2f2b33;">)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    </span><span style="color: #bc6ec5; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">take only data</span><span style="color: #bc6ec5; background-color: #2f2b33;">)</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
你保持该新建的org文件,并将其作为babel addition加载后, 就可以将该代码片段用于 <code>:post</code> 参数了:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC python :post take(data=*this*, only=3)</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">return</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33;">[</span><span style="color: #cbc1d5; background-color: #2f2b33;">x * x </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">for</span><span style="color: #cbc1d5; background-color: #2f2b33;"> x </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">in</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33;">range</span><span style="color: #bc6ec5; background-color: #2f2b33;">(</span><span style="color: #a45bad; background-color: #2f2b33;">1</span><span style="color: #cbc1d5; background-color: #2f2b33;">, </span><span style="color: #a45bad; background-color: #2f2b33;">20</span><span style="color: #bc6ec5; background-color: #2f2b33;">)</span><span style="color: #4f97d7; background-color: #2f2b33;">]</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #b2b2b2; background-color: #293239;">| 1 | 4 | 9 | ... |</span>
</pre>
</div>

<p>
该功能在以下几种情况下很有用:
</p>

<ul class="org-ul">
<li>用于 <code>:post</code> 参数中处理结果</li>
<li>通过 <code>#+CALL</code> 语句将运算结果嵌入到行中</li>
<li>通过 <code>call_XYZ()</code> 语句将运算结果嵌入到行中</li>
</ul>

<p>
要想让这些文件永久性的添加到 babel library中,需要在你的Emacs初始化文件中对每个想被添加的org文件调用 <code>org-babel-lob-ingest</code> 函数.
</p>
</div>
</div>
</div>

<div id="outline-container-org9b0c727" class="outline-2">
<h2 id="org9b0c727"><span class="section-number-2">17</span> 专用语言</h2>
<div class="outline-text-2" id="text-17">
<p>
我发现有些语言被org-mode所支持是为了更好的编写文档的(I’ve found a few programming languages that really add to an org-mode way of writing documents).
</p>
</div>

<div id="outline-container-org8283f0c" class="outline-3">
<h3 id="org8283f0c"><span class="section-number-3">17.1</span> SQL</h3>
<div class="outline-text-3" id="text-17-1">
<p>
通过SQL语句查询数据库,然后使用其他语言处理查询结果,这种能力十分有用. 
and if I felt I could have used them, would have made this workshop-tutorial less trivial (but also less accessible).
</p>

<p>
假设你已经安装了<a href="https://www.sqlite.org">Sqlite</a>, 并且通过 <code>M-x load-library &lt;RET&gt; ob-sqlite</code> 加载了必要的库:
</p>

<p>
你可以在Sqllite命令行中使用 <code>.backup</code> 命令导出一个数据库,然后在 <code>:db</code> 参数中指定该数据库. 就像下面这样:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sqlite :db dolphins.db</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">SELECT</span><span style="color: #cbc1d5; background-color: #2f2b33;"> gender,</span><span style="color: #4f97d7; background-color: #2f2b33;">COUNT</span><span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">gender</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">FROM</span><span style="color: #cbc1d5; background-color: #2f2b33;"> oasis </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">GROUP</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #4f97d7; background-color: #2f2b33; font-weight: bold;">BY</span><span style="color: #cbc1d5; background-color: #2f2b33;"> gender;</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #b2b2b2; background-color: #293239;">| f | 55 |</span>
<span style="color: #b2b2b2; background-color: #293239;">| m | 89 |</span>
</pre>
</div>

<p>
其结果时一个简单的表格:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">f</td>
<td class="org-right">55</td>
</tr>

<tr>
<td class="org-left">m</td>
<td class="org-right">89</td>
</tr>
</tbody>
</table>

<p>
若你觉得这样很有用,请参见我的另一篇文章<a href="http://howardism.org/Technical/Emacs/literate-database.html">Literate Database essay</a>.
</p>
</div>
</div>

<div id="outline-container-org70a8ecc" class="outline-3">
<h3 id="org70a8ecc"><span class="section-number-3">17.2</span> Graphviz</h3>
<div class="outline-text-3" id="text-17-2">
<p>
若你安装了<a href="http://www.graphviz.org/">Graphviz</a> , 则我们可以直接再文档中创建图标:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC dot :file some-illustration.png</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  digraph {</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    a -&gt; b;</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    b -&gt; c:</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">    c -&gt; a;</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  }</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>


<div class="figure">
<p><img src="http://howardism.org/Technical/Emacs/literate-programming-graphviz.png" alt="literate-programming-graphviz.png" />
</p>
</div>

<p>
对这种应用,我一般会设置 <code>:exports results</code> 以便在导出时不要导出产生图片的代码.
</p>

<p>
警告: 若你希望执行代码块并生成图片,则需要设置代码块的语言类型为 <code>dot</code>, 但若你想编辑该代码块,则又需要把语言类型设置为 <code>graphviz-dot</code>.
</p>
</div>
</div>

<div id="outline-container-orgb6ae167" class="outline-3">
<h3 id="orgb6ae167"><span class="section-number-3">17.3</span> PlantUML</h3>
<div class="outline-text-3" id="text-17-3">
<p>
若你安装了<a href="http://plantuml.sourceforge.net/download.html">PlantUML</a> ,你可以实现类似下面的功能:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+BEGIN_SRC plantuml :file sequence.png :exports results</span>
  @startuml sequence-diagram.png

    Alice -&gt; Bob: synchronous call
    Alice -&gt;&gt; Bob: asynchronous call

  @enduml
<span style="color: #9f8766;">#+END_SRC</span>
</pre>
</div>


<div class="figure">
<p><img src="http://howardism.org/Technical/Emacs/literate-programming-plantuml.png" alt="literate-programming-plantuml.png" />
</p>
</div>

<p>
哈哈,你可以为你的源代码插入描述性插图了.
</p>
</div>
</div>

<div id="outline-container-org2106828" class="outline-3">
<h3 id="org2106828"><span class="section-number-3">17.4</span> Calc</h3>
<div class="outline-text-3" id="text-17-4">
<p>
我们已经接触过了令人印象深刻的 <a href="http://howardism.org/Technical/Emacs/calc.html#Top">Emacs Calculator</a> 及其常用的数学符号.
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC calc :var a=2 b=9 c=64 x=5</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  ((a+b)^3 + sqrt(c)) / (2x+1)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: 121.727272727</span>
</pre>
</div>

<p>
若我们没有对某些变量赋值的话,则会简化这个方程式:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC calc :var a=4 b=2</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  ((a+b)^3 + sqrt(c)) / (2x+1)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+RESULTS:</span>
<span style="color: #28def0;">: (sqrt(c) + 216) / (2 x + 1)</span>
</pre>
</div>

<p>
当然,你需要通过 <code>M-x load-library &lt;RET&gt; ob-calc</code> 加载必要的库.
</p>

<p>
注意每个calc代码块的每一行都会进入Calc mode buffer的栈中(使用 <code>C-x * *</code> 可以切换到Calc中查看).
</p>
</div>
</div>
</div>

<div id="outline-container-org7b98ea1" class="outline-2">
<h2 id="org7b98ea1"><span class="section-number-2">18</span> 总结</h2>
<div class="outline-text-2" id="text-18">
<p>
下面是针对<a href="http://orgmode.org/org.html#Specific%20header%20arguments">头参数</a> 的说明清单,按你的目标或需求分类:
</p>

<ul class="org-ul">
<li><p>
代码执行?
</p>

<p>
<a href="http://orgmode.org/org.html#dir">dir</a> :: 指定代码执行的工作目录,支持Tramp
<a href="http://orgmode.org/org.html#session">session</a> :: 在不同代码块之间共享解释器
<a href="http://orgmode.org/org.html#file">file</a> :: 将代码块的计算结果写入文件中
<a href="http://orgmode.org/org.html#eval">eval</a> :: 限制只指定特定的代码块
<a href="http://orgmode.org/org.html#cache">cache</a> :: 缓存计算结果,防止对代码块重复计算
<a href="http://orgmode.org/org.html#var">var</a> :: 为代码块赋值(ignore with no-expand)
</p></li>

<li><p>
导出?
</p>

<p>
<a href="http://orgmode.org/org.html#results">results</a> :: 结果时要输出的内容还是返回值,格式时怎样的
<a href="http://orgmode.org/org.html#exports">exports</a> :: 代码与结果该如何导出
</p></li>

<li><p>
文学编程?
</p>

<p>
<a href="http://orgmode.org/org.html#tangle">tangle</a> :: 源代码以何种方式写入到脚本文件中 &#x2026; 这时文学编程的核心.
<a href="http://orgmode.org/org.html#mkdirp">mkdirp</a> :: 再tangle源码文件时是否创建父目录
<a href="http://orgmode.org/org.html#shebang">shebang</a> :: 写入到源码文件中第一行的内容
<a href="http://orgmode.org/org.html#noweb">noweb</a> :: 是否扩展noweb引用
<a href="http://orgmode.org/org.html#noweb-ref">noweb-ref</a> :: noweb引用的内容
</p></li>

<li><p>
Special Input?
</p>

<p>
<a href="http://orgmode.org/org.html#prologue">prologue</a> :: 参数决定了在执行代码块中的代码之前,作什么初始化操作
<a href="http://orgmode.org/org.html#epilogue">epilogue</a> :: 参数决定了在执行代码块中的代码之后,作什么清理操作
</p></li>

<li><p>
Special Output and Formatting?
</p>

<p>
<a href="http://orgmode.org/org.html#padline">padline</a>
<a href="http://orgmode.org/org.html#post">post</a> :: 参数用于决定了得到代码块的result后,该result要传递到哪个代码块中作进一步的处理
<a href="http://orgmode.org/org.html#wrap">wrap</a>
其他.
    <a href="http://orgmode.org/org.html#hlines">hlines</a>, <a href="http://orgmode.org/org.html#colnames">colnames</a>, <a href="http://orgmode.org/org.html#rownames">rownames</a>
</p></li>
</ul>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="http://howardism.org/Technical/Emacs/literate-programming-tutorial.html#fnr.1">参见链接</a>
</p>

<p class="footpara">
The term noweb is from Knuth’s original program for tangling out source code. Since each code block could be 
re-inserted into other blocks, he saw this as creating a tangled web of connections.
</p></div></div>


</div>
</div>
</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2016-07-03</span>
            <span title="last modification date" class="post-info">2016-07-17</span>
            <span title="tags" class="post-info">:N/A:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a></span>
        </div>
    <script src="https://lujun9972.github.io/emacs-document/media/js/jquery-2.1.3.min.js"></script>
        <section>
            <h1>Comments</h1>
            <div id="comment-wrap">
                    <a class="disqus_label">使用 Disqus 评论</a>
    </ul>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
         //var disqus_developer = 1;
         var preempt_signal=false;
         var disqus_identifier = "/blog/2016/07/03/文学编程简介/";
         var disqus_url = "https://lujun9972.github.io/emacs-document/blog/2016/07/03/文学编程简介/";
         var disqus_shortname = 'emacs-document';
         /* * * DON'T EDIT BELOW THIS LINE * * */
         (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
             $('#disqus_thread').css('display','none');
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    <script>
     /* comments */
     var ego_disqus_thread=$('#disqus_thread');
     var ego_ds_label=$('.ds-thread');
     $('.disqus_label').click(function(){
         ego_disqus_thread.show();
         ego_ds_label.hide();
     });
     $('.ds-label').click(function(){
         ego_disqus_thread.hide();
         ego_ds_label.show();
     });
    </script>
        </section>
    <script src="https://lujun9972.github.io/emacs-document/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="https://lujun9972.github.io/emacs-document//instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
