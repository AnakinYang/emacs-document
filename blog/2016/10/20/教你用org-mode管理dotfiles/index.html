<!DOCTYPE html>
<html lang="en">
<head>
  <title>教你用Org-mode管理dotfiles - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="org-mode" />
  <!-- <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="https://lujun9972.github.io/emacs-document/">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="https://lujun9972.github.io/emacs-document/years/">Years</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/authors/">Authors</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/tags/">Tags</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">教你用Org-mode管理dotfiles</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org8695b1a">1. 1 Here's how</a>
<ul>
<li><a href="#orgdee5d6e">1.1. 1.1 Requirements</a></li>
<li><a href="#org8eb736c">1.2. 1.2 "Normal" dotfiles</a></li>
<li><a href="#orgb8f468a">1.3. 1.3 Dotfiles in a dotdir</a></li>
<li><a href="#orge2e635e">1.4. 1.4 Emacs dotfiles</a></li>
<li><a href="#org29924cf">1.5. 1.5 Credentials and secrets</a></li>
</ul>
</li>
<li><a href="#org2a0480b">2. 2 Documenting changes</a></li>
<li><a href="#org295edf3">3. 3 Managing remote dotfiles and configs</a></li>
<li><a href="#org25ba53a">4. 4 Caveats</a></li>
<li><a href="#orga2860ee">5. 5 Acknowledgements</a></li>
</ul>
</div>
</div>
<p>
某一天,'polm23'在Hack News上提了个问题, <a href="https://news.ycombinator.com/item?id=11070797">你们都是怎么管理dotfiles的</a>. 我分享了一下我的方法并贴上了<a href="https://news.ycombinator.com/item?id=11070970">两个例子</a>. 
Turns out, rare for me, I stumbled upon an original way to edit, document and deploy dotfiles. 
虽然我们Emacs用户早已开始用Org-Mode来管理.emacs文件了, 但还是只有极少数的人用它来管理其他的dotfile.
</p>

<p>
用Org-Mode来管理dotfile,我至少能想到三个优势.
</p>

<ul class="org-ul">
<li>你可以对每一行的配置都加上文档说明. 你可以记录下你是什么时候写下这行配置的,为什么要写下这行配置. 你也可以在这段代码块附件记下其他可能的配置,这样你就无需老是去查看man或其他文档信息了.</li>
<li>你不再需要创建那些容易出错的符号链接了. 我们经常会写出像 <code>ln -s dotfiles/vimrc ~/.vimrc</code> 这样的创建符号链接对吧? 
即使我们记得总是在创建符号链接时使用绝对路径,那当你想把dotfile从BSD迁移到Linux时怎么办呢? <code>~</code> 在两个系统可是表示不同路径的呀!
当然,你可以在发布脚本中为不同操作系统创建不同的分支,但是借助Org-Mode,你根本无需这么麻烦.</li>
<li>你甚至可以管理远程服务器上的dotfile. Org-Mode可以将代码块'tangle'到远程主机上去, 所以你可以象管理本机上的 <code>.bashrc</code> 一样管理服务器上的 <code>nginx.conf</code> 文件.</li>
</ul>

<div id="outline-container-org8695b1a" class="outline-2">
<h2 id="org8695b1a"><span class="section-number-2">1</span> 1 Here's how</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgdee5d6e" class="outline-3">
<h3 id="orgdee5d6e"><span class="section-number-3">1.1</span> 1.1 Requirements</h3>
<div class="outline-text-3" id="text-1-1">
<p>
24.x及以上版本的Emacs, 8.x或更新的Org-Mode, 还有你最喜爱的键盘.
</p>

<p>
然后在Emacs中创建一个新文件,你可以把它叫做 <code>dotfiles.org</code> 或其他什么名字.
</p>
</div>
</div>

<div id="outline-container-org8eb736c" class="outline-3">
<h3 id="org8eb736c"><span class="section-number-3">1.2</span> 1.2 "Normal" dotfiles</h3>
<div class="outline-text-3" id="text-1-2">
<p>
这些文件直接就存放在你的home目录下. 因此可以很直接的在Emacs中管理这些文件. 为了便于组织,你可以将同类的文件放在同一个标题下. 
比如,对于那些与email相关的文件,你可以创建这样一些标题:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #4f97d7; font-size: 130%; font-weight: bold;">* Email</span>
<span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* Muttrc</span>
<span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* Aliases</span>
<span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* goobookrc</span>
</pre>
</div>

<p>
然后将你文件的内容放在每个子标题下的代码块中,像这样:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #4f97d7; font-size: 130%; font-weight: bold;">* Email</span>
<span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* Muttrc</span>
<span style="color: #827591; background-color: #373040;"> #+BEGIN_SRC conf :tangle ~/.muttrc</span>
<span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">source "/etc/Muttrc"   # Not available on OS X</span>
<span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #7590db; background-color: #2f2b33;">source</span><span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #2d9574; background-color: #2f2b33;">"gpg --batch --passphrase-file ~/.sec/.passphrase --textmode -d ~/.sec/mutt.gpg |"</span>
<span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #7590db; background-color: #2f2b33;">set</span><span style="color: #cbc1d5; background-color: #2f2b33;"> realname=</span><span style="color: #2d9574; background-color: #2f2b33;">"Haoyang Xu"</span>

<span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #7590db; background-color: #2f2b33;">set</span><span style="color: #cbc1d5; background-color: #2f2b33;"> sig_dashes</span>

<span style="color: #cbc1d5; background-color: #2f2b33;"> </span><span style="color: #7590db; background-color: #2f2b33;">...</span>

<span style="color: #827591; background-color: #373040;"> #+END_SRC</span>
</pre>
</div>

<p>
这样一来,当你运行 <code>M-x org-babel-tangle</code> 或按下 <code>C-c C-v t</code> 时,上面代码块的内容会写入到 <code>$HOME/.muttrc</code> 文件中, 并覆盖原内容.
</p>

<p>
其他的子标题也是一样的处理方式:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #4f97d7; font-size: 130%; font-weight: bold;">* Email</span>
<span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* Muttrc ...</span>
<span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* Aliases</span>
<span style="color: #827591; background-color: #373040;">  #+BEGIN_SRC conf :tangle ~/.aliases</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">alias</span><span style="color: #cbc1d5; background-color: #2f2b33;"> mumon      foobar@example.com</span>
<span style="color: #827591; background-color: #373040;">  #+END_SRC</span>
<span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* goobookrc</span>
<span style="color: #827591; background-color: #373040;">  #+BEGIN_SRC conf :tangle ~/.goobookrc</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  [</span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">DEFAULT</span><span style="color: #cbc1d5; background-color: #2f2b33;">]</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">   # The following are optional, defaults are shown</span>

<span style="color: #cbc1d5; background-color: #2f2b33;">   # This file is written by the oauth library, and should be kept secure,</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">   # it's like a password to your google contacts.</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">   ;oauth_db_filename: ~/.goobook_auth.json</span>

<span style="color: #cbc1d5; background-color: #2f2b33;">   # The client secret file is not really secret.</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">   ;client_secret_filename: ~/.goobook_client_secret.json</span>

<span style="color: #cbc1d5; background-color: #2f2b33;">   ;cache_filename: ~/.goobook_cache</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">   ;cache_expiry_hours: 24</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">   ;filter_groupless_contacts: yes</span>
<span style="color: #827591; background-color: #373040;">  #+END_SRC</span>
</pre>
</div>

<p>
现在当你执行 <code>org-babel-tangle</code> 后,会产生3个dotfile. 你可以将这个org文件纳入到版本控制系统中,在Emacs中编辑dotfile然后一键发布它们.
deploy them with one command.
</p>
</div>
</div>

<div id="outline-container-orgb8f468a" class="outline-3">
<h3 id="orgb8f468a"><span class="section-number-3">1.3</span> 1.3 Dotfiles in a dotdir</h3>
<div class="outline-text-3" id="text-1-3">
<p>
假设,你想管理你的存放在 <code>.ssh</code> 目录下的SSH配置文件. 它的管理方式大致上与上面的没什么两样.
不过如果你是在一台新机器上,尚没有 <code>.ssh</code> 目录,那Org-mode在tangle时会报错.
</p>

<p>
这种情况下,你需要在文件的开头写上一行:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #2aa1ae; background-color: #292e34;"># -*- eval: (make-directory ".ssh" "~") -*-</span>
</pre>
</div>

<p>
你也可以在文件开始前创建一个代码块来帮你运行创建目录的命令.
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">mkdir ~/.ssh</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
不过,最好的方法还是设置header argument <code>mkdirpl</code> 为 <code>yes</code>. 像这样:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :mkdirp yes :tangle ~/.ssh/config</span>
<span style="color: #4f97d7; background-color: #2f2b33;">(</span><span style="color: #cbc1d5; background-color: #2f2b33;">your .ssh/config contents</span><span style="color: #4f97d7; background-color: #2f2b33;">)</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
这样一来,若没有 <code>.ssh</code> 目录的话,Org-Mode会自动帮你创建.
</p>
</div>
</div>

<div id="outline-container-orge2e635e" class="outline-3">
<h3 id="orge2e635e"><span class="section-number-3">1.4</span> 1.4 Emacs dotfiles</h3>
<div class="outline-text-3" id="text-1-4">
<p>
如果你是采用的老旧的 <code>.emacs</code> 或 <code>init.el</code> 来存放你的Emacs配置,那么管理的方法跟上面说的一样.
然而,若你的配置本来就是嵌入到其他.org文件中的,我想你应该不会喜欢把这些org文件的内容再放到 <code>dotfile.org</code> 中的org代码块中.
我的解决方案是在 <code>home.org(我的dotfile)</code> 所在目录下创建一个目录来存放这些Emacs dotfile.
这种方法不太完美,不过我目前也没有其他什么好的方法了. 这还真是讽刺啊.
</p>
</div>
</div>

<div id="outline-container-org29924cf" class="outline-3">
<h3 id="org29924cf"><span class="section-number-3">1.5</span> 1.5 Credentials and secrets</h3>
<div class="outline-text-3" id="text-1-5">
<p>
若你把你的dotfile放到网上去,那么你需要给dotfile加密. 好在,Emacs对加解密文件支持得很好.
你把那些不想公开的东西写入一个特定的org问你就暗中,然后用 <code>epa-encrypt-file</code> 来将该文件进行加密,加密后的文件以 <code>.gpg</code> 为后缀. 然后你就可以删掉明文的org文件了. 
下一次你在编辑加密过的 <code>.org.gpg</code> 文件时, Emacs会通过 <code>gpg-agent</code> 提示你输入密码,然后自动为你解密.
</p>
</div>
</div>
</div>

<div id="outline-container-org2a0480b" class="outline-2">
<h2 id="org2a0480b"><span class="section-number-2">2</span> 2 Documenting changes</h2>
<div class="outline-text-2" id="text-2">
<p>
上面的方法能够让你简单而快速的把所有的dotfile都放到少量的org文件中去. 但是仅仅这样还不够. 用Org-mode来管理dotfile的好处更在于能够无缝的整合文档说明,并且能够快速的进行部署.
</p>

<p>
你可以把一段非常长的配置内容细分到多个代码块中去,然后在部署时将这些代码块中的内容整合到一个文件中去.
你甚至可以把这些代码块放置在不同的子标题下.
</p>

<p>
这种情况下, 你无需为每个代码块的属性(官方文档称之为head arguments)都设置以此要写到哪个文件中, 你可以直接在标题的属性中(为该标题下的所有代码块)指定该文件的路径.
下面举个例子:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #4f97d7; font-size: 130%; font-weight: bold;">* Git</span>
<span style="color: #bc6ec5;">  :PROPERTIES:</span>
  <span style="color: #bc6ec5;">:tangle:</span>   ~/.gitconfig   # &lt;- all src blocks under this 'Git' subtree will be written to ~/.gitconfig
<span style="color: #bc6ec5;">  :END:</span>
<span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* personal information</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC conf</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  [</span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">user</span><span style="color: #cbc1d5; background-color: #2f2b33;">]</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">name</span><span style="color: #cbc1d5; background-color: #2f2b33;"> = John Doe</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">email</span><span style="color: #cbc1d5; background-color: #2f2b33;"> = john.doe@example.net</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
<span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* push settings</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC conf</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  [</span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">push</span><span style="color: #cbc1d5; background-color: #2f2b33;">]</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">default</span><span style="color: #cbc1d5; background-color: #2f2b33;"> = upstream</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
...
</pre>
</div>

<p>
当你tangle该文件时,所有 <code>* Git</code> 子树下的代码块都会被写入到 <code>$HOME/.gitconfig</code> 中.
(译者注：新的org-mode下需要把 <code>:tangle: ~/.gitconfig</code> 改成 <code>:header-args: :tangle ~/.gitconfig</code>)
</p>

<p>
现在假设我们要修改一下Git的推送配置,我们可以很方便的定位到相关位置然后做出一些修改:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* push settings</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC conf</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  [</span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">push</span><span style="color: #cbc1d5; background-color: #2f2b33;">]</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">default</span><span style="color: #cbc1d5; background-color: #2f2b33;"> = simple</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
过了一段时候后,你可能就会忘记改了哪部分内容了. 那么为什么为这次的修改留下一些笔记呢?
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* push settings</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC conf</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  [</span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">push</span><span style="color: #cbc1d5; background-color: #2f2b33;">]</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">default</span><span style="color: #cbc1d5; background-color: #2f2b33;"> = simple</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
<span style="color: #7590db; text-decoration: underline;">[2016-03-19 Sat 22:31]</span> change push default from 'upstream' to 'simple'.
</pre>
</div>

<p>
你可以在几乎任何位置通过按下 <code>C-u C-c !</code> 来插入一段时间戳. 如果你只需要插入日期而不关心具体的时间,那么你可以按下 <code>C=c !</code> 来插入.
</p>

<p>
如果你经常需要修改某项配置,可以考虑为所有可能的选项加上说明:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #292b2e;">*</span><span style="color: #2d9574; font-size: 120%; font-weight: bold;">* push settings</span>
With <span style="color: #28def0;">~push.default~</span> set to <span style="color: #28def0;">~simple~</span>, <span style="color: #28def0;">~git push~</span> will fail if the current local branch is not tracking a remote branch, even if remote has a branch with the same name. This seems to be the safest option. Other possible values are:

 - <span style="color: #28def0;">~upstream~</span>: push the local branch to its upstream branch.
 - <span style="color: #28def0;">~current~</span>: push the local branch to a branch of the same name.

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC conf</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  [</span><span style="color: #ce537a; background-color: #2f2b33; font-weight: bold;">push</span><span style="color: #cbc1d5; background-color: #2f2b33;">]</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">default</span><span style="color: #cbc1d5; background-color: #2f2b33;"> = simple</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
<span style="color: #7590db; text-decoration: underline;">[2016-03-19 Sat 22:31]</span> change push default from 'upstream' to 'simple'.
</pre>
</div>

<p>
有时,你可能想体验一下各类选项的组合效果,你可以将这些组合都写下来,然后告诉Org-mode不要tangle其中的某些代码块:
</p>

<div class="org-src-container">
<pre class="src src-conf"><span style="color: #7590db;">safe_threshold</span>=1
<span style="color: #7590db;">encryption_mechanism</span>=ECDHE_RSA
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="color: #7590db;">safe_threshold</span>=0
<span style="color: #7590db;">encryption_mechanism</span>=HMAC-SHA1
</pre>
</div>

<p>
上面例子中,只有后面的代码块会被写入配置文件中.
</p>
</div>
</div>

<div id="outline-container-org295edf3" class="outline-2">
<h2 id="org295edf3"><span class="section-number-2">3</span> 3 Managing remote dotfiles and configs</h2>
<div class="outline-text-2" id="text-3">
<p>
你可以为 <code>:tangle</code> 这个head argument或者其对应的子树属性赋一个远程主机上的位置,一般来说这个主机你能够用SSH访问. 
假设你在管理一台web服务器,你可以通过Org-mode来管理它的相关配置而无需远程登录到web服务器上编辑文件:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #4f97d7; font-size: 130%; font-weight: bold;">* Nginx</span>
<span style="color: #bc6ec5;">  :PROPERTIES:</span>
  <span style="color: #bc6ec5;">:tangle:</span>   /webadmin@ssh.example.org:configs/nginx.conf
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC conf</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">worker_processes</span><span style="color: #cbc1d5; background-color: #2f2b33;"> 4;</span>

<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">events</span><span style="color: #cbc1d5; background-color: #2f2b33;"> { worker_connections 1024; }</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">  </span><span style="color: #7590db; background-color: #2f2b33;">...</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC sh :dir /<a href="ssh:webadmin@ssh.example.org|sudo:ssh.example.org">ssh:webadmin@ssh.example.org|sudo:ssh.example.org</a> :tangle no</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">cp /home/webadmin/configs/nginx.conf /etc/nginx/</span>
<span style="color: #cbc1d5; background-color: #2f2b33;">chown nginx:nginx /etc/nginx/nginx.conf</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
第一个代码块的内容会写入到远程文件 <code>/home/webadmin/nginx.conf</code> 中, 二第二个代码块由于参数 <code>:tangle</code> 为 <code>no</code> 因此不会tangle到任何文件中去.
不过你可以在本地的Emacs中运行这段代码,它会提示你输入sudo的密码,然后拷贝配置文件到指定的地方,并设置好配置文件的宿主.
</p>
</div>
</div>

<div id="outline-container-org25ba53a" class="outline-2">
<h2 id="org25ba53a"><span class="section-number-2">4</span> 4 Caveats</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>Emacs是单线程的. 如果你是通过一个非常缓慢的链接来tangle远程文件或执行远程shell,可能会有明显的延迟.</li>
<li><p>
你没有用到符号链接,自然也就享受不到符号链接带来的好处. 假设你通过命令 <code>git config --global ....</code> 修改了Git的配置,那么这个修改并不能自动同步到你的Org文件中去.
你需要手工更新你的 <code>dotfile.org</code>.
</p>

<p>
UPDATE: Ken Mankoff告诉了我一个技巧可以部分的解决这个问题.
你可以在你的dotfile.org的顶端加上这么一行:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+PROPERTY: header-args:conf  :comments link :tangle-mode (identity #o444)</span>
</pre>
</div>

<p>
用Ken自己的话说就是: "这使得tangle出来的文件是只读的,这就防止我一不小心错改了这些文件. 我还在没份代码前创建了一份注释链接,这样我就可以直接从这份dotfile直接跳转到相对应的原Org文件中去"
</p></li>

<li>你的 <code>dotfile.org</code> 可能会变得很庞杂. 不过这对大多数人来说并不是什么大不了的问题.
在我的 late-2012 MacBook Pro上打开一个几百K的Org文件,跟打开一个新文件没啥区别.
不过随着时间的推移,文件中可能会被log和文档说明所充斥. 这是你可能需要按标题将原文件划分成多个org文件.
不过在Org-Mode中创建不同文件之间的链接很容易,你也可以很方便的在这些文件中之间跳转.</li>
</ul>
</div>
</div>

<div id="outline-container-orga2860ee" class="outline-2">
<h2 id="orga2860ee"><span class="section-number-2">5</span> 5 Acknowledgements</h2>
<div class="outline-text-2" id="text-5">
<p>
这套系统是受到了 <a href="http://sachachua.com/blog/about/">Sacha Chua</a> 的<a href="http://pages.sachachua.com/.emacs.d/Sacha.html">Emacs配置</a> 所启发. 我也是在看到Howardism关于 <a href="http://howardism.org/Technical/Emacs/literate-devops.html">literate devops</a> 的演讲之后才意识到原来Org-Mode可以作为这么强大的系统管理工具来用的.
最后,十分感谢那些创建和维护 Org-Mode, Tramp 以及 GNU Emacs的人.
</p>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2016-10-20</span>
            <span title="last modification date" class="post-info">2019-04-14</span>
            <span title="tags" class="post-info">:N/A:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T430S">org-mode</a></span>
        </div>
    <script src="https://lujun9972.github.io/emacs-document/media/js/jquery-2.1.3.min.js"></script>
    <script src="https://lujun9972.github.io/emacs-document/media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="https://lujun9972.github.io/emacs-document/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T430S">org-mode</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="https://lujun9972.github.io/emacs-document//instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
