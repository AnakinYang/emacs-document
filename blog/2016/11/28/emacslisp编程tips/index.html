<!DOCTYPE html>
<html lang="en">
<head>
  <title>emacslisp编程tips - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #ds-thread #ds-reset .ds-comment-body p a {color: #ff0;}
   #ds-thread #ds-reset .ds-comment-body p a:hover {color: #0ff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/main.css" type="text/css"/>
  <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/comment.css" type="text/css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="https://lujun9972.github.io/emacs-document/">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <div class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" fill="#ffff00"/>
          <path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" fill="#ffff00"/>
          <path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" fill="#ffff00"/>
        </svg>
      </div>
      <ul class="trigger">
        <li><a href="https://lujun9972.github.io/emacs-document/years/">Years</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/authors/">Authors</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/tags/">Tags</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">emacslisp编程tips</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6f68641">1. 使用新版Emacs</a></li>
<li><a href="#org6e26026">2. 复制粘贴他人代码也并无不可</a></li>
<li><a href="#orgaa14657">3. 已经有了大量的现成代码,直接使用就好</a></li>
<li><a href="#orgeb4955c">4. 在名称中说明命名空间</a></li>
<li><a href="#org6c48bac">5. 理解pacakge以及autoload</a></li>
<li><a href="#orgece803e">6. 使用CL库(注:现在推荐使用cl-lib替代cl库)</a></li>
<li><a href="#org6480c4b">7. 编写测试</a></li>
<li><a href="#org7f1b45f">8. 编写函数doc-string</a></li>
<li><a href="#org78a3622">9. 使用EmacsLisp编写命令脚本</a></li>
<li><a href="#org09d3c4a">10. EmacsLisp也能写面向对象的代码</a></li>
<li><a href="#org08966fc">11. 在写宏时,需要作一些设置</a></li>
<li><a href="#orge9aaec5">12. 不要写太多的宏</a></li>
<li><a href="#org31834fa">13. 闭包很酷,但也更难于调试</a></li>
<li><a href="#orge0ff698">14. 阅读Manual</a></li>
<li><a href="#org7b491f1">15. 勤提问题</a></li>
<li><a href="#org7c91a75">16. 最后</a></li>
</ul>
</div>
</div>
<p>
我认为EmacsLisp越来越适合用来写应用了,而不仅仅是用来写完美的编辑器而已. 它作为一门编程语言以及编程环境,真的很适合用来写程序. 许多人都同意我的这个观点并开始尝试使用这门语言.
</p>

<p>
我写EmacsLisp已经15年了,下面是一些诀窍和建议,希望它们对EmacsLisp hacker新手能有所帮助.
</p>

<div id="outline-container-org6f68641" class="outline-2">
<h2 id="org6f68641"><span class="section-number-2">1</span> 使用新版Emacs</h2>
<div class="outline-text-2" id="text-1">
<p>
Emacs最新版已经出到24(注:翻译的时间点,已经出了Emacs25 pretest版). 该版本的Emacs尚未纳入大多数操作系统的仓库中. 但对于Debian和Ubuntu用户来说,你可以使用下面这个仓库/PPA: <a href="http://emacs.naquadah.org/">http://emacs.naquadah.org/</a>.
</p>

<p>
最新版本的Emacs引入了静态作用域,有内建的包管理机制以及其他很多好东西.
</p>

<p>
目前我正在维护一个类似的yum仓库. <a href="http://nic.ferrier.me.uk/blog/2012_07/tips-and-tricks-for-emacslisp?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#donate">求打赏</a>.
</p>
</div>
</div>

<div id="outline-container-org6e26026" class="outline-2">
<h2 id="org6e26026"><span class="section-number-2">2</span> 复制粘贴他人代码也并无不可</h2>
<div class="outline-text-2" id="text-2">
<p>
不用过度追求可复用的模块, 有时候直接复制代码也可以接受.
</p>

<p>
github上有大量的<a href="https://github.com/languages/Emacs%20Lisp">EmacsLisp</a> 代码可以借鉴和拷贝.
</p>
</div>
</div>

<div id="outline-container-orgaa14657" class="outline-2">
<h2 id="orgaa14657"><span class="section-number-2">3</span> 已经有了大量的现成代码,直接使用就好</h2>
<div class="outline-text-2" id="text-3">
<p>
目前已经存在了大量的Emacs库可供使用: 支持 <a href="https://github.com/psanford/emacs-oauth">OAuth</a> (and Oauth2, in ELPA)的库, 与 <a href="http://orgmode.org/org.html#Hacking">Org Mode</a> 交互的库, 编写 <a href="http://www.emacswiki.org/emacs/ErBot">IRC bots</a> 的库, <a href="http://www.online-marketwatch.com/pgel/pg.html">PostgreSQL</a> / <a href="http://www.emacswiki.org/emacs/mysql.el">MySQL</a> / <a href="https://github.com/m2ym/mongo-el">MongoDB</a> 的接口库.
<a href="http://www.gnu.org/software/emacs/manual/html_node/url/Retrieving-URLs.html#Retrieving-URLs">HTTP</a> 和 <a href="http://www.gnu.org/software/emacs/manual/html_node/smtpmail/Emacs-Speaks-SMTP.html#Emacs-Speaks-SMTP">SMTP</a> 协议库, 甚至Emacs本身就内建了 <a href="http://www.gnu.org/software/emacs/manual/html_node/nxml-mode/index.html">处理</a> 和 <a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Parsing-HTML_002fXML.html">解析 XML</a> 的库. EmacsLisp已经有了几乎<a href="http://www.emacswiki.org/emacs/YamlPath">所有</a> <a href="http://www.emacswiki.org/emacs/WikiCreole">格式</a> 的数据定义语言的<a href="http://www.emacswiki.org/emacs/ParserCompiler">解释器</a> .
</p>

<p>
基本上,作为程序员你所需要的所有东西都已经有了. 即使有些东西暂时还没有现成的包,也很快就会有的.
</p>
</div>
</div>

<div id="outline-container-orgeb4955c" class="outline-2">
<h2 id="orgeb4955c"><span class="section-number-2">4</span> 在名称中说明命名空间</h2>
<div class="outline-text-2" id="text-4">
<p>
EmacsLisp并没有模块系统. 很多人认为这是个很严重的缺陷,但是我觉得这个问题很容易解决.
</p>

<p>
写EmacsLisp代码时,你需要遵循以下继承关系:
</p>

<ul class="org-ul">
<li>一个package其实就是一个文件或一系列的文件,只不过这些文件是以包的形式来安装的.
<ul class="org-ul">
<li>最好依照<a href="http://emacswiki.org/wiki/ELPA">ELPA标准</a> 来组建package</li>
<li>这样你写出来的代码是可移植的,而且是已经声明了依赖关系的.</li>
</ul></li>
<li>一个module是package中的一个文件,它provide了一个feature,这样就能被其他文件require了.
<ul class="org-ul">
<li>一个package中可能有多个module</li>
</ul></li>
<li>函数,类,变量,常量,结构体和其他顶层定义都在module中定义.</li>
</ul>

<p>
在遵照这套继承规则的同时,我们还可以遵守一些简单但一致的规则:
</p>

<ul class="org-ul">
<li>以前缀c/C来命名类.</li>
<li>重要的常量名全部大写.</li>
<li>module名字中需要标注package名.</li>
<li>若你的package中有多个module,则需要设定一个顶层module作为package的主module,该主module的名称一般与package名称一致. 例如若你的pacakge名为`somepackage',则该package还应该有个名为somepackage.el的文件</li>
<li><p>
在命名函数,变量,方法,类时,需要在名称中说明所属的module名.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">packagename-module-function</span> <span style="color: #bc6ec5;">(</span>args<span style="color: #bc6ec5;">)</span>
  ...<span style="color: #4f97d7;">)</span>
</pre>
</div></li>

<li><p>
若是在顶层module定义函数:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">packagename-function</span> <span style="color: #bc6ec5;">(</span>args<span style="color: #bc6ec5;">)</span>
  ...<span style="color: #4f97d7;">)</span>
</pre>
</div></li>

<li><p>
使用 &#x2013; 来说明定义的是私有函数/变量,就像这样:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">packagename--function</span> <span style="color: #bc6ec5;">(</span>args<span style="color: #bc6ec5;">)</span>
  ...<span style="color: #4f97d7;">)</span>
</pre>
</div></li>

<li><p>
macros的命名方式有些不同,但也尽量在名称中说明所属的package和module, 像这样:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defmacro</span> <span style="color: #bc6ec5; font-weight: bold;">with-package-module-thing</span> <span style="color: #bc6ec5;">(</span>...<span style="color: #bc6ec5;">)</span>
  <span style="color: #4f97d7;">)</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org6c48bac" class="outline-2">
<h2 id="org6c48bac"><span class="section-number-2">5</span> 理解pacakge以及autoload</h2>
<div class="outline-text-2" id="text-5">
<p>
Autoloads允许惰性加载EmacsLisp库的代码. 下面简要说下它的工作方式:
</p>

<ul class="org-ul">
<li>被标记了 <code>;;;### autoload</code> 的函数或变量,只有在第一次真正被调用时才加载整个库,再执行函数的真正定义.</li>
<li>Emacs从所有的package中加载所有的autoload的速度非常快,因为autoload都很小.</li>
<li>当autoload函数被调用时,会加载整个库.</li>
</ul>
</div>
</div>

<div id="outline-container-orgece803e" class="outline-2">
<h2 id="orgece803e"><span class="section-number-2">6</span> 使用CL库(注:现在推荐使用cl-lib替代cl库)</h2>
<div class="outline-text-2" id="text-6">
<p>
Emacs的核心代码建议不要require <a href="http://www.gnu.org/software/emacs/manual/html_mono/cl.html">cl</a> 库,或使用下面语句:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">eval-when-compile</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">require</span> '<span style="color: #a45bad;">cl</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
若你是为Emacs贡献代码,则你确实有必要遵循这条规范,但若只是为自己写些代码,则放心的用<a href="http://www.gnu.org/software/emacs/manual/html_mono/cl.html">cl</a> 吧,该库提供了许多有用的扩展函数,例如<a href="http://www.gnu.org/software/emacs/manual/html_mono/cl.html#Loop-Basics">loop</a>, <a href="http://www.gnu.org/software/emacs/manual/html_mono/cl.html#Iteration">dotimes</a> ,<a href="http://www.gnu.org/software/emacs/manual/html_mono/cl.html#Sequence-Functions">merge</a> 等等.
</p>
</div>
</div>

<div id="outline-container-org6480c4b" class="outline-2">
<h2 id="org6480c4b"><span class="section-number-2">7</span> 编写测试</h2>
<div class="outline-text-2" id="text-7">
<p>
Emacs24 之后加入了<a href="http://www.gnu.org/software/emacs/manual/html_node/ert/index.html">ERT</a> 库, 用于编写测试很好.
</p>

<p>
你也可以使用我的<a href="http://nic.ferrier.me.uk/blog/2012_04/fakir-for-faking-bits-of-emacs">fakir</a> 库,该库可以模拟Emacs中的process和file.
</p>

<p>
最好每个module中的代码都写相应的测试module. 像 <a href="https://github.com/nicferrier/elnode">Elnode</a> 就有很多的测试案例. Each test module is named after the module that it tests which seems like more good advice.
</p>
</div>
</div>

<div id="outline-container-org7f1b45f" class="outline-2">
<h2 id="org7f1b45f"><span class="section-number-2">8</span> 编写函数doc-string</h2>
<div class="outline-text-2" id="text-8">
<p>
当编写EmacsLisp时, <a href="http://emacswiki.org/emacs/ElDoc">ElDoc</a> 库能提供很大的帮助. 但前提是你程序中所使用的函数/变量都具有doc-string才行. 试着为你的函数/变量编写<a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Documentation-Basics.html">合适的doc-string吧</a>.
</p>

<p>
你可以使用我所编写的<a href="http://www.emacswiki.org/emacs/WikiDoc">wikidoc</a> 程序来将函数/变量的doc-string转换为HTML文档.
</p>
</div>
</div>

<div id="outline-container-org78a3622" class="outline-2">
<h2 id="org78a3622"><span class="section-number-2">9</span> 使用EmacsLisp编写命令脚本</h2>
<div class="outline-text-2" id="text-9">
<p>
Shell脚本写起来很快速也很容易,但当所想实现的功能稍微复杂一点,shell就开始变得难以使用了,这时候你就会想使用一款合适的编程语言来实现这项功能. EmacsLisp就是个不错的选择,下面是一段从<a href="http://nic.ferrier.me.uk/blog/2012_07/emacs-packages-for-programmers">我博客</a>中抽取出的例子.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">:<span style="color: #2aa1ae; background-color: #292e34;">;</span><span style="color: #2aa1ae; background-color: #292e34;">exec emacs -batch -Q -l "$0" -f main "$@"</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">require</span> '<span style="color: #a45bad;">cl</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>toggle-debug-on-error<span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">main</span> <span style="color: #bc6ec5;">()</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">interactive</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">destructuring-bind</span> <span style="color: #2d9574;">(</span>package <span style="color: #ce537a; font-weight: bold;">&amp;optional</span> elpa-parent<span style="color: #2d9574;">)</span> command-line-args-left
    <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">Make the elpa dir for this if we need to.</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">when</span> <span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">and</span> elpa-parent
               <span style="color: #b1951d;">(</span>not <span style="color: #4f97d7;">(</span>file-exists-p elpa-parent<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>make-directory elpa-parent t<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">Package stuff</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> package-user-dir
          <span style="color: #67b11d;">(</span>concat
           <span style="color: #b1951d;">(</span><span style="color: #4f97d7; font-weight: bold;">or</span> <span style="color: #4f97d7;">(</span>concat elpa-parent <span style="color: #2d9574;">"/"</span><span style="color: #4f97d7;">)</span>
               user-emacs-directory<span style="color: #b1951d;">)</span>
           <span style="color: #2d9574;">".elpa"</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> package-archives
          '<span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span><span style="color: #2d9574;">"gnu"</span> . <span style="color: #2d9574;">"http://elpa.gnu.org/packages/"</span><span style="color: #2aa1ae; background-color: #292e34;">;</span><span style="color: #2aa1ae; background-color: #292e34;">)</span>
             <span style="color: #4f97d7;">(</span><span style="color: #2d9574;">"marmalade"</span> . <span style="color: #2d9574;">"http://marmalade-repo.org/packages/"</span><span style="color: #2aa1ae; background-color: #292e34;">;</span><span style="color: #2aa1ae; background-color: #292e34;">)))</span>
              <span style="color: #bc6ec5;">(</span>package-initialize<span style="color: #bc6ec5;">)</span>
              <span style="color: #bc6ec5;">(</span>package-refresh-contents<span style="color: #bc6ec5;">)</span>
              <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">and</span> <span style="color: #9cb6ad;">(</span>file-exists-p <span style="color: #4f97d7;">(</span>expand-file-name package<span style="color: #4f97d7;">)</span><span style="color: #9cb6ad;">)</span>
                       <span style="color: #9cb6ad;">(</span>not <span style="color: #4f97d7;">(</span>file-directory-p <span style="color: #bc6ec5;">(</span>expand-file-name package<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #2d9574;">)</span>
                  <span style="color: #2d9574;">(</span>package-install-file <span style="color: #9cb6ad;">(</span>expand-file-name package<span style="color: #9cb6ad;">)</span><span style="color: #2d9574;">)</span>
                <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">Else must just be a package</span>
                <span style="color: #2d9574;">(</span>package-install <span style="color: #9cb6ad;">(</span>intern package<span style="color: #9cb6ad;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span>

            <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">End</span>
</pre>
</div>

<p>
第一行的内容使得Emacs以batch模式来运行脚本,而不是以窗口模式来运行. 注意,第一行(bang line)的内容指明了你调用该脚本的方式,是可以随意修改的:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">:<span style="color: #2aa1ae; background-color: #292e34;">;</span><span style="color: #2aa1ae; background-color: #292e34;">exec emacs -batch -Q -l "$0" -f main "$@"</span>
</pre>
</div>

<p>
<code>main</code> 是被调用的函数名称,而 <code>$@</code> 是传递給shell的参数.
</p>

<p>
Emacs处理file的能力很强大,它的buffer机制能够很容易的完成那些用shell难以完成的任务.
</p>

<p>
想查找更多的Emacs Scrilpt请访问<a href="http://emacswiki.org/emacs/EmacsScripts">EmacsWiki</a>.
</p>
</div>
</div>

<div id="outline-container-org09d3c4a" class="outline-2">
<h2 id="org09d3c4a"><span class="section-number-2">10</span> EmacsLisp也能写面向对象的代码</h2>
<div class="outline-text-2" id="text-10">
<p>
<a href="http://news.ycombinator.com/item?id=3717715">某些社区强烈反对使用面向对象编程</a> ,但是在很多时候,面向对象编程其实也是很好用的,where you are trying to declare a category of things that are quite complex for example.
</p>

<p>
CommonLisp 有<a href="http://en.wikipedia.org/wiki/Common_Lisp_Object_System">CLOS</a> 库,其提供了一套很全面的面向对象编程API, EmacsLisp将之移植了过来,称为EIEIO.
</p>

<p>
下面是一个例子演示如何在EmacsLisp中定义类和方法:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defclass</span> <span style="color: #ce537a; font-weight: bold;">some-userc</span> nil
  <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>id
    <span style="color: #4f97d7;">:initarg</span> <span style="color: #4f97d7;">:id</span>
    <span style="color: #4f97d7;">:initform</span> <span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">lambda</span> <span style="color: #b1951d;">()</span> <span style="color: #b1951d;">(</span>some-user--make-uuid<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
    <span style="color: #4f97d7;">:documentation</span> <span style="color: #2aa1ae;">"The id of the person"</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>name
    <span style="color: #4f97d7;">:type</span> string
    <span style="color: #4f97d7;">:initarg</span> <span style="color: #4f97d7;">:name</span>
    <span style="color: #4f97d7;">:initform</span> <span style="color: #2d9574;">""</span>
    <span style="color: #4f97d7;">:documentation</span> <span style="color: #2aa1ae;">"Name of the person"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #2aa1ae;">"A user record."</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">some-user--make-uuid</span> <span style="color: #bc6ec5;">()</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">functions can be used by constructors</span>
  <span style="color: #2aa1ae;">"1213243"</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defmethod</span> <span style="color: #bc6ec5; font-weight: bold;">some-user-greeting</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>user some-userc<span style="color: #2d9574;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">this is a type specifier</span>
                               <span style="color: #ce537a; font-weight: bold;">&amp;optional</span> daytime<span style="color: #bc6ec5;">)</span>
  <span style="color: #2aa1ae;">"Methods are functions and have docstrings."</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">if</span> daytime
      <span style="color: #2d9574;">(</span>message <span style="color: #2d9574;">"good morning %s"</span> <span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">oref</span> user name<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>user <span style="color: #67b11d;">(</span>some-userc <span style="color: #2d9574;">"nic"</span> <span style="color: #4f97d7;">:name</span> <span style="color: #2d9574;">"nic ferrier"</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">make a user</span>
  <span style="color: #bc6ec5;">(</span>some-user-greeting user t<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">call the method</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org08966fc" class="outline-2">
<h2 id="org08966fc"><span class="section-number-2">11</span> 在写宏时,需要作一些设置</h2>
<div class="outline-text-2" id="text-11">
<p>
<code>eval-expression-print-level</code> 需要设置为 <code>nil</code> 这样才会显示出Emacs运行的所有的细节.
</p>
</div>
</div>

<div id="outline-container-orge9aaec5" class="outline-2">
<h2 id="orge9aaec5"><span class="section-number-2">12</span> 不要写太多的宏</h2>
<div class="outline-text-2" id="text-12">
<p>
宏的使用场景一般为:
</p>

<ul class="org-ul">
<li>隐藏获取资源的过程</li>
<li>构建领域特定语言</li>
<li>以及抽象控制流</li>
</ul>

<p>
所有这些场景中,只有第一种比较常见, the second is obvious when you need it and the
last you should think quite carefully before doing, it's normally for Lisp language hackers, not
hackers in Lisp language.
</p>

<p>
PS:并不是说你就不能写那些操作控制流的宏,而是说在写之前一定要想清楚.
</p>
</div>
</div>

<div id="outline-container-org31834fa" class="outline-2">
<h2 id="org31834fa"><span class="section-number-2">13</span> 闭包很酷,但也更难于调试</h2>
<div class="outline-text-2" id="text-13">
<p>
如果一个回调函数要用到外部数据,那么我们经常会将之封装成一个闭包:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>x somecapturedthing<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">lambda</span> <span style="color: #2d9574;">(</span>httpcon<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>real--implementation httpcon x<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
纯函数几乎总是私有函数,不过它也更易于调试.
It's also useful sometimes to separate stuff out like this temporarily. 
It's pretty easy to do quickly, it's probably easy enough that you could write some EmacsLisp to do it automatically.
</p>
</div>
</div>

<div id="outline-container-orge0ff698" class="outline-2">
<h2 id="orge0ff698"><span class="section-number-2">14</span> 阅读Manual</h2>
<div class="outline-text-2" id="text-14">
<p>
<a href="http://www.gnu.org/software/emacs/manual/">Emacs自带了很棒的文档</a> 包括了<a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/index.html">EmacsLisp本身的说明</a> 以及 <a href="http://www.gnu.org/software/emacs/manual/html_node/cl/index.html">CL库</a> 和<a href="http://www.gnu.org/software/emacs/manual/html_node/eieio/index.html">EIEIO库</a> 的说明.
</p>

<p>
EmacsWiki中的<a href="http://emacswiki.org/emacs/ElispCookbook">Elisp Cookbook</a> 也很不错.
</p>
</div>
</div>

<div id="outline-container-org7b491f1" class="outline-2">
<h2 id="org7b491f1"><span class="section-number-2">15</span> 勤提问题</h2>
<div class="outline-text-2" id="text-15">
<p>
有问题可以在<a href="http://stackoverflow.com/questions/tagged/elisp">StackOverflow</a>, <a href="http://www.reddit.com/r/emacs/">reddit</a> 或者 <a href="http://www.emacswiki.org/emacs/EmacsChannel">通过</a> <a href="irc://irc.freenode.net/%23emacs">IRC</a> 提问.
</p>
</div>
</div>

<div id="outline-container-org7c91a75" class="outline-2">
<h2 id="org7c91a75"><span class="section-number-2">16</span> 最后</h2>
<div class="outline-text-2" id="text-16">
<p>
上面就是所有我认为人们可能不是很清楚的地方了. 若你想使用Lisp编程,我建议使用EmacsLisp, 这是门很实用的语言,强烈推荐.
</p>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2016-11-28</span>
            <span title="last modification date" class="post-info">2016-11-28</span>
            <span title="tags" class="post-info">:N/A:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a></span>
        </div>
    <script src="https://lujun9972.github.io/emacs-document/media/js/jquery-2.1.3.min.js"></script>
        <section>
            <h1>Comments</h1>
            <div id="comment-wrap">
                    <a class="disqus_label">使用 Disqus 评论</a>
    </ul>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
         //var disqus_developer = 1;
         var preempt_signal=false;
         var disqus_identifier = "/blog/2016/11/28/emacslisp编程tips/";
         var disqus_url = "https://lujun9972.github.io/emacs-document/blog/2016/11/28/emacslisp编程tips/";
         var disqus_shortname = 'emacs-document';
         /* * * DON'T EDIT BELOW THIS LINE * * */
         (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
             $('#disqus_thread').css('display','none');
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    <script>
     /* comments */
     var ego_disqus_thread=$('#disqus_thread');
     var ego_ds_label=$('.ds-thread');
     $('.disqus_label').click(function(){
         ego_disqus_thread.show();
         ego_ds_label.hide();
     });
     $('.ds-label').click(function(){
         ego_disqus_thread.hide();
         ego_ds_label.show();
     });
    </script>
        </section>
    <script src="https://lujun9972.github.io/emacs-document/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="https://lujun9972.github.io/emacs-document//instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
