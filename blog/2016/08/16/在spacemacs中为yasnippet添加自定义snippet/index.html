<!DOCTYPE html>
<html lang="en">
<head>
  <title>在Spacemacs中为Yasnippet添加自定义snippet - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <!-- <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="../../../../../media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="../../../../../years/">Years</a></li>
        <li><a href="../../../../../authors/">Authors</a></li>
        <li><a href="../../../../../tags/">Tags</a></li>
        <li><a href="../../../../../about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">在Spacemacs中为Yasnippet添加自定义snippet</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgdfe2da8">1. Adding your private snippets to Spacemacs</a>
<ul>
<li><a href="#orgcf42a98">1.1. Managing your snippets</a></li>
</ul>
</li>
<li><a href="#org2b61c5a">2. How to write a snippet</a>
<ul>
<li><a href="#org8e5955b">2.1. Example: Simple text replacement</a></li>
<li><a href="#orga3c990b">2.2. Example: Using tab stops</a></li>
</ul>
</li>
<li><a href="#orga719dc5">3. Creating a snippet from existing text</a>
<ul>
<li><a href="#orga3935b7">3.1. Example: Create a simple text replacement</a></li>
</ul>
</li>
<li><a href="#org8b49826">4. Testing your snippets</a></li>
<li><a href="#org260a9c5">5. Adding yas-snippets to autocompletion in Spacemacs</a></li>
<li><a href="#org4280e8d">6. Summary</a></li>
</ul>
</div>
</div>
<p>
Yasnippet能够将少量的输入内容扩展为一个代码模板从而节省时间. YASnippet包含了大量特定mode下的snippets,它能将这些snippet扩展为任何东西,从简单的替换为另一段文本到一段允许你在各参数间遍历的代码块. 
在<a href="https://www.youtube.com/watch?v=-4O-ZYjQxks">这个视频中可以看到Yasnippet的演示</a>.
</p>

<p>
要使用某个snippet很简单,只需要输入缩写然后按下 <code>M-/</code> 就行了. 比如,在html-mode下输入 <code>div</code> 然后按下 <code>M-/</code> 就会扩展为 <code>&lt;div id="▮" class="▯"&gt;▯&lt;/div&gt;</code>. 并且光标放在让你输入id值的位置上,你再按一下 <code>TAB</code> 键就又会跳转到输入class值的位置,最后再按一下 <code>TAB</code> 会跳转到输入 <code>div</code> 内容的位置.
</p>

<p>
你也可以将yasnippet与自动补全功能整合起来,从自动补全菜单中选择想要的snippet.
</p>

<p>
Spacemacs对于它支持的语言大多内置了大量的snippets. 而且,YASnippets的模板系统也很容易学习. 下面就让我们看看在Spacemacs中如何自定义snippet吧.
</p>

<blockquote>
<p>
一般来说,yasnippets扩展函数的快捷键是TAB,但是该快捷键在Spacemacs被其他功能占用了,因此使用M-/代替该快捷键.
如果你想要的仅仅是纯粹的替换一段文本,你可以试试 <a href="http://ergoemacs.org/emacs/emacs_abbrev_mode.html">Emacs Abbrev mode</a>.
</p>
</blockquote>

<div id="outline-container-orgdfe2da8" class="outline-2">
<h2 id="orgdfe2da8"><span class="section-number-2">1</span> Adding your private snippets to Spacemacs</h2>
<div class="outline-text-2" id="text-1">
<p>
你可以将你自己的snippet定义文件放到 <code>~/.emacs.d/private/snippets</code> 目录下. 具体来说,你需要在该目录下创建一个与相关mode同名的文件夹(比如markdown-mode). 在这个文件夹中再以缩写为名创建snippet定义文件.
</p>

<p>
例如,若我要为markdown-mode定义一个缩写为wip的snippet,则我要创建的文件为 <code>~/.emacs.d/private/snippets/markdown-mode/wip</code>.
</p>

<p>
要使新snippet生效,你可以重启Spacemacs或者在snippet文件的buffer中运行 <code>M-x yas-load-snippet-buffer</code>. 随后该snippet就会在所有的markdown-mode buffer中生效了.
</p>
</div>

<div id="outline-container-orgcf42a98" class="outline-3">
<h3 id="orgcf42a98"><span class="section-number-3">1.1</span> Managing your snippets</h3>
<div class="outline-text-3" id="text-1-1">
<p>
虽然可以把自定义的snippet放在private snippets目录中,但该目录并没有纳入版本控制. 因此你不用担心自定义的snippet会被Spacemacs所覆盖,但也意味着这些snippets也不会被备份起来.
</p>

<p>
若你将自定义snippet放在 <code>~/.spacemacs.d/snippets/modename-mode/</code> 这样的目录下,则你就可以使用Git或类似的版本控制工具将之管理起来了.
</p>
</div>
</div>
</div>

<div id="outline-container-org2b61c5a" class="outline-2">
<h2 id="org2b61c5a"><span class="section-number-2">2</span> How to write a snippet</h2>
<div class="outline-text-2" id="text-2">
<p>
一般来说,每个snippet模板都存放在各自的文件中,且文件名与缩写一致. 因此一个缩写为 <code>wip</code> 的snippet定义在名为 <code>wip</code> 的文件中, 且该文件存放在以相关Emacs mode为名的目录中.
</p>

<p>
一个snippet模板的基本架构如下:
</p>

<pre class="example">
#key : the name of the snippet you type                                     
#name : A description of the snippet (this shows in autocompletion menu too)
#contributor: John Stevenson &lt;john@jr0cket.co.uk&gt;                           
# --                                                                        
Add the content you want to replace the snippet name with when it expands   
</pre>

<p>
其中的内容可以是简单的一段文本,也可以是一段包含占位符的代码结构,扩展后每次按下tab就会把光标跳转到下一个占位符的位置. 你甚至还可以在模板中使用Elisp代码.
</p>
</div>

<div id="outline-container-org8e5955b" class="outline-3">
<h3 id="org8e5955b"><span class="section-number-3">2.1</span> Example: Simple text replacement</h3>
<div class="outline-text-3" id="text-2-1">
<p>
我经常要用markdown mode来写东西. 当我写markdown时经常要凸出显示还有哪些章节是尚未完成的. 因此我创建了一个名为 <code>wip</code> 的snippet来帮我输入这段常用的信息.
</p>

<pre class="example">
#key : wip                                        
#name : WorkInProgress                            
#contributor: John Stevenson &lt;john@jr0cket.co.uk&gt; 
# --                                              
&gt; **Fixme** work in progress                      
</pre>

<p>
当你用 <code>M-/</code> 扩展这段snippet时,snippet的名字就会替代为它的内容了.
</p>
</div>
</div>

<div id="outline-container-orga3c990b" class="outline-3">
<h3 id="orga3c990b"><span class="section-number-3">2.2</span> Example: Using tab stops</h3>
<div class="outline-text-3" id="text-2-2">
<p>
html-mode下有一个名为form的snippet,让我们来看一下这个snippet. 该snippet会扩展为一个html form,同时允许你在method,id,action和content属性之间跳转.
</p>

<pre class="example">
#contributor : Jimmy Wu &lt;frozenthrone88@gmail.com&gt;      
#name :&lt;form method="..." id="..." action="..."&gt;&lt;/form&gt; 
# --                                                    
&lt;form method="$1" id="$2" action="$3"&gt;                  
  $0                                                    
&lt;/form&gt;                                                 
</pre>

<p>
这个snippet与上面那个简单的例子类似,不同之处在于它用$符和数字设置了占位符. 当扩展上面那个snippet时,snippet的名字也会被它的内容所替代,但不仅如此,光标也会放置在第一个定位符$1处.  每次你按下TAB键就会把光标移动到下一个定位符处.
</p>

<p>
$0表示snippet的退出点,在这个地方按下TAB键的作用与在YASnippet外的作用一致.
</p>
</div>
</div>
</div>

<div id="outline-container-orga719dc5" class="outline-2">
<h2 id="orga719dc5"><span class="section-number-2">3</span> Creating a snippet from existing text</h2>
<div class="outline-text-2" id="text-3">
<p>
创建新snippet的最快的方法莫过于直接利用snippet扩展后的内容了. 
</p>

<p>
若只是为了简单的文本替换,则你只需要选中扩展后的文本,然后调用 <code>helm-yas-create-snippet-on-region</code>, 保存自动生成的snippet为缩写名称就行了.
</p>

<p>
若需要创建带定位符的代码结构,则需要选中扩展后的代码结构,调用 <code>helm-yas-create-snippet-on-region</code>, 然后编辑snippet,用$1,$2,$3,$4之类的定位符替代里面的内容就好.
</p>
</div>

<div id="outline-container-orga3935b7" class="outline-3">
<h3 id="orga3935b7"><span class="section-number-3">3.1</span> Example: Create a simple text replacement</h3>
<div class="outline-text-3" id="text-3-1">
<p>
当我写博客时,我会用一个图片缩略图来指示文章的顶部. 我不想每次都手工录入这一段,因此我创建了一个snippet.
</p>

<p>
首先我选中新snippet要扩展成的内容,在本例中就是 <code>{% img img-thumbnail /images/spacemacs.png %}</code> .
</p>

<p>
然后我调用函数 <code>helm-yas-create-snippet-on-region</code>. 它会提示我输入该snippet所属的mode是那个,这里我输入 <code>markdown-mode</code>, 然后会提示输入该snippet文件存放的位置,输入 <code>~/.emacs/private/snippets/markdown-mode/imgtmb-spacemacs</code>. 然后就会有一个新的buffer创建出来了,且snippet的内容已经填好了.
</p>

<div class="org-src-container">
<pre class="src src-snippet"><span style="color: #2aa1ae; background-color: #292e34;"># -*- mode: snippet -*-                       </span>
<span style="color: #2aa1ae; background-color: #292e34;">#name : imgtmb-spacemacs                      </span>
<span style="color: #2aa1ae; background-color: #292e34;">#key : imgtmb-spacemacs                       </span>
<span style="color: #2aa1ae; background-color: #292e34;">#contributor : jr0cket                        </span>
<span style="color: #2aa1ae; background-color: #292e34;"># --                                          </span>
<span style="color: #4f97d7;">{</span>% img img-thumbnail /images/spacemacs.png %<span style="color: #4f97d7; font-weight: bold;">}</span> 
</pre>
</div>

<p>
这个新产生的snippet buffer中的name和key的值自动被设置为该snippet的文件名: imgtmb-spacemacs. snippet的主体内容也自动填充为我选择的文本了. 因此只需要保存这个snippet就行了.
</p>
</div>
</div>
</div>

<div id="outline-container-org8b49826" class="outline-2">
<h2 id="org8b49826"><span class="section-number-2">4</span> Testing your snippets</h2>
<div class="outline-text-2" id="text-4">
<p>
写好snippet后,可以通过运行 <code>M-x yas-tryout-snippet</code> 来测试一下. 该命令会在合适的major mode下新开一个空白的buffer,你可以在这个buffer中输入缩写,然后按下 <code>M-/</code> 测试该snippet.
</p>

<p>
若你想在已有的buffer中试用一下该snippet,需要先用 <code>M-x yas-load-snippet-buffer</code> 加载该snippet并关闭关闭该snippet buffer(必要时会提示保存该buffer).
</p>

<blockquote>
<p>
这些命令在Spacemacs中没有预设快捷键,不过你可以手工为它们设置快捷键. 这种快捷键一般以 <code>C-o</code> 为前缀,例如设置 <code>C-o C-s</code> 来测试snippet, <code>C-o C-s</code> 来加载snippet.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org260a9c5" class="outline-2">
<h2 id="org260a9c5"><span class="section-number-2">5</span> Adding yas-snippets to autocompletion in Spacemacs</h2>
<div class="outline-text-2" id="text-5">
<p>
在Spacemacs中启用autocompletion layer后,就能在自动补全菜单中显示YASnippets的内容了.
</p>

<p>
不过默认情况下,auto-completion是不会将snippet作为补全项的,你需要设置 <code>auto-completion-enable-snippets-in-popup</code> 为 <code>t</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq-default</span> dotspacemacs-configuration-layers
              '<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>auto-completion <span style="color: #4f97d7;">:variables</span>
                                 auto-completion-enable-snippets-in-popup t<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4280e8d" class="outline-2">
<h2 id="org4280e8d"><span class="section-number-2">6</span> Summary</h2>
<div class="outline-text-2" id="text-6">
<p>
想了解更多YASnippets与autocompletion的话,请查看<a href="https://github.com/syl20bnr/spacemacs/tree/master/layers/auto-completion">Github repository for Spacemacs autocompletion layer</a>.
</p>

<p>
想了解更多如何编写自定义的snipplet,参见下面这些链接:
</p>

<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=-4O-ZYjQxks">Emacs YASnippet video tutorial</a></li>
<li><a href="https://joaotavora.github.io/yasnippet/snippet-development.html">Snippet development</a>.</li>
<li><a href="http://jotham-city.com/blog/2015/03/21/adding-yasnippets-snippets/">Adding YASnippets snippets</a></li>
<li><a href="http://cupfullofcode.com/blog/2013/02/26/snippet-expansion-with-yasnippet/index.html">Snippet expansion with YASnippet</a></li>
</ul>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2016-08-16</span>
            <span title="last modification date" class="post-info">2016-08-16</span>
            <span title="tags" class="post-info">:N/A:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T520">lujun9972</a></span>
        </div>
    <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
    <script src="../../../../../media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="../../../../../media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T520">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="../../../../../instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
