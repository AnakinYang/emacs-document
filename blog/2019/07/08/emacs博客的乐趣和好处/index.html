<!DOCTYPE html>
<html lang="en">
<head>
  <title>Emacs博客的乐趣和好处 - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="org-mode" />
  <!-- <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="../../../../../media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="../../../../../years/">Years</a></li>
        <li><a href="../../../../../authors/">Authors</a></li>
        <li><a href="../../../../../tags/">Tags</a></li>
        <li><a href="../../../../../about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document.git">Github</a></li>
        <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Emacs博客的乐趣和好处</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgaf8ffa8">背景</a></li>
<li><a href="#orgf2c958a">设置</a>
<ul>
<li><a href="#orgd821461">Emacs配置</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
如果你读过这个博客，你可能会注意到它的一些不同之处,是的外观和感觉不同了，但不仅仅这么肤浅。
</p>

<p>
在过去的九年里，我一直用WordPress写博客,WordPress是一个功能丰富的博客平台。
但是，从今天开始，我将整个网站都切换到始于一项上世纪70年代的技术:Emacs，一款古老的文本编辑器。
</p>

<p>
我是疯了吗?不，我只是觉得它更适合我的工作流程。
</p>

<div id="outline-container-org0eed39e" class="outline-2">
<h2 id="orgaf8ffa8"><a id="org0eed39e"></a>背景</h2>
<div class="outline-text-2" id="text-orgaf8ffa8">
<p>
多年来我一直是Emacs的用户。Emacs不仅仅是一个文本编辑器:它是一把瑞士军刀，一个由其他工具组成的可扩展的工具. 其中一个工具是Org模式， 一种允许您组织思想，编写大纲，做笔记，做预算，做议程,时间线、写文档，等等工作。
</p>

<p>
Org模式非常强大，最近很多人都出于想用Org Mode的缘故而使用Emacs。<a href="https://orgmode.org/manual/index.html">在线手册</a>和<a href="https://orgmode.org/worg/">用户编写的文档</a>能够让你全面了解Org模式的功能。
</p>

<p>
Org模式特别擅长的一点是 <i>编写文档</i>. 在Org文档满是标记和链接后，你可以将其导出成HTML文档(或者LaTeX文档，PDF文档，等等……)
</p>
</div>
</div>

<div id="outline-container-org20a15f1" class="outline-2">
<h2 id="orgf2c958a"><a id="org20a15f1"></a>设置</h2>
<div class="outline-text-2" id="text-orgf2c958a">
<p>
这个站点的每个页面，包括所有的博客文章，都是独立文件。
它们都是通过一个单独的设置和一个单独的程序一起发布的命令，使用Org模式的= Org -publish=特性。
他们都通过Org Mode的 <code>org-publish</code> 功能，使用一份配置和一个命令来发布.
</p>

<p>
你可以<a href="https://github.com/sethm/loomcom/">这里Github上</a>看到完整的源代码。
</p>

<p>
配置并不太难。基本上，整个配置都在一个elisp文件中，被我的主 <code>init.el</code> 文件加载。
我将整个网站放在到一个名为 <code>~/Projects/loomcom</code> 工作目录中.
</p>

<p>
I'll go through my config bit by bit, but first, I must acknowledge
我将一点一点地带你过一便我的配置，但首先，我必须承认我的配置灵感来源于 Dennis Ogbe 的网站 (<a href="https://ogbe.net/">https://ogbe.net/</a>), 和他的博文 <a href="https://ogbe.net/blog/blogging_with_org.html">“只使用org-mode写博客”</a>.
</p>
</div>

<div id="outline-container-orgec674e1" class="outline-3">
<h3 id="orgd821461"><a id="orgec674e1"></a>Emacs配置</h3>
<div class="outline-text-3" id="text-orgd821461">
<p>
我要做的第一件事是定义一个名为 <code>loomcom/project-dir</code> 的符号, 这个符号将用在其他地方。它存放的是从 GitHub 签出网站所在的父文件夹陆军.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> loomcom/project-dir <span style="font-style: italic;">"~/Projects/loomcom/"</span>)
</pre>
</div>

<p>
然后我设置 org-publish 使用一个本地目录进行缓存,这样才不会污染我的HOME目录。
为了方便，我把这个目录放进去进 <code>.gitignore</code> 文件。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> org-publish-timestamp-directory (concat loomcom/project-dir <span style="font-style: italic;">"cache/"</span>))
</pre>
</div>

<p>
接下来，我设置另一个符号 <code>loomcom/extra-head</code>. 这个符号在后面会被用用于为每个页面的 <code>&lt;head&gt;...&lt;/head&gt;</code> 元素设置额外的HTML片段.
它基本上就是从 <code>/res/style.css</code> 加载CSS资源.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> loomcom/extra-head
      <span style="font-style: italic;">"&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"/res/style.css\"&gt;"</span>)
</pre>
</div>

<p>
然后我再定义两个符号, <code>loomcom/header-file</code> 和 <code>loomcom/footer</code>, 它们会注入两个HTML块:第一个是在插入到主要内容前的静态代码片段,第二个是在气候插入的字符串。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> loomcom/header-file
      (concat loomcom/project-dir <span style="font-style: italic;">"pages/header.html"</span>))

(<span style="font-weight: bold;">setq</span> loomcom/footer
      (concat
       <span style="font-style: italic;">"&lt;div id=\"footer\"&gt;n"</span>
       <span style="font-style: italic;">"&lt;p&gt;Seth Morabito&lt;/p&gt;n"</span>
       <span style="font-style: italic;">"&lt;p&gt;Proudly published with "</span>
       <span style="font-style: italic;">"&lt;a href=\"https://www.gnu.org/software/emacs/\"&gt;Emacs&lt;/a&gt; and "</span>
       <span style="font-style: italic;">"&lt;a href=\"https://orgmode.org/\"&gt;Org Mode&lt;/a&gt;"</span>
       <span style="font-style: italic;">"&lt;/div&gt;"</span>))
</pre>
</div>

<p>
然后我启用了 HTML5 fancy变量，这样Org模式就可以使用了新的HTML5特性。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> org-html-html5-fancy t)
</pre>
</div>

<p>
现在我们进入正题。
</p>

<p>
我不希望博客上的所有文章都放在一张网页上。
相反，我想只显示一个预览，若用户想看全文的话可以点击 <i>“Read More...”</i> 链接。
为此，我定义了一个名为 <code>loomcom/get-preview</code> 的函数, 它只返回博客主页上每篇博文的一部分.
</p>

<p>
Org模式没有内置该功能，所以我只能自己实现。
由于没有内置的语法，所以我在所有想在主页显示片段的博客文章中使用了一个特殊的(但毫无意义的)org-mode块，语法为:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="font-weight: bold; font-style: italic;">#+BEGIN_more</span>
<span style="font-weight: bold; font-style: italic;">#+END_more</span>
</pre>
</div>

<p>
下面的函数打开文件，查找这个标记，然后返回标题和标记之间的博客内容。如果没有标记，它会返回整个帖子。
</p>

<p>
它还返回一些元数据:一个指示是否渲染  <i>“Read More...”</i> 的布尔值
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">loomcom/get-preview</span> (filename)
  <span style="font-style: italic;">"Returns a list: '(&lt;needs-more&gt; &lt;preview-string&gt;) where</span>
<span style="font-style: italic;">&lt;needs-more&gt; is t or nil, indicating whether a \"Read More...\"</span>
<span style="font-style: italic;">link is needed."</span>
  (<span style="font-weight: bold;">with-temp-buffer</span>
    (insert-file-contents (concat loomcom/project-dir <span style="font-style: italic;">"blog/"</span> filename))
    (goto-char (point-min))
    (<span style="font-weight: bold;">let</span> ((content-start (<span style="font-weight: bold;">or</span>
                          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Look for the first non-keyword line</span>
                          (<span style="font-weight: bold;">and</span> (re-search-forward <span style="font-style: italic;">"^[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">#]"</span> nil t)
                               (match-beginning 0))
                          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Failing that, assume we're malformed and</span>
                          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">have no content</span>
                          (buffer-size)))
          (marker (<span style="font-weight: bold;">or</span>
                   (<span style="font-weight: bold;">and</span> (re-search-forward <span style="font-style: italic;">"^#\\+BEGIN_more$"</span> nil t)
                        (match-beginning 0))
                   (buffer-size))))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Return a pair of '(needs-more preview-string)</span>
      (list (not (= marker (buffer-size)))
</pre>
</div>

<p>
接下来是实际生成博客主页面的函数。 Org模式的发布功能称之为“Site Map”， 但是对于我的网站来说，它是一个博客页面。
</p>

<p>
默认情况下，Org模式将以项目符号列表的形式发布条目。
我不希望这样，所以重载了默认的发布函数。
它所做的就是在页面上放置一个标题并返回每个以 <code>nn</code> 分隔的条目。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">loomcom/sitemap</span> (title list)
  <span style="font-style: italic;">"Generate the sitemap (Blog Main Page)"</span>
  (concat <span style="font-style: italic;">"#+TITLE: "</span> title <span style="font-style: italic;">"\n"</span> <span style="font-style: italic;">"--------\n"</span>
          (string-join (mapcar #'car (cdr list)) <span style="font-style: italic;">"\n\n"</span>)))
</pre>
</div>

<p>
然后，我定义一个函数来为sitemap的每个博文页面生成条目。
</p>

<p>
该函数接受一个文件名，并将其传递给 <code>(loomcom/get-preview)</code> 来获得预览文本，在需要的时候添加 /“Read More...”/链接，并为每个条目返回Org Mode标记。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">loomcom/sitemap-entry</span> (entry style project)
  <span style="font-style: italic;">"Sitemap (Blog Main Page) Entry Formatter"</span>
  (<span style="font-weight: bold;">when</span> (not (directory-name-p entry))
    (format (string-join
             '(<span style="font-style: italic;">"* [[file:%s][%s]]\n"</span>
               <span style="font-style: italic;">"#+BEGIN_published\n"</span>
               <span style="font-style: italic;">"%s\n"</span>
               <span style="font-style: italic;">"#+END_published\n\n"</span>
               <span style="font-style: italic;">"%s\n"</span>
               <span style="font-style: italic;">"--------\n"</span>))
            entry
            (org-publish-find-title entry project)
            (format-time-string <span style="font-style: italic;">"%A, %B %_d %Y at %l:%M %p %Z"</span> (org-publish-find-date entry project))
            (<span style="font-weight: bold;">let*</span> ((preview (loomcom/get-preview entry))
                   (needs-more (car preview))
                   (preview-text (cadr preview)))
              (<span style="font-weight: bold;">if</span> needs-more
                  (format
                   (concat
                    <span style="font-style: italic;">"%s\n\n"</span>
                    <span style="font-style: italic;">"#+BEGIN_morelink\n"</span>
                    <span style="font-style: italic;">"[[file:%s][Read More...]]\n"</span>
                    <span style="font-style: italic;">"#+END_morelink\n"</span>)
                   preview-text entry)
                (format <span style="font-style: italic;">"%s"</span> preview-text))))))
</pre>
</div>

<p>
接下来，我定义一个被org-publish用来加载HTML头文件片段的函数.这个函数在一个临时buffer中打开头文件并返回内容。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">loomcom/header</span> (arg)
  (<span style="font-weight: bold;">with-temp-buffer</span>
    (insert-file-contents loomcom/header-file)
    (buffer-string)))
</pre>
</div>

<p>
最后是问题的关键部分。我使用 <code>org-publish-project-alist</code> 变量来设置 org-publish 项目。 
</p>

<p>
它定义了四个组件:
</p>

<ul class="org-ul">
<li><b>blog</b> - 存放所有博客条目的目录</li>
<li><b>pages</b> - 定义站点其余部分的静态页面</li>
<li><b>res</b> - CSS和JavaScript之类的资源文件</li>
<li><p>
<b>images</b> - 静态图像
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> org-publish-project-alist
      `((<span style="font-style: italic;">"loomcom"</span>
         <span style="font-weight: bold;">:components</span> (<span style="font-style: italic;">"blog"</span> <span style="font-style: italic;">"pages"</span> <span style="font-style: italic;">"res"</span> <span style="font-style: italic;">"images"</span>))
        (<span style="font-style: italic;">"blog"</span>
         <span style="font-weight: bold;">:base-directory</span> ,(concat loomcom/project-dir <span style="font-style: italic;">"blog/"</span>)
         <span style="font-weight: bold;">:base-extension</span> <span style="font-style: italic;">"org"</span>
         <span style="font-weight: bold;">:publishing-directory</span> ,(concat loomcom/project-dir <span style="font-style: italic;">"www/blog/"</span>)
         <span style="font-weight: bold;">:publishing-function</span> org-html-publish-to-html
         <span style="font-weight: bold;">:with-author</span> t
         <span style="font-weight: bold;">:with-creator</span> nil
         <span style="font-weight: bold;">:with-date</span> t
         <span style="font-weight: bold;">:section-numbers</span> nil
         <span style="font-weight: bold;">:with-title</span> t
         <span style="font-weight: bold;">:with-toc</span> nil
         <span style="font-weight: bold;">:with-drawers</span> t
         <span style="font-weight: bold;">:with-sub-superscript</span> nil
         <span style="font-weight: bold;">:html-doctype</span> <span style="font-style: italic;">"html5"</span>
         <span style="font-weight: bold;">:html-link-home</span> <span style="font-style: italic;">"/"</span>
         <span style="font-weight: bold;">:html-head</span> nil
         <span style="font-weight: bold;">:html-head-extra</span> ,loomcom/extra-head
         <span style="font-weight: bold;">:html-head-include-default-style</span> nil
         <span style="font-weight: bold;">:html-head-include-scripts</span> nil
         <span style="font-weight: bold;">:html-viewport</span> nil
         <span style="font-weight: bold;">:html-link-up</span> <span style="font-style: italic;">""</span>
         <span style="font-weight: bold;">:html-link-home</span> <span style="font-style: italic;">""</span>
         <span style="font-weight: bold;">:html-preamble</span> loomcom/header
         <span style="font-weight: bold;">:html-postamble</span> ,loomcom/footer
         <span style="font-weight: bold;">:auto-sitemap</span> t
         <span style="font-weight: bold;">:sitemap-function</span> loomcom/sitemap
         <span style="font-weight: bold;">:sitemap-format-entry</span> loomcom/sitemap-entry
         <span style="font-weight: bold;">:sitemap-filename</span> <span style="font-style: italic;">"index.org"</span>
         <span style="font-weight: bold;">:sitemap-title</span> <span style="font-style: italic;">"A Weblog"</span>
         <span style="font-weight: bold;">:sitemap-sort-files</span> anti-chronologically)
        (<span style="font-style: italic;">"pages"</span>
         <span style="font-weight: bold;">:base-directory</span> ,(concat loomcom/project-dir <span style="font-style: italic;">"pages/"</span>)
         <span style="font-weight: bold;">:base-extension</span> <span style="font-style: italic;">"org"</span>
         <span style="font-weight: bold;">:publishing-directory</span> ,(concat loomcom/project-dir <span style="font-style: italic;">"www/"</span>)
         <span style="font-weight: bold;">:publishing-function</span> org-html-publish-to-html
         <span style="font-weight: bold;">:section-numbers</span> nil
         <span style="font-weight: bold;">:recursive</span> t
         <span style="font-weight: bold;">:with-title</span> t
         <span style="font-weight: bold;">:with-toc</span> nil
         <span style="font-weight: bold;">:with-drawers</span> t
         <span style="font-weight: bold;">:with-sub-superscript</span> nil
         <span style="font-weight: bold;">:html-link-home</span> <span style="font-style: italic;">"/"</span>
         <span style="font-weight: bold;">:html-head</span> nil
         <span style="font-weight: bold;">:html-doctype</span> <span style="font-style: italic;">"html5"</span>
         <span style="font-weight: bold;">:html-head-extra</span> ,loomcom/extra-head
         <span style="font-weight: bold;">:html-head-include-default-style</span> nil
         <span style="font-weight: bold;">:html-head-include-scripts</span> nil
         <span style="font-weight: bold;">:html-link-up</span> <span style="font-style: italic;">""</span>
         <span style="font-weight: bold;">:html-link-home</span> <span style="font-style: italic;">""</span>
         <span style="font-weight: bold;">:html-preamble</span> loomcom/header
         <span style="font-weight: bold;">:html-postamble</span> ,loomcom/footer
         <span style="font-weight: bold;">:html-viewport</span> nil)
        (<span style="font-style: italic;">"res"</span>
         <span style="font-weight: bold;">:base-directory</span> ,(concat loomcom/project-dir <span style="font-style: italic;">"res/"</span>)
         <span style="font-weight: bold;">:base-extension</span> <span style="font-style: italic;">".*"</span>
         <span style="font-weight: bold;">:publishing-directory</span> ,(concat loomcom/project-dir <span style="font-style: italic;">"www/res/"</span>)
         <span style="font-weight: bold;">:publishing-function</span> org-publish-attachment)
        (<span style="font-style: italic;">"images"</span>
         <span style="font-weight: bold;">:base-directory</span> ,(concat loomcom/project-dir <span style="font-style: italic;">"images/"</span>)
         <span style="font-weight: bold;">:base-extension</span> <span style="font-style: italic;">".*"</span>
         <span style="font-weight: bold;">:publishing-directory</span> ,(concat loomcom/project-dir <span style="font-style: italic;">"www/images/"</span>)
         <span style="font-weight: bold;">:publishing-function</span> org-publish-attachment)))
</pre>
</div></li>
</ul>

<p>
唷。就是这样。
</p>
</div>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2019-07-08</span>
            <span title="last modification date" class="post-info">2020-01-30</span>
            <span title="tags" class="post-info">:<a href="../../../../../tags/org-mode">org-mode</a>:</span>
            <span title="author" class="post-info"><a href="mailto:travis &lt;at&gt; travis-job-6c8e0e41-0e15-45f0-b90b-e7b5c22b443e">lujun9972</a></span>
        </div>
    <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
    <script src="../../../../../media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="../../../../../media/js/main.js"></script>
        <script>
         var _hmt = _hmt || [];
         (function() {
             var hm = document.createElement("script");
             hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
         })();
        </script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-6c8e0e41-0e15-45f0-b90b-e7b5c22b443e">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="../../../../../instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
