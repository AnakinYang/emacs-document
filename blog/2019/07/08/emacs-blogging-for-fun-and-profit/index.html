<!DOCTYPE html>
<html lang="en">
<head>
  <title>Emacs Blogging for Fun and Profit - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="raw" />
  <!-- <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="../../../../../media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="../../../../../years/">Years</a></li>
        <li><a href="../../../../../authors/">Authors</a></li>
        <li><a href="../../../../../tags/">Tags</a></li>
        <li><a href="../../../../../about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document.git">Github</a></li>
        <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Emacs Blogging for Fun and Profit</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgaf8ffa8">Background</a></li>
<li><a href="#orgf2c958a">Setup</a>
<ul>
<li><a href="#orgd821461">Emacs Config</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
You may notice something quite different about this blog if you've
been here before. The look and feel is different, yes, but it's more
than just skin deep.
</p>

<p>
For the last nine years, I've kept my blog in WordPress, a very
capable blogging platform. But, starting today, I've switched my
entire website to a technology from the 1970s: Emacs, the venerable
text editor.
</p>

<p>
Am I crazy? No, I just think it suits my workflow better.
</p>

<div id="outline-container-orgb595018" class="outline-2">
<h2 id="orgaf8ffa8"><a id="orgb595018"></a>Background</h2>
<div class="outline-text-2" id="text-orgaf8ffa8">
<p>
I've been an Emacs user for many years. Emacs is more than just a text
editor: It's a swiss army knife, an extensible tool made of other
tools. One of those tools is Org Mode, a mode that lets you organize
thoughts, write outlines, keep notes, do budgets, keep agendas and
timelines, write documentation, and much more.
</p>

<p>
Org Mode is so powerful that many people who have come to Emacs in
recent years have done so specifically because they wanted to use Org
Mode. <a href="https://orgmode.org/manual/index.html">The on-line manual</a> and <a href="https://orgmode.org/worg/">user-written docs</a> are comprehensive and
give a full sense of Org Mode's capabilities.
</p>

<p>
One thing that Org Mode is especially good at is <i>writing
documentation</i>. Once a document has been captured in Org Mode,
complete with markup and links, it can be exported to an HTML document
(or a LaTeX document, or a PDF, or...)
</p>
</div>
</div>

<div id="outline-container-org40b15eb" class="outline-2">
<h2 id="orgf2c958a"><a id="org40b15eb"></a>Setup</h2>
<div class="outline-text-2" id="text-orgf2c958a">
<p>
Each page on this site, including all the blog entries, is in its own
file. They're all published together with a single setup and a single
command, using the <code>org-publish</code> feature of Org Mode.
</p>

<p>
You can see the source code in its entirety <a href="https://github.com/sethm/loomcom/">here on GitHub</a>.
</p>

<p>
Configuration wasn't too difficult. Basically, the whole config is in
one elisp file that I load into my master <code>init.el</code> file. I keep the
entire site checked out into a working directory,
<code>~/Projects/loomcom</code>.
</p>

<p>
I'll go through my config bit by bit, but first, I must acknowledge
Dennis Ogbe's website (<a href="https://ogbe.net/">https://ogbe.net/</a>), and his blog post <a href="https://ogbe.net/blog/blogging_with_org.html">“Blogging
using org-mode (and nothing else)”</a>, for being the inspiration for my
setup.
</p>
</div>

<div id="outline-container-orgb531a0b" class="outline-3">
<h3 id="orgd821461"><a id="orgb531a0b"></a>Emacs Config</h3>
<div class="outline-text-3" id="text-orgd821461">
<p>
The first thing I do is define a symbol, <code>loomcom/project-dir</code>, that
I'll use elsewhere. This is the parent folder, where my website is
checked out from GitHub.
</p>

<pre class="example">
(setq loomcom/project-dir "~/Projects/loomcom/")
</pre>

<p>
Then I set up org-publish to use a local directory for caching, so it
doesn't pollute my home directory. I conveniently put this directory
into my <code>.gitignore</code> file.
</p>

<pre class="example">
(setq org-publish-timestamp-directory (concat loomcom/project-dir "cache/"))
</pre>

<p>
Next, I set another symbol, <code>loomcom/extra-head</code>. I'll use this below
to set an extra bit of HTML set in each page's <code>&lt;head&gt;...&lt;/head&gt;</code>
element. This bit just says that it should load CSS from the
<code>/res/style.css</code> resource.
</p>

<pre class="example">
(setq loomcom/extra-head
 "&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"/res/style.css\"&gt;")
</pre>

<p>
Then I define two more symbols, <code>loomcom/header-file</code> and
<code>loomcom/footer</code>, that inject two blocks of HTML: The first is a
static snippet file that gets injected before the content, and the
second is in the form of a string that gets injected after the
content.
</p>

<pre class="example">
(setq loomcom/header-file
 (concat loomcom/project-dir "pages/header.html"))

(setq loomcom/footer
 (concat
 "&lt;div id=\"footer\"&gt;\n"
 "&lt;p&gt;Seth Morabito&lt;/p&gt;\n"
 "&lt;p&gt;Proudly published with "
 "&lt;a href=\"https://www.gnu.org/software/emacs/\"&gt;Emacs&lt;/a&gt; and "
 "&lt;a href=\"https://orgmode.org/\"&gt;Org Mode&lt;/a&gt;"
 "&lt;/div&gt;"))
</pre>

<p>
Then I turn on the HTML5 fancy variable, so that Org Mode will use
new HTML5 features.
</p>

<pre class="example">
(setq org-html-html5-fancy t)
</pre>

<p>
Now we get into the good stuff.
</p>

<p>
On my blog, I don't want to render every <i>full</i> post all on one page.
Instead, I'd like to include just a preview, and offer readers the
ability to click on a <i>“Read More...”</i> link if they wish to link to
the full post and read the rest. To do this, I define a function,
<code>loomcom/get-preview</code>, that returns just the part of each blog
document that should be shown on the main blog page.
</p>

<p>
Org Mode has no built-in facility for this, so I had to roll my own.
Since there's no built-in syntax, I use a special (but meaningless)
org-mode block in any blog post that I want to use just a snippet of
on the front page, using the syntax:
</p>

<pre class="example">
#+BEGIN_more
#+END_more
</pre>

<p>
The function below opens the file, looks for this marker, and returns
only the blog text between the header and the the marker. If there's
no marker, it will return the whole post.
</p>

<p>
It also returns a little bit of metadata: A boolean indicating whether
the <i>“Read More...”</i> link should be rendered or not.
</p>

<pre class="example">
(defun loomcom/get-preview (filename)
 "Returns a list: '(&lt;needs-more&gt; &lt;preview-string&gt;) where
&lt;needs-more&gt; is t or nil, indicating whether a \"Read More...\"
link is needed."
 (with-temp-buffer
 (insert-file-contents (concat loomcom/project-dir "blog/" filename))
 (goto-char (point-min))
 (let ((content-start (or
 ;; Look for the first non-keyword line
 (and (re-search-forward "^[^#]" nil t)
 (match-beginning 0))
 ;; Failing that, assume we're malformed and
 ;; have no content
 (buffer-size)))
 (marker (or
 (and (re-search-forward "^#\\+BEGIN_more$" nil t)
 (match-beginning 0))
 (buffer-size))))
 ;; Return a pair of '(needs-more preview-string)
 (list (not (= marker (buffer-size)))
 (buffer-substring content-start marker)))))
</pre>

<p>
Next is the function that actually generates the main blog page.
Org Mode's publish functionality refers to this as a “Site Map”,
but for the purposes of my site, it's a blog page.
</p>

<p>
By default, Org Mode will publish the entries as a bulleted list.
We don't want that, so we override the default publishing function.
All it does is put a title on the page and return each entry separated
by <code>\n\n</code>.
</p>

<pre class="example">
(defun loomcom/sitemap (title list)
 "Generate the sitemap (Blog Main Page)"
 (concat "#+TITLE: " title "\n" "--------\n"
 (string-join (mapcar #'car (cdr list)) "\n\n")))
</pre>

<p>
Then, I define a function that generates each entry for the sitemap /
blog page.
</p>

<p>
This function takes a file name, passes it to <code>(loomcom/get-preview)</code>
to get the preview text, adds a <i>“Read More...”</i> link if needed, and
returns the Org Mode markup for the entry.
</p>

<pre class="example">
(defun loomcom/sitemap-entry (entry style project)
 "Sitemap (Blog Main Page) Entry Formatter"
 (when (not (directory-name-p entry))
 (format (string-join
 '("* [[file:%s][%s]]\n"
 "#+BEGIN_published\n"
 "%s\n"
 "#+END_published\n\n"
 "%s\n"
 "--------\n"))
 entry
 (org-publish-find-title entry project)
 (format-time-string "%A, %B %_d %Y at %l:%M %p %Z" (org-publish-find-date entry project))
 (let* ((preview (loomcom/get-preview entry))
 (needs-more (car preview))
 (preview-text (cadr preview)))
 (if needs-more
 (format
 (concat
 "%s\n\n"
 "#+BEGIN_morelink\n"
 "[[file:%s][Read More...]]\n"
 "#+END_morelink\n")
 preview-text entry)
 (format "%s" preview-text))))))
</pre>

<p>
Next I define a function to be used by org-publish to load the HTML
header file snippet. This function just opens the header file in a
temp buffer and returns the contents.
</p>

<pre class="example">
(defun loomcom/header (arg)
 (with-temp-buffer
 (insert-file-contents loomcom/header-file)
 (buffer-string)))
</pre>

<p>
Finally, the meat of the matter. I set up the org-publish project
with the <code>org-publish-project-alist</code> variable.
</p>

<p>
It defines four components:
</p>

<ul class="org-ul">
<li><b>blog</b> - The directory containing all blog entries</li>
<li><b>pages</b> - Static pages that define the rest of the site</li>
<li><b>res</b> - Resources like CSS and JavaScript files</li>
<li><b>images</b> - Static images</li>
</ul>

<pre class="example">
(setq org-publish-project-alist
 `(("loomcom"
 :components ("blog" "pages" "res" "images"))
 ("blog"
 :base-directory ,(concat loomcom/project-dir "blog/")
 :base-extension "org"
 :publishing-directory ,(concat loomcom/project-dir "www/blog/")
 :publishing-function org-html-publish-to-html
 :with-author t
 :with-creator nil
 :with-date t
 :section-numbers nil
 :with-title t
 :with-toc nil
 :with-drawers t
 :with-sub-superscript nil
 :html-doctype "html5"
 :html-link-home "/"
 :html-head nil
 :html-head-extra ,loomcom/extra-head
 :html-head-include-default-style nil
 :html-head-include-scripts nil
 :html-viewport nil
 :html-link-up ""
 :html-link-home ""
 :html-preamble loomcom/header
 :html-postamble ,loomcom/footer
 :auto-sitemap t
 :sitemap-function loomcom/sitemap
 :sitemap-format-entry loomcom/sitemap-entry
 :sitemap-filename "index.org"
 :sitemap-title "A Weblog"
 :sitemap-sort-files anti-chronologically)
 ("pages"
 :base-directory ,(concat loomcom/project-dir "pages/")
 :base-extension "org"
 :publishing-directory ,(concat loomcom/project-dir "www/")
 :publishing-function org-html-publish-to-html
 :section-numbers nil
 :recursive t
 :with-title t
 :with-toc nil
 :with-drawers t
 :with-sub-superscript nil
 :html-link-home "/"
 :html-head nil
 :html-doctype "html5"
 :html-head-extra ,loomcom/extra-head
 :html-head-include-default-style nil
 :html-head-include-scripts nil
 :html-link-up ""
 :html-link-home ""
 :html-preamble loomcom/header
 :html-postamble ,loomcom/footer
 :html-viewport nil)
 ("res"
 :base-directory ,(concat loomcom/project-dir "res/")
 :base-extension ".*"
 :publishing-directory ,(concat loomcom/project-dir "www/res/")
 :publishing-function org-publish-attachment)
 ("images"
 :base-directory ,(concat loomcom/project-dir "images/")
 :base-extension ".*"
 :publishing-directory ,(concat loomcom/project-dir "www/images/")
 :publishing-function org-publish-attachment)))
</pre>

<p>
Whew. That's all there is to it.
</p>
</div>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2019-07-08</span>
            <span title="last modification date" class="post-info">2019-07-08</span>
            <span title="tags" class="post-info">:<a href="../../../../../tags/raw">raw</a>:</span>
            <span title="author" class="post-info"><a href="mailto:travis &lt;at&gt; travis-job-74968892-59bb-45a4-9cc7-483b8e648750">lujun9972</a></span>
        </div>
    <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
    <script src="../../../../../media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="../../../../../media/js/main.js"></script>
        <script>
         var _hmt = _hmt || [];
         (function() {
             var hm = document.createElement("script");
             hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
         })();
        </script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-74968892-59bb-45a4-9cc7-483b8e648750">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="../../../../../instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
