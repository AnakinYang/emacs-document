<!DOCTYPE html>
<html lang="en">
<head>
  <title>Power up Anki with Emacs, Org mode, anki-editor and more - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="raw" />
  <!-- <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="../../../../../media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="../../../../../years/">Years</a></li>
        <li><a href="../../../../../authors/">Authors</a></li>
        <li><a href="../../../../../tags/">Tags</a></li>
        <li><a href="../../../../../about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document.git">Github</a></li>
        <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Power up Anki with Emacs, Org mode, anki-editor and more</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#emacs-org-mode-as-editor-to-anki">Emacs/Org-mode as editor to Anki</a></li>
<li><a href="#org-capture-swiftly-create-cards">Org-capture: Swiftly create cards</a></li>
<li><a href="#org-download-flameshot-add-image-too">org-download + Flameshot: Add image too</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>
</div>
<p>
12 Jan 2020
</p>

<p>
It's been a while since the last post, one reason is that for the past few months I've been drawn to <a href="https://apps.ankiweb.net/">Anki</a>, the spaced-repetition flashcard program. If you haven't checked it out yet, I strongly recommended it. (<a href="http://augmentingcognition.com/ltm.html">Why? Read Michael Nielson's article</a>)
</p>

<p>
One question recurred among Anki community is how to generate cards quickly. 3 approaches are common:
</p>

<ol class="org-ol">
<li>Use Anki's “Import” function to read csv/tsv</li>
<li>Write Python scripts with <a href="https://github.com/kerrickstaley/genanki">genanki</a> that generate <code>.apkg</code> for import</li>
<li>Use third-party browser plugin that supports <a href="https://ankiweb.net/shared/info/2055492159">AnkiConnect</a> (e.g. <a href="https://foosoft.net/projects/yomichan/">yomichan</a>)</li>
</ol>

<p>
While these are viable and oftentimes powerful options, for users they usually don't come as flexible for customization (change matching of columns &amp; fields, ad-hoc editing, formula/highlight/table/etc support). Programming experience is yet another entry barrier for many people.
</p>

<p>
In this post I'll try to demonstrate some workflows of creating cards in Emacs based on <a href="https://github.com/louietan/anki-editor">anki-editor</a>, a package that connects Emacs's Org-mode and AnkiConnect. Combining <code>anki-editor</code>'s connectivity, Emacs's customizability, and Org-mode's rich formatting and export support, a few card generation scenarios can be handled with ease:
</p>

<ul class="org-ul">
<li>Utilize a powerful editor for card editing</li>
<li>Capture ideas with least interruption as you encounter interesting content</li>
<li>Customize shortcut keys and workflow, minimize mouse pointing/clicking</li>
<li>etc...</li>
</ul>

<p>
<b>Note for Anki users who hear of Org-mode for the first time</b>: Take a look at <a href="https://www.youtube.com/watch?v=fgizHHd7nOo">John Kitchin - org mode is awesome</a> to have a grasp of Org's capability. (Find a pencil and mark down the date, it may become commemorable later :)). If you already knew that Org can do outline-structured editing, has tagging system and rich export support, you should be able to follow the post fine.
</p>

<p>
<b>Note for setup</b>: Most setup is done in Emacs configuration language, Emacs Lisp, under Linux. I will point out where I think is relevant to explain the details, and provide download at the end of article. But as always, YMMV in other platforms. If you are not sure how to configure, comment below, take a look at <a href="https://github.com/yiufung/dot-emacs/blob/master/init.el">my init.el</a>, or join the friendly <a href="https://www.reddit.com/r/emacs/">r/emacs</a>, <a href="https://www.reddit.com/r/orgmode/">r/orgmode</a> and raise your hand.
</p>

<div id="outline-container-orgfd70f95" class="outline-2">
<h2 id="emacs-org-mode-as-editor-to-anki"><a id="orgfd70f95"></a>Emacs/Org-mode as editor to Anki</h2>
<div class="outline-text-2" id="text-emacs-org-mode-as-editor-to-anki">
<p>
An Anki note is represented as an Org entry with <a href="https://orgmode.org/manual/Property-syntax.html#Property-syntax">property</a> <code>ANKI_NOTE_TYPE</code>. Each subheading of the entry corresponds to a <code>field</code> in Anki. <a href="https://orgmode.org/manual/Tags.html">Tags</a> can be synchronized to Anki. <code>anki-editor</code> uses property value <code>ANKI_NOTE_ID</code> to synchronized an Org entry and corresponding Anki note.
</p>

<p>
Upon pushing to Anki, <code>anki-editor</code> will export Org tree as Anki-compatible HTML. However, without a proper CSS file it will still look plain. So we replace it with <a href="https://github.com/gongzhitaao/orgcss">gongzhitaao/orgcss</a>, a simple stylesheet for Org-exported HTML, to obtain a proper styling for source code blocks, lists, tables, etc. (Download at the end of article)
</p>

<p>
Apart from “Basic”, another commonly-used note type is Cloze Deletion.
</p>

<pre class="example">
(use-package anki-editor
 :after org
 :bind (:map org-mode-map
 ("&lt;f12&gt;" . anki-editor-cloze-region-auto-incr)
 ("&lt;f11&gt;" . anki-editor-cloze-region-dont-incr)
 ("&lt;f10&gt;" . anki-editor-reset-cloze-number)
 ("&lt;f9&gt;" . anki-editor-push-tree))
 :config
 (setq anki-editor-create-decks t ;; Allow anki-editor to create a new deck if it doesn't exist
 anki-editor-org-tags-as-anki-tags t)

 (defun anki-editor-cloze-region-auto-incr (&amp;optional arg)
 "Cloze region without hint and increase card number."
 (interactive)
 (anki-editor-cloze-region my-anki-editor-cloze-number "")
 (setq my-anki-editor-cloze-number (1+ my-anki-editor-cloze-number))
 (forward-sexp))
 (defun anki-editor-cloze-region-dont-incr (&amp;optional arg)
 "Cloze region without hint using the previous card number."
 (interactive)
 (anki-editor-cloze-region (1- my-anki-editor-cloze-number) "")
 (forward-sexp))
 (defun anki-editor-reset-cloze-number (&amp;optional arg)
 "Reset cloze number to ARG or 1"
 (interactive)
 (setq my-anki-editor-cloze-number (or arg 1)))
 (defun anki-editor-push-tree ()
 "Push all notes under a tree."
 (interactive)
 (anki-editor-push-notes '(4))
 (anki-editor-reset-cloze-number))
 ;; Initialize
 (anki-editor-reset-cloze-number)
 )
</pre>

<ul class="org-ul">
<li>By default <code>anki-editor-cloze-{dwim,region}</code> always asks for hints and requires card number input. I don't use hints much, and usually want card number to increase, so two helper functions <code>anki-editor-cloze-region-{auto-incr,dont-incr}</code> are written to skip these behaviors. (Note: Such kind of customizations are ubiquitous in Emacs community, where users don't have to wait for upstream to implement a desired new feature. This is quite different from Anki community where version updates frequently break existing add-ons, leaving end-users hands tied, or new features being delayed due to technical difficulty in understanding the code base.)</li>
<li>By default <code>anki-editor-push-notes</code> will push the whole file. This is slow when the file contain old entries that didn't really need to change. In my workflow, I keep all pending notes under <code>Dispatch Shelf</code> subtree, and push that whole subtree (with <code>&lt;f9&gt;</code>) when I feel ready. Once they're pushed, I would <a href="https://orgmode.org/manual/Refile-and-copy.html#Refile-and-copy">refile</a>/relocate them under <code>Exported</code> subtree. <code>anki-editor-push-tree</code> is added for this purpose.</li>
<li>Assign handy keybindings (<code>&lt;f9&gt;-&lt;f12&gt;</code> in this case) to your liking.</li>
</ul>
</div>
</div>

<div id="outline-container-orgb24ab9a" class="outline-2">
<h2 id="org-capture-swiftly-create-cards"><a id="orgb24ab9a"></a>Org-capture: Swiftly create cards</h2>
<div class="outline-text-2" id="text-org-capture-swiftly-create-cards">
<p>
Now that we know what a proper Anki note should look like in Org-mode, we can define a template and use <code>org-capture</code> to create cards swiftly as we came across different materials on web.
</p>

<pre class="example">
;; Org-capture templates
(setq org-my-anki-file "/path/to/your/anki.org")
(add-to-list 'org-capture-templates
 ("a" "Anki basic"
 entry
 (file+headline org-my-anki-file "Dispatch Shelf")
 "* %&lt;%H:%M&gt; %^g\n:PROPERTIES:\n:ANKI_NOTE_TYPE: Basic\n:ANKI_DECK: Mega\n:END:\n** Front\n%?\n** Back\n%x\n"))
(add-to-list 'org-capture-templates
 ("A" "Anki cloze"
 entry
 (file+headline org-my-anki-file "Dispatch Shelf")
 "* %&lt;%H:%M&gt; %^g\n:PROPERTIES:\n:ANKI_NOTE_TYPE: Cloze\n:ANKI_DECK: Mega\n:END:\n** Text\n%x\n** Extra\n"))

;; Allow Emacs to access content from clipboard.
(setq x-select-enable-clipboard t
 x-select-enable-primary t)
</pre>

<ul class="org-ul">
<li><a href="https://youtu.be/fgizHHd7nOo?t=203">What's org-capture?</a></li>
<li>Note the <code>%x</code> in <code>org-capture-templates</code>: this means we want to fill in content of X clipboard upon capture. For Cloze note, this would be in <code>Text</code> field. For Basic note, I usually like to put them in <code>Back</code>, and come up with a good question for <code>Front</code> field.</li>
<li>The key to be as lazy as possible is to let Emacs not only read explicitly copied/paste content (via <code>C-c</code> / <code>C-v</code>, the <code>CLIPBOARD</code> selection), but also the <b>currently selected text</b> (the <code>PRIMARY</code> selection). That way, after highlighting text with mouse I can immediately call <code>org-capture (C-c c)</code> in Emacs. See <a href="https://wiki.archlinux.org/index.php/Clipboard">Clipboard - ArchWiki</a> for details.</li>
<li>Header name does not really matter in <code>anki-editor</code>, <code>%H:%M</code> is an arbitrary choice</li>
<li>I put most notes in a <code>Mega</code> deck following Michael Nielson's advice (<a href="http://augmentingcognition.com/ltm.html">Search “Use one big deck”</a>). It served me well. If you have many decks/note types, you may want to create multiple capture templates, or write some elisp functions to reduce typing.</li>
</ul>

<p>
Enabling X clipboard support makes Emacs versatile for textual input from any other applications. For me it's mainly web articles from Firefox, and sometimes books in PDF.js ... Or, do I really need PDF.js when I can read books in <a href="https://github.com/politza/pdf-tools"><code>pdf-tools</code></a>, the best PDF reader in Emacs?
</p>

<p>
Emacs command <code>fill-paragraph (M-q)</code> comes handy for aligning irregular-shaped text copied from PDF.
</p>
</div>
</div>

<div id="outline-container-orga65d7fb" class="outline-2">
<h2 id="org-download-flameshot-add-image-too"><a id="orga65d7fb"></a>org-download + Flameshot: Add image too</h2>
<div class="outline-text-2" id="text-org-download-flameshot-add-image-too">
<p>
Lastly, it's also good to use screen crop as note content. Thankfully <code>anki-editor</code> also supports that, we only need to find a convenient way to download image in Emacs.
</p>

<p>
There are many packages for adding images to Emacs, as well as for screenshots. I chose the combination of <a href="https://github.com/abo-abo/org-download">abo-abo/org-download</a> and <a href="https://github.com/lupoDharkael/flameshot">Flameshot</a>. While Flameshot allows me to add preliminary annotation, it's a little tricky to get it working properly. Curious minds may search “flameshot” in <a href="https://github.com/yiufung/dot-emacs/blob/master/init.el">my config</a> for details.
</p>
</div>
</div>

<div id="outline-container-org16d3316" class="outline-2">
<h2 id="conclusion"><a id="org16d3316"></a>Conclusion</h2>
<div class="outline-text-2" id="text-conclusion">
<p>
This setup has served me well in the past few months. During daytime, as I was writing code in Emacs or browsing web articles, I may capture code snippets or interesting information without switching to Anki Desktop to do much clicking. At nighttime I would polish the notes (fixing typo, adding context/images), push them in one go and call it a day.
</p>

<p>
The possibilities don't end there. Given Org's capabilities, I'm sure there are more interesting applications. Here are some I have in mind:
</p>

<ul class="org-ul">
<li><a href="https://orgmode.org/worg/org-contrib/babel/">Org Babel</a> to evaluate code block in place, pushing <b>both code and output</b> (plain text, images, tables) to Anki: <a href="https://github.com/mjago/ob-lilypond"><code>ob-lilypond</code></a>, <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-dot.html"><code>ob-dot</code></a>, <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-R.html">ob-R</a></li>
<li>Use <a href="https://www.youtube.com/watch?v=JfZ9fCHzkJw">keyboard macro</a> to create cards in bulk, quickly</li>
<li>An <a href="https://en.wikipedia.org/wiki/Incremental_reading">Incremental Reading</a> system may be built from utilities that centered on plain/PDF/EPUB(<a href="https://github.com/wasamasa/nov.el">nov.el</a>) text processing, and that integrate with <a href="https://github.com/weirdNox/org-noter"><code>org-noter</code></a> (note taking with <code>pdf-tools</code>), <a href="https://github.com/jkitchin/org-ref"><code>org-ref</code></a> (academic paper management), <code>org-capture</code> (content capture), <a href="https://www.google.com/search?q=org-agenda"><code>org-agenda</code></a> (schedule/deadline reminder, progress tracking)...</li>
<li>An Emacs distribution that is solely designed to smooth out learning curve for users from Anki community, just as what Spacemacs is for Vimmers, encompassing above-mentioned features with reasonable defaults</li>
<li>etc...</li>
</ul>

<p>
Hope it's useful for users from either Anki or Emacs, and I'm sure there will be bold, imaginative design that stemmed from the intersection of both. Until next time, happy hacking, learning and living under the sun!
</p>

<p>
Download files used in this post:
</p>

<ul class="org-ul">
<li><a href="https://yiufung.net/ox-hugo/anki-cards.el">anki-cards.el</a>: configuration code in this article</li>
<li><a href="https://yiufung.net/ox-hugo/anki-basic.css">anki-basic.css</a>: css template for basic cards. It's simply a concatentation of <code>org.css</code>, <code>htmlize.css</code> and <code>normalize.css</code> from <a href="https://github.com/gongzhitaao/orgcss/">gongzhitaao/orgcss</a></li>
<li><a href="https://yiufung.net/ox-hugo/anki-org-sample.org">anki-org-sample.org</a>: a sample org file demonstrating the use of file-local tags and options</li>
</ul>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2020-01-14</span>
            <span title="last modification date" class="post-info">2020-01-30</span>
            <span title="tags" class="post-info">:<a href="../../../../../tags/raw">raw</a>:</span>
            <span title="author" class="post-info"><a href="mailto:travis &lt;at&gt; travis-job-ddbb1491-6fd9-486d-82d3-954bcb776ea9">lujun9972</a></span>
        </div>
    <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
    <script src="../../../../../media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="../../../../../media/js/main.js"></script>
        <script>
         var _hmt = _hmt || [];
         (function() {
             var hm = document.createElement("script");
             hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
         })();
        </script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-ddbb1491-6fd9-486d-82d3-954bcb776ea9">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="../../../../../instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
