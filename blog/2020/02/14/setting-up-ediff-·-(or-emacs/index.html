<!DOCTYPE html>
<html lang="en">
<head>
  <title>Setting up Ediff · (or emacs - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="raw" />
  <!-- <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="../../../../../media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="../../../../../years/">Years</a></li>
        <li><a href="../../../../../authors/">Authors</a></li>
        <li><a href="../../../../../tags/">Tags</a></li>
        <li><a href="../../../../../about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document.git">Github</a></li>
        <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Setting up Ediff · (or emacs</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#setting-up-ediff">Setting up Ediff</a>
<ul>
<li><a href="#customizing-the-customize">Customizing the <code>customize</code></a></li>
<li><a href="#changing-some-ediff-options">Changing some Ediff options</a></li>
<li><a href="#changing-some-ediff-key-bindings">Changing some Ediff key bindings</a></li>
<li><a href="#restoring-the-windows-after-ediff-quits">Restoring the windows after Ediff quits</a></li>
<li><a href="#list-of-ways-that-i-use-to-invoke-ediff">List of ways that I use to invoke Ediff</a>
<ul>
<li><a href="#from-magit">from <code>magit</code></a></li>
<li><a href="#other-methods">other methods</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org93fd5b7" class="outline-2">
<h2 id="setting-up-ediff"><a id="org93fd5b7"></a>Setting up Ediff</h2>
<div class="outline-text-2" id="text-setting-up-ediff">
<p>
Once you make Ediff bearable, it becomes wonderful. At least this was my experience. It's a very good tool, but some of the defaults look very poor to me.
</p>
</div>

<div id="outline-container-orgeff1f60" class="outline-3">
<h3 id="customizing-the-customize"><a id="orgeff1f60"></a>Customizing the <code>customize</code></h3>
<div class="outline-text-3" id="text-customizing-the-customize">
<p>
First of all, I'll list a macro that I've started to use for setting custom variables:
</p>

<pre class="example">
(defmacro csetq (variable value)
 `(funcall (or (get ',variable 'custom-set)
 'set-default)
 ',variable ,value))
</pre>

<p>
This macro I've put together myself after searching though the code base and not finding something similar; <code>custom-set-variables</code> comes close to what I want, or maybe <code>custom-initialize-changed</code>. Basically all I want is a <code>setq</code> that is aware of the <code>custom-set</code> property of a variable. If you know such a macro, please let me know.
</p>
</div>
</div>

<div id="outline-container-orgb3d212e" class="outline-3">
<h3 id="changing-some-ediff-options"><a id="orgb3d212e"></a>Changing some Ediff options</h3>
<div class="outline-text-3" id="text-changing-some-ediff-options">
<p>
Now, that I've explained the custom setter (by the way, using <code>custom-set-variables</code> is absolutely equivalent to <code>csetq</code>), here are my changes:
</p>

<ol class="org-ol">
<li><p>
Don't use the weird setup with the control panel in a separate frame. I can manage windows in Emacs much better than my desktop (Unity or Gnome Shell) can manage the Emacs frames.
</p>

<pre class="example">
(csetq ediff-window-setup-function 'ediff-setup-windows-plain)
</pre></li>

<li><p>
Split the windows horizontally instead of vertically. This way, it's much easier to follow the changes.
</p>

<pre class="example">
(csetq ediff-split-window-function 'split-window-horizontally)
</pre></li>

<li><p>
Ignore white space. I don't write a lot of Python, so I don't care about the white space in the diffs. At the same time, I re-format any LISP code that I edit to my liking, and I want to see only the important changes in the diff, and not the whitespace nonsense.
</p>

<pre class="example">
(csetq ediff-diff-options "-w")
</pre></li>
</ol>
</div>
</div>

<div id="outline-container-org77d6a43" class="outline-3">
<h3 id="changing-some-ediff-key-bindings"><a id="org77d6a43"></a>Changing some Ediff key bindings</h3>
<div class="outline-text-3" id="text-changing-some-ediff-key-bindings">
<p>
This is just the standard stuff that I like to do for each mode that does not self-insert: assign j to move down, and k to move up.
</p>

<pre class="example">
(defun ora-ediff-hook ()
 (ediff-setup-keymap)
 (define-key ediff-mode-map "j" 'ediff-next-difference)
 (define-key ediff-mode-map "k" 'ediff-previous-difference))

(add-hook 'ediff-mode-hook 'ora-ediff-hook)
</pre>
</div>
</div>

<div id="outline-container-org983cab2" class="outline-3">
<h3 id="restoring-the-windows-after-ediff-quits"><a id="org983cab2"></a>Restoring the windows after Ediff quits</h3>
<div class="outline-text-3" id="text-restoring-the-windows-after-ediff-quits">
<p>
When you quit an Ediff session with q, it just leaves the two diff windows around, instead of restoring the window configuration from when Ediff was started. Here's the (slightly hacky) code to restore the old window configuration:
</p>

<pre class="example">
(winner-mode)
(add-hook 'ediff-after-quit-hook-internal 'winner-undo)
</pre>
</div>
</div>

<div id="outline-container-orgb0dd580" class="outline-3">
<h3 id="list-of-ways-that-i-use-to-invoke-ediff"><a id="orgb0dd580"></a>List of ways that I use to invoke Ediff</h3>
<div class="outline-text-3" id="text-list-of-ways-that-i-use-to-invoke-ediff">
</div>

<div id="outline-container-orgd7b0f5b" class="outline-4">
<h4 id="from-magit"><a id="orgd7b0f5b"></a>from <code>magit</code></h4>
<div class="outline-text-4" id="text-from-magit">
<p>
In 80% of the cases, I call Ediff with e (<code>magit-ediff</code>) from <code>magit-status-mode</code>. This gives me a better overview of the changes, especially when I want to revert stuff with either a (<code>ediff-copy-A-to-B</code>) or b (<code>ediff-copy-B-to-A</code>). Probably with a, since <a href="https://github.com/magit/magit">magit</a> seems to consistently put the <code>@{index}</code> file into the <code>A</code> diff window, and the current file into the <code>B</code> window.
</p>

<p>
So if I'm looking at a diff (to which I navigated with j/k), I can revert it with a. At this point, the diff region in the current file will become equal to that of the index file. But it will not be saved yet. If I want to save the current file in the <code>B</code> window, I can do it with wb (<code>ediff-save-buffer</code>). After a revert, it's also useful to call !(<code>ediff-update-diffs</code>), which will remove the zero-length diffs and update the diff-count in the mode-line.
</p>
</div>
</div>

<div id="outline-container-org48af0e6" class="outline-4">
<h4 id="other-methods"><a id="org48af0e6"></a>other methods</h4>
<div class="outline-text-4" id="text-other-methods">
<ol class="org-ol">
<li><code>ediff-buffers</code> will diff two (different) buffers. If you happen to have only two windows open with the appropriate buffers, you get them as defaults and can choose them quickly with RET RET.</li>
<li><code>ediff-files</code> is similar, but works on files instead. I like to just mark the appropriate files in <code>dired</code> with m, then they also get auto-selected by <code>ediff-files</code>.</li>
<li><code>ediff-current-file</code> is useful to see the unsaved changes to the current file. I rarely use it, since I have a compulsion to save every file every chance I get. There is little hope to recover from this addiction, unless someone implements an analogue of <a href="https://github.com/bbatsov/guru-mode">guru-mode</a> that annoys you when you try to save a file. Actually, it's not a bad idea - C-x C-s:</li>
</ol>

<blockquote>
<p>
Oleh, you have saved this file <code>40 times</code> in the last hour; the last
save was <code>0 minutes 34 seconds ago</code>; since then, you've changed <code>27 bytes</code> of information. Are you <b>sure</b> you want to save <code>[y/N]</code>?
</p>
</blockquote>
</div>
</div>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2020-02-14</span>
            <span title="last modification date" class="post-info">2020-02-14</span>
            <span title="tags" class="post-info">:<a href="../../../../../tags/raw">raw</a>:</span>
            <span title="author" class="post-info"><a href="mailto:travis &lt;at&gt; travis-job-ffeba6d8-dcae-4bdf-9f89-daded2ca07b1">lujun9972</a></span>
        </div>
    <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
    <script src="../../../../../media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="../../../../../media/js/main.js"></script>
        <script>
         var _hmt = _hmt || [];
         (function() {
             var hm = document.createElement("script");
             hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
         })();
        </script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-ffeba6d8-dcae-4bdf-9f89-daded2ca07b1">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="../../../../../instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
