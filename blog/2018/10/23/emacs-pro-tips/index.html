<!DOCTYPE html>
<html lang="en">
<head>
  <title>Emacs Pro-tips - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="raw" />
  <!-- <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="https://lujun9972.github.io/emacs-document/">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="https://lujun9972.github.io/emacs-document/years/">Years</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/authors/">Authors</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/tags/">Tags</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Emacs Pro-tips</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org629126e">Emacsclient and Emacs server (daemon)</a></li>
<li><a href="#orgac72560">Initialization file architecture</a>
<ul>
<li><a href="#orge771a4c">Major-modes configuration package</a></li>
<li><a href="#org045ab4c">Package management</a></li>
</ul>
</li>
<li><a href="#org777b16a">Helm</a></li>
<li><a href="#org4e15ba0">Update to latest Emacs version</a></li>
<li><a href="#org661635e">Cache folder</a></li>
<li><a href="#org0a3e227">Streamline indentation</a></li>
<li><a href="#orgdd00133">Elisp “go to definition”</a></li>
<li><a href="#orgd3983ca">Smart compilation</a></li>
<li><a href="#org67905c0">C pretty format</a></li>
<li><a href="#orgcaa21f2">Magit</a></li>
<li><a href="#orgb468b2e">Multiple cursors</a></li>
<li><a href="#org7966e81">Org Mode</a></li>
<li><a href="#org48f03b1">References</a></li>
</ul>
</div>
</div>
<p>
Emacs is a wild beast that takes a while to tame. Read upon the official
documentation, learn Elisp, check out for the best third-party packages and
learn from other users.
</p>

<p>
Here follows a selection of subtle best practices on how to set up Emacs as well
as a selection of my favorite Emacs features. See my <a href="https://gitlab.com/ambrevar/dotfiles">dotfiles</a> for my complete
configuration.
</p>

<p>
Also see the <a href="../emacs2/index.html">follow-up article</a>.
</p>

<div id="outline-container-org2e34b1d" class="outline-2">
<h2 id="org629126e">Emacsclient and Emacs server (daemon)</h2>
<div class="outline-text-2" id="text-org629126e">
<p>
With time the configuration may grow and Emacs can take a while to load,
especially when using heavy packages.
</p>

<p>
Running the daemon will make Emacs load the startup files only once. This allows
Emacs instances to be fired up instantly, with the added benefit of a shared
state between instances.
</p>

<p>
The simplest way to start the daemon (if not already started) and the instances
is to set your editor as this script:
</p>

<pre class="example">
emacsclient -c -a "" "$@"
</pre>

<p>
The <code>-a ""</code> option lets Emacs start a daemon if none was already started. The
command will spawn a new Emacs frame and return immediately, which is usually
what we want.
</p>

<p>
This has some shortcomings however. While forking Emacs in the background is
generally a good idea, there are times when it should wait (writing git commit
message, web browser fields), others when it should fork. We can create links
to it and parameterize the waiting behaviour depending on the name of the
script. Which leads us to the following script: <code>em</code> forks and does not return
while the <code>emw</code> and <code>emc</code> links (windowed and console version respectively)
return to their caller.
</p>

<pre class="example">
if [ "${0##*/}" = "emc" ]; then
 ## Force terminal mode
 param="-t"
else
 ## If Emacs cannot start in graphical mode, -c will act just like -t.
 param="-c"
 if [ "${0##*/}" != "emw" ] &amp;&amp; [ -n "$DISPLAY" ] &amp;&amp; [ "$(emacs --batch -Q --eval='(message (if (fboundp '"'"'tool-bar-mode) "X" "TTY"))' 2&gt;&amp;1)" = X ]; then
    ## Don't wait if not called with "emw" and if Emacs can start in graphical mode.
    ## The Emacs batch test checks whether it was compiled with GUI suppport.
    param="$param -n"
 fi
fi

emacsclient "$param" -a "" "$@"
</pre>

<p>
The windowed version of Emacs is not restricted by any terminal limitation;
nonetheless the console version has the advantage of not spawning a new window
when already running in console.
</p>

<p>
You can then set your environment to your liking, e.g. export <code>EDITOR=em</code> and
<code>VISUAL=emw</code>: some programs use VISUAL and wait for it to return, while others
use <code>EDITOR</code> and need not waiting. This is barely a convention though and some
applications will require local adjustments.
</p>

<p>
If you want to pass additional parameters to Emacs, create an <code>emacs</code> wrapper
and place it first in your <code>PATH</code>. For instance, say you want to use
<code>--no-site-file</code> to enforce a vanilla setting on invasive distributions, you can
write the following wrapper:
</p>

<pre class="example">
#!/bin/sh
exec /usr/bin/emacs --no-site-file "$@"
</pre>

<p>
This will apply to both the daemon and stand-alone instances.
</p>
</div>
</div>

<div id="outline-container-org4b43af4" class="outline-2">
<h2 id="orgac72560">Initialization file architecture</h2>
<div class="outline-text-2" id="text-orgac72560">
<p>
It is also wise to reduce the loading time to a minimum, should you start some
daemon-independent Emacs instance (e.g. for development purposes).
</p>

<p>
There is not one and only way to architecture Emacs initialization files, but
surely so there are some good practices. My personal design tenets:
</p>

<ul class="org-ul">
<li>Minimize Emacs startup time.</li>
<li>Keep it simple.</li>
<li>Don't use configuration frameworks.</li>
</ul>

<p>
Some like to rely on third-party packages to handle the configuration for them.
I think it adds a layer of complexity (together with its inevitable bugs) and
reduces flexibility.
</p>

<p>
To minimize the startup time, we need to lazy-load the configuration depending
on the running modes. Everything that is not part of the global configuration
can be conditionally loaded.
</p>
</div>

<div id="outline-container-orgad3a519" class="outline-3">
<h3 id="orge771a4c">Major-modes configuration package</h3>
<div class="outline-text-3" id="text-orge771a4c">
<p>
Every major-mode related configuration can be moved to its own configuration
file which can be loaded:
</p>

<ul class="org-ul">
<li>just in time when it is needed thanks to <code>with-eval-after-load</code>,</li>
<li>and only <i>once</i> thanks to the <code>require</code> function.</li>
</ul>

<p>
In practice, it boils down to a simple line in <code>init.el</code>, e.g. for the C mode:
</p>

<pre class="example">
(with-eval-after-load 'cc-mode (require 'init-cc))
</pre>

<p>
The first time a C buffer is created, the <code>c-mode</code> autoloaded function
<code>require</code>'s the <code>cc-mode.el</code>. When this one is loaded, the <code>with-eval-after-load</code>
kicks in and <code>requires</code> our additional <code>init-cc</code>. The form of
<code>with-eval-after-load</code> is evaluated everytime a C buffer is loaded, thus it is
important to rely on <code>require</code> instead of <code>load</code> so that we load our
configuration only once.
</p>

<p>
The <code>init-cc.el</code> file should contain a C-specific global configuration:
variables, function definitions, skeletons, etc.
</p>

<pre class="example">
(setq semanticdb-default-save-directory (concat emacs-cache-folder "semanticdb"))
(semantic-mode 1)
(local-set-key (kbd "&lt;f6&gt;") (recompile))
;; …

;; Need to end with `provide' so that `require' does not load the file twice.
(provide 'init-cc)
</pre>

<p>
Note that <code>local-set-key</code> generally sets the mode map globally and is <i>not</i>
buffer-local. If it is, it means that the mode is not using the standard mode
API or it hasn't called <code>use-local-map</code>. You should probably report the issue
upstream.
</p>

<p>
Some of your configuration might need to be buffer-local, in which case you must
add it to the mode hook. Cluttering hooks will slow down buffer creation and can
become a source of confusion, so it is advised to stick to only what requires a
hook.
</p>

<pre class="example">
(defun go-setup ()
 (setq indent-tabs-mode t)
 (set (make-local-variable 'compile-command) (concat "go run " (shell-quote-argument buffer-file-name)))
 (add-hook 'before-save-hook #'gofmt-before-save nil t))
(add-hook 'go-mode-hook #'go-setup)
</pre>

<p>
This last example shows three types of relevant hook use:
</p>

<ul class="org-ul">
<li>Set a buffer-local variable. (Those variables whose documentation shows
“Automatically becomes buffer-local when set.”, like <code>indent-tabs-mode</code>). If
not added to a hook, the change would apply to the current buffer only.
Global variables can be permanently made buffer-local with the
<code>make-variable-buffer-local</code> command.</li>
<li>Set a variable to be buffer-local for this mode only and set its value.
<code>compile-command</code> is global by default: making it buffer-local in the mode
hook allows for setting different compile commands for the various buffers in
this mode while other modes will keep dealing with a global compile command.</li>
<li>Make a buffer-local change to a hook thanks to the <code>LOCAL</code> parameter of the
<code>add-hook</code> function. Adding this hook change to the mode hook will effectively
apply the hook change to all buffers in this mode while leaving it untouched
for other modes.</li>
</ul>

<p>
Last but not least, refrain from using lambdas in hooks: it makes the
documentation and the intention harder to understand, while making it much
trickier to use the <code>remove-hook</code> function, should you need to alter the hook
interactively.
</p>
</div>
</div>

<div id="outline-container-org712a70d" class="outline-3">
<h3 id="org045ab4c">Package management</h3>
<div class="outline-text-3" id="text-org045ab4c">
<p>
Third party packages, major modes or not, can be loaded similarly depending on
their availability: if the package is not installed, there is no need to parse
its configuration. The procedure is the same:
</p>

<pre class="example">
(with-eval-after-load 'lua-mode (require 'init-lua))
</pre>

<p>
If you want to make a mode immediately available on startup:
</p>

<pre class="example">
(when (require 'helm-config nil t) (require 'init-helm))
</pre>
</div>
</div>
</div>

<div id="outline-container-org07ccb2c" class="outline-2">
<h2 id="org777b16a">Helm</h2>
<div class="outline-text-2" id="text-org777b16a">
<p>
<a href="https://emacs-helm.github.io/helm/">Helm</a> is a UI revolution: It will add incremental narrowing (fuzzy) search
to... everything!
</p>

<p>
The concept: instead of listing and selecting, it will list and narrow down as
you type, while sorting by the most relevant results first. Beside, the search
can be fuzzy, which makes it practical to find things when you do not know the
exact name.
</p>

<p>
You can lookup buffers, commands, documentation, files, and more: pretty much
anything that requires a <i>lookup</i>. See this <a href="https://tuhdo.github.io/helm-intro.html">article</a> for a more exhaustive
presentation.
</p>

<p>
The one killer feature is the ability to search text in your whole project or
file tree. Helm comes with a few <i>greppers</i>: grep itself, but it also supports
the current version control grepper (e.g. <code>git grep</code>) and other tools such as <a href="http://geoff.greer.fm/ag/">ag</a>
and <a href="https://github.com/monochromegane/the_platinum_searcher">pt</a>.
</p>

<p>
The VCS grepper is usually faster than <code>grep</code>. I have set the bindings to use
the VCS grepper first and to fallback to <code>ag</code> when no file in the current folder
is versioned:
</p>

<pre class="example">
(defun call-process-to-string (program &amp;rest args)
 "Call PROGRAM with ARGS and return output."
 (with-output-to-string
 (with-current-buffer
    standard-output
 (apply 'call-process program nil t nil args))))

(defun helm-grep-git-or-ag (arg)
 "Run `helm-grep-do-git-grep' if possible; fallback to `helm-do-grep-ag' otherwise."
 (interactive "P")
 (require 'vc)
 (if (and (vc-find-root default-directory ".git")
     (or arg (split-string (call-process-to-string "git" "ls-files" "-z") "\0" t)))
 (helm-grep-do-git-grep arg)
 (helm-do-grep-ag arg)))

(global-set-key (kbd "C-x G") #'helm-grep-git-or-ag)
</pre>

<p>
Other features of Helm:
</p>

<ul class="org-ul">
<li>Lookup global variables and functions in current buffer with
<code>helm-semantic-or-imenu</code>, or for all buffers with <code>helm-imenu-in-all-buffers</code>.</li>
<li>To enable proper fuzzy finding when finding files recursively (<code>helm-find</code>),
set <code>helm-findutils-search-full-path</code> to non-nil.</li>
<li>Lookup files in the Git project with third-party <code>helm-ls-git</code>.

<ul class="org-ul">
<li>Call <code>yank</code> to lookup last region.</li>
<li>Use the universal argument to include more to your lookup (e.g. subfolders).</li>
</ul></li>

<li>Use <code>C-c C-f</code> to activate follow mode and navigate through the results to
display a complete context.</li>
<li>Save some helm sessions with <code>C-x C-s</code> for later re-use. Edit <code>grep</code> buffers
with <code>wgrep</code> and apply the changes all at once.</li>
<li>Or resume last helm session with <code>C-x c b</code>.</li>
<li>I like to replace <code>M-s o</code> with <code>helm-occur</code>, <code>C-x C-x</code> with
<code>helm-all-mark-rings</code>, <code>M-y</code> with <code>helm-show-kill-ring</code>, etc.</li>
<li>Lookup completion suggestions with <code>helm-company</code>.</li>
<li>Browse Man page sections with <code>helm-imenu</code>.</li>
</ul>
</div>
</div>

<div id="outline-container-org90b83ae" class="outline-2">
<h2 id="org4e15ba0">Update to latest Emacs version</h2>
<div class="outline-text-2" id="text-org4e15ba0">
<p>
You might like Emacs enough you want it everywhere. And yet sometimes you are
forced to use an outdated, crappy system on which you have no administrative
priviledge.
</p>

<p>
I would not advise sticking to an outdated versions: too many essential features
and packages rely on recent Emacs.
</p>

<p>
Thankfully it's easy enough to compile the latest Emacs thanks to its extreme
portability and can be installed within the user home folder.
</p>
</div>
</div>

<div id="outline-container-orgae6530a" class="outline-2">
<h2 id="org661635e">Cache folder</h2>
<div class="outline-text-2" id="text-org661635e">
<p>
(Or how to keep your configuration folder clean.)
</p>

<p>
Many modes store their cache files in <code>~/.emacs.d</code>. I prefer to keep those
ephemeral files in <code>~/.cache/emacs</code>.
</p>

<pre class="example">
(setq user-emacs-directory "~/.cache/emacs/")
(if (not (file-directory-p user-cache-directory))
 (make-directory user-cache-directory t))

;; Some files need to be forced to the cache folder.
(setq geiser-repl-history-filename (expand-file-name "geiser_history" user-emacs-directory))
(setq elfeed-db-directory (expand-file-name "elfeed" user-emacs-directory))

;; Place backup files in specific directory.
(setq backup-directory-alist
 `(("." . ,(expand-file-name "backups" user-emacs-directory))))
</pre>

<p>
If you use Semantic, make sure it is started <i>after</i> changing the cache folder
since its database is stored there.
</p>
</div>
</div>

<div id="outline-container-orgd406f10" class="outline-2">
<h2 id="org0a3e227">Streamline indentation</h2>
<div class="outline-text-2" id="text-org0a3e227">
<p>
I think Emacs has too many options for indentation. Since I have a strong
<a href="../indentation/index.html">opinion on always using tabs to indent</a> (except for Lisp), I “redirect” with
<code>defvaralias</code> the mode-specific indentation levels to only one variable, namely
<code>tab-width</code>.
</p>

<pre class="example">
(defvaralias 'standard-indent 'tab-width)
(setq-default indent-tabs-mode t)

;; Lisp should not use tabs.
(mapcar
 (lambda (hook)
 (add-hook
 hook
 (lambda () (setq indent-tabs-mode nil))))
 '(lisp-mode-hook emacs-lisp-mode-hook))

;; This needs to be set globally since they are defined as local variables and
;; Emacs does not know how to set an alias on a local variable.
(defvaralias 'c-basic-offset 'tab-width)
(defvaralias 'sh-basic-offset 'tab-width)
</pre>

<p>
Add the following to <code>sh-mode-hook</code>:
</p>

<pre class="example">
(defvaralias 'sh-indentation 'sh-basic-offset)
</pre>

<p>
The cases of <i>C</i> and <i>sh</i> are special for historical reasons. Other modes
indentation can be corrected as follows:
</p>

<pre class="example">
(defvaralias 'js-indent-level 'tab-width)
(defvaralias 'lua-indent-level 'tab-width)
(defvaralias 'perl-indent-level 'tab-width)
</pre>
</div>
</div>

<div id="outline-container-org815a09f" class="outline-2">
<h2 id="orgdd00133">Elisp “go to definition”</h2>
<div class="outline-text-2" id="text-orgdd00133">
<p>
Elisp has the <code>find-variable-at-point</code> and the <code>find-function-at-point</code>
functions, yet it does not have a proper <code>go to definition</code> command. Not for
long:
</p>

<pre class="example">
(defun find-symbol-at-point ()
 "Find the symbol at point, i.e. go to definition."
 (interactive)
 (let ((sym (symbol-at-point)))
 (if (boundp sym)
    (find-variable sym)
 (find-function sym))))

(define-key lisp-mode-shared-map (kbd "M-.") 'find-symbol-at-point)
</pre>
</div>
</div>

<div id="outline-container-orga877258" class="outline-2">
<h2 id="orgd3983ca">Smart compilation</h2>
<div class="outline-text-2" id="text-orgd3983ca">
<p>
Emacs has a compilation mode that comes in very handy to run arbitrary commands
over your buffer and navigate the errors back to the source code.
</p>

<p>
It is not only useful for compilers but also for, say, browsing your own
programs' debug messages, a linter, etc.
</p>

<p>
Emacs standard behaviour is to store the last used compile command in the global
variable <code>compile-command</code>. Similarly, <code>compile-history</code> remembers all compile
commands used globally. This is useful if you jump from buffer to buffer and
want to run the same compile command for your project without having to switch
back to a specific buffer.
</p>

<p>
Another approach is to make <code>compile-command</code> buffer-local. You'll have to be in
a specific buffer to run the desired command. In practice, I find myself having
to run several buffer-specific commands per project (documentation, linting,
library builds, executable builds, etc.).
</p>

<p>
To use the buffer-local approach, add this to your init file before configuring
the modes:
</p>

<pre class="example">
(eval-after-load 'compile (make-variable-buffer-local 'compile-command))
</pre>

<p>
The compile command can be modified per buffer upon request. If you use the
<code>desktop</code> mode to save your session, each buffer's command can be restored as
well:
</p>

<pre class="example">
(add-to-list 'desktop-locals-to-save 'compile-command)
</pre>

<p>
Emacs provides two compilation commands:
</p>

<ul class="org-ul">
<li><code>(compile COMMAND &amp;optional COMINT)</code> prompts for the command to run when
called interactively. A user-defined command can do that with
<code>(call-interactively 'compile)</code>. Make <code>compile-command</code> local to the function
scope if you want to run a temporary command.</li>
<li><code>(recompile &amp;optional EDIT-COMMAND)</code> is handy to recall last command without
prompting the user. It has some shortcomings when using a buffer-local
<code>compile-command</code>:

<ul class="org-ul">
<li><code>compile-history</code> remains untouched unless we do some manual bookkeeping.</li>
<li>It uses a global <code>compilation-directory</code>, thus calling <code>recompile</code> in
another buffer will fail if the target file is in a different folder. We can
make that variable buffer-local, but that would only work if we never use
<code>compile</code>. In such a scenario, <code>compile-history</code> is unused.</li>
</ul></li>
</ul>

<p>
In short: when using a buffer-local <code>compile-command</code>, we are better off
sticking to <code>compile</code> and leaving <code>recompile</code> aside.
</p>

<p>
Let's add some bindings for convenience:
</p>

<pre class="example">
(defun compile-last-command () (interactive) (compile compile-command))
(global-set-key (kbd "C-&lt;f6&gt;") #'compile)
(global-set-key (kbd "&lt;f6&gt;") #'compile-last-command)
</pre>

<p>
Here follows a complete example for C: it will look for the closest <code>Makefile</code>
in the parent folders and set the command to <code>make -C /path/to/makefile</code> or else
fallback to some dynamically set values depending on the language (C or C++) and
the environment (GCC, Clang, etc.). The linker flags are configurable on a
per-buffer basis thanks to the buffer-local <code>cc-ldlibs</code> and <code>cc-ldflags</code>
variables.
</p>

<pre class="example">
(defvar-local cc-ldlibs "-lm -pthread"
 "Custom linker flags for C/C++ linkage.")

(defvar-local cc-ldflags ""
 "Custom linker libs for C/C++ linkage.")

(defun cc-set-compiler (&amp;optional nomakefile)
 "Set compile command to be nearest Makefile or a generic command.
The Makefile is looked up in parent folders. If no Makefile is
found (or if NOMAKEFILE is non-nil or if function was called with
universal argument), then a configurable commandline is
provided."
 (interactive "P")
 (hack-local-variables)
 ;; Alternatively, if a Makefile is found, we could change default directory
 ;; and leave the compile command to "make". Changing `default-directory'
 ;; could have side effects though.
 (let ((makefile-dir (locate-dominating-file "." "Makefile")))
 (if (and makefile-dir (not nomakefile))
    (setq compile-command (concat "make -k -C " (shell-quote-argument (file-name-directory makefile-dir))))
 (setq compile-command
     (let
        ((c++-p (eq major-mode 'c++-mode))
         (file (file-name-nondirectory buffer-file-name)))
     (format "%s %s -o '%s' %s %s %s"
         (if c++-p
             (or (getenv "CXX") "g++")
            (or (getenv "CC") "gcc"))
         (shell-quote-argument file)
         (shell-quote-argument (file-name-sans-extension file))
         (if c++-p
             (or (getenv "CXXFLAGS") "-Wall -Wextra -Wshadow -DDEBUG=9 -g3 -O0")
            (or (getenv "CFLAGS") "-ansi -pedantic -std=c11 -Wall -Wextra -Wshadow -DDEBUG=9 -g3 -O0"))
         (or (getenv "LDFLAGS") cc-ldflags)
         (or (getenv "LDLIBS") cc-ldlibs)))))))

(defun cc-clean ()
 "Find Makefile and call the `clean' rule. If no Makefile is
found, no action is taken. The previous `compile' command is
restored."
 (interactive)
 (let (compile-command
    (makefile-dir (locate-dominating-file "." "Makefile")))
 (when makefile-dir
 (compile (format "make -k -C %s clean" (shell-quote-argument makefile-dir))))))

(dolist (map (list c-mode-map c++-mode-map))
 (define-key map "&lt;f5&gt;" #'cc-clean))

(dolist (hook '(c-mode-hook c++-mode-hook))
 (add-hook hook #'cc-set-compiler))
</pre>
</div>
</div>

<div id="outline-container-org9f2bf3e" class="outline-2">
<h2 id="org67905c0">C pretty format</h2>
<div class="outline-text-2" id="text-org67905c0">
<p>
I use <a href="http://uncrustify.sourceforge.net/">uncrustify</a> to format my C code automatically. See my <a href="../indentation/index.html">indentation
rationale</a>.
</p>

<p>
I can call it from Emacs with the following function:
</p>

<pre class="example">
(defun cc-fmt ()
 "Run uncrustify(1) on current buffer or region."
 (interactive)
 (let ((formatbuf (get-buffer-create "*C format buffer*"))
    status start end)
 (if (use-region-p)
    (setq start (region-beginning) end (region-end))
 (setq start (point-min) end (point-max)))
 (setq status
     (call-process-region start end "uncrustify" nil formatbuf nil "-lc" "-q" "-c"
             (concat (getenv "HOME") "/.uncrustify.cfg")))
 (if (/= status 0)
    (error "error running uncrustify")
 (delete-region start end)
 (insert-buffer formatbuf)
 (kill-buffer formatbuf))))
</pre>

<p>
We could add this to <code>before-save-hook</code> to auto-format my code at all times, but
that would be bad practice when working with source code using different
formatting rules.
</p>
</div>
</div>

<div id="outline-container-org169faf7" class="outline-2">
<h2 id="orgcaa21f2">Magit</h2>
<div class="outline-text-2" id="text-orgcaa21f2">
<p>
<a href="https://magit.vc/">Magit</a> makes Git management a bliss. The most evident feature would be the easy
hunk selection when staging code. This simple feature together with a few others
will make a drastic change to your workflow.
</p>
</div>
</div>

<div id="outline-container-org668fd1b" class="outline-2">
<h2 id="orgb468b2e">Multiple cursors</h2>
<div class="outline-text-2" id="text-orgb468b2e">
<p>
See this <a href="http://emacsrocks.com/e13.html">video</a> for a short introduction of this very powerful editing framework.
</p>

<p>
As of Septermber 2016, multiple cursors does not support searching, so I use
<code>phi-search</code> that automatically adds support to it.
</p>

<pre class="example">
(when (require 'multiple-cursors nil t)
 (setq mc/list-file (concat emacs-cache-folder "mc-lists.el"))
 ;; Load the file at the new location.
 (load mc/list-file t)
 (global-unset-key (kbd "C-&lt;down-mouse-1&gt;"))
 (global-set-key (kbd "C-&lt;mouse-1&gt;") #'mc/add-cursor-on-click)
 (global-set-key (kbd "C-x M-r") #'mc/edit-lines)
 (global-set-key (kbd "C-x M-m") #'mc/mark-more-like-this-extended)
 (global-set-key (kbd "C-x M-l") #'mc/mark-all-like-this-dwim)
 ;; mc-compatible with search.
 (require 'phi-search nil t))
</pre>

<p>
If you are an Evil user, <code>multiple-cursors</code> will not work. Use the dedicated
<code>evil-mc</code> instead.
</p>
</div>
</div>

<div id="outline-container-org87a7ac9" class="outline-2">
<h2 id="org7966e81">Org Mode</h2>
<div class="outline-text-2" id="text-org7966e81">
<p>
Last but not least, the famous <a href="http://orgmode.org/">Org Mode</a>. It offers some impressive features,
such as seamless table manipulation (swap columns with a keystroke...) and formula
computation. From the manual:
</p>

<pre class="example">
Finally, just to whet your appetite for what can be done with the
fantastic `calc.el' package, here is a table that computes the Taylor
series of degree `n' at location `x' for a couple of functions.

 |---+-------------+---+-----+--------------------------------------|
 | | Func | n | x | Result |
 |---+-------------+---+-----+--------------------------------------|
 | # | exp(x) | 1 | x | 1 + x |
 | # | exp(x) | 2 | x | 1 + x + x^2 / 2 |
 | # | exp(x) | 3 | x | 1 + x + x^2 / 2 + x^3 / 6 |
 | # | x^2+sqrt(x) | 2 | x=0 | x*(0.5 / 0) + x^2 (2 - 0.25 / 0) / 2 |
 | # | x^2+sqrt(x) | 2 | x=1 | 2 + 2.5 x - 2.5 + 0.875 (x - 1)^2 |
 | 0_sync_master.sh 1_add_new_article_manual.sh 1_add_new_article_newspaper.sh 2_start_translating.sh 3_continue_the_work.sh 4_finish.sh 5_pause.sh base.sh parse_url_by_manual.sh parse_url_by_newspaper.py parse_url_by_newspaper.sh project.cfg reformat.sh texput.log urls_checker.sh | tan(x) | 3 | x | 0.0175 x + 1.77e-6 x^3 |
 |---+-------------+---+-----+--------------------------------------|
 #+TBLFM: $5=taylor($2,$4,$3);n3
</pre>

<p>
Note that the last column is computed automatically! Formulae can be computed
using the Calc mode, Elisp, or even external programs such as R or PARI/GP.
Possibilities are endless.
</p>

<p>
Finally, you can export the end result to LaTeX, HTML, etc.
</p>
</div>
</div>

<div id="outline-container-org7837e72" class="outline-2">
<h2 id="org48f03b1">References</h2>
<div class="outline-text-2" id="text-org48f03b1">
<p>
Aggregator wikis:
</p>

<ul class="org-ul">
<li><a href="https://github.com/emacs-tw/awesome-emacs">https://github.com/emacs-tw/awesome-emacs</a></li>
<li><a href="https://github.com/pierre-lecocq/emacs4developers">https://github.com/pierre-lecocq/emacs4developers</a></li>
</ul>

<p>
User configurations:
</p>

<ul class="org-ul">
<li><a href="https://github.com/wasamasa/dotemacs/">https://github.com/wasamasa/dotemacs/</a></li>
<li><a href="https://writequit.org/org/">https://writequit.org/org/</a></li>
<li><a href="http://doc.rix.si/cce/cce.html">http://doc.rix.si/cce/cce.html</a></li>
<li><a href="https://github.com/larstvei/dot-emacs/blob/master/init.org">https://github.com/larstvei/dot-emacs/blob/master/init.org</a></li>
<li><a href="https://github.com/hlissner/.emacs.d">https://github.com/hlissner/.emacs.d</a></li>
<li><a href="https://github.com/howardabrams/dot-files">https://github.com/howardabrams/dot-files</a></li>
<li><a href="https://github.com/purcell/emacs.d/">https://github.com/purcell/emacs.d/</a></li>
<li><a href="http://pages.sachachua.com/.emacs.d/">http://pages.sachachua.com/.emacs.d/</a></li>
</ul>

<p>
Blogs and other resources:
</p>

<ul class="org-ul">
<li><a href="http://planet.emacsen.org/">http://planet.emacsen.org/</a></li>
<li><a href="https://www.reddit.com/r/emacs/">https://www.reddit.com/r/emacs/</a></li>
<li><a href="https://emacs.stackexchange.com/">https://emacs.stackexchange.com/</a></li>
<li><a href="http://emacslife.com/">http://emacslife.com/</a> and <a href="http://sachachua.com/blog/">http://sachachua.com/blog/</a></li>
</ul>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2018-10-23</span>
            <span title="last modification date" class="post-info">2018-10-23</span>
            <span title="tags" class="post-info">:<a href="https://lujun9972.github.io/emacs-document/tags/raw">raw</a>:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a></span>
        </div>
    <script src="https://lujun9972.github.io/emacs-document/media/js/jquery-2.1.3.min.js"></script>
    <script src="https://lujun9972.github.io/emacs-document/media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="https://lujun9972.github.io/emacs-document/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="https://lujun9972.github.io/emacs-document//instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
