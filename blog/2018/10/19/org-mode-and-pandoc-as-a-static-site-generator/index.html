<!DOCTYPE html>
<html lang="en">
<head>
  <title>Org-mode and Pandoc as a static site generator - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="raw" />
  <!-- <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="https://lujun9972.github.io/emacs-document/">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="https://lujun9972.github.io/emacs-document/years/">Years</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/authors/">Authors</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/tags/">Tags</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Org-mode and Pandoc as a static site generator</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#what-is-org-mode">What is Org Mode?</a>
<ul>
<li><a href="#literate-blog-generation">Literate blog generation</a></li>
<li><a href="#getting-started">Getting Started</a></li>
</ul>
</li>
<li><a href="#how-this-site-is-actually-built">How this site is actually built</a>
<ul>
<li><a href="#getting-some-html">Getting some HTML</a></li>
</ul>
</li>
<li><a href="#whats-next">What's next?</a></li>
</ul>
</div>
</div>
<p>
I've spent a lot of time looking for the "perfect" static site generator. I want something that's:
</p>

<ul class="org-ul">
<li>fast</li>
<li>simple enough to let me focus on writing</li>
<li>easy to run on someone else's server</li>
<li>extendable if and when I want to</li>
</ul>

<p>
While there are some awesome site generators out there now (I really enjoyed <a href="https://gohugo.io/">hugo</a> for it's 0 dependencies and speed) most were just too big for me. They had specific templating systems, or required set up and theming that I didn't want to get into.
</p>

<p>
I settled on using <a href="https://pandoc.html">pandoc</a> to convert a set of markdown files to html, and paired it with a very simple css file. This worked well! I had an ultra-minimal blog generator that I could run on Gitlab Pages super easily.
</p>

<p>
Eventually though I ran into the limitations. I wanted to generate an index page for the blog, as well as a fancier table of contents for a whitepaper. To handle this I ended up adding cases to what was a pretty small bash script. And of course that became a pain to maintain.
</p>

<p>
The main problem was a separation between the writing I wanted to do and the code I had to write to manage it. <b>What if these could be tied together?</b> I'd had some exposure to the ideas of <a href="http://literateprogramming.com/">Literate Programming</a> from Donald Knuth, but it had never really clicked for me in a practical way.
</p>

<p>
This changed as I started using the wonder that is org mode. Bear with me, I'll get to blog generation soon.
</p>

<div id="outline-container-org910a102" class="outline-2">
<h2 id="what-is-org-mode">What is Org Mode?</h2>
<div class="outline-text-2" id="text-what-is-org-mode">
<blockquote>
<p>
Org mode is for keeping notes, maintaining TODO lists, planning projects, and authoring documents with a fast and effective plain-text system.
</p>
</blockquote>

<p>
Org is a joyful piece of software. It's a simple yet powerful combination of intuitive markup and ergonomic tooling that (most of the time) just works. The key is that the markup is readable at a glance, and the tools provide some pretty neat ways of interacting with and manipulating it.
</p>

<p>
It's core components are fairly simple:
</p>

<ul class="org-ul">
<li><code>headings</code>, lines which start with a number of <code>*</code>'s, provide top-level structure,</li>
<li>inline markup like <code>* *</code> and <code>/ /</code> provide styling</li>
<li>blocks (denoted with <code>#+</code>) provide space to do some really cool stuff.</li>
<li><p>
keywords like <code>TODO</code> work with specific tools and provide context
</p>

<p>
This all comes together perfectly as a tool for literate programming.
</p></li>
</ul>
</div>

<div id="outline-container-orgadc8e9f" class="outline-3">
<h3 id="literate-blog-generation">Literate blog generation</h3>
<div class="outline-text-3" id="text-literate-blog-generation">
<p>
You may have noticed the source blocks scattered around this site. They define how the content under them is generated. They're just code blocks, but with <a href="https://orgmode.html/worg/org-contrib/babel/">org-babel</a> I can execute them right in my editor to generate those blocks on the fly! For the site I'm using bash, but babel (as the name implies) let's you write in pretty much anything.
</p>

<p>
<img src="https://awarm.space/static/gifs/org-babel.gif" alt="org-babel.gif" />
Build the blog list with bash
</p>

<p>
Is this a little overkill? Yes. But it's way more maintainable than the monster bash script I was using previously.
</p>

<p>
It's probably not the static site generator for you if you just want to get to blogging, but it's incredibly fun to put together and a great learning experience.
</p>

<p>
Having the code in the same place as the writing you do encourages you to both maintain it and write more. This could turn into an endless bikeshed, but for me it opens up a ton of possibilities in producing the kind of work I want to.
</p>
</div>
</div>

<div id="outline-container-orge1b7710" class="outline-3">
<h3 id="getting-started">Getting Started</h3>
<div class="outline-text-3" id="text-getting-started">
<p>
Org-babel's documentation is somewhat scattered but digging through <a href="https://orgmode.html/manual/">The Org Manual</a> eventually got me where I needed be. This article on using it for <a href="http://howardism.html/Technical/Emacs/literate-devops.html">Literate Dev-Ops</a> by Howard Abrams also has a ton of useful information and techniques.
</p>
</div>
</div>
</div>

<div id="outline-container-org17da4d9" class="outline-2">
<h2 id="how-this-site-is-actually-built">How this site is actually built</h2>
<div class="outline-text-2" id="text-how-this-site-is-actually-built">
<p>
The rough idea is to have a bunch of code snippets distributed throughout the site in org-babel blocks. Then we use blocks that look something like this at each level up.
</p>

<pre class="example">
(find-file "./blog/index.org")
(org-babel-execute-buffer )
(save-buffer)
</pre>

<p>
This will go into a specific file and execute all the org-babel blocks contained within. And if that file includes a similar block, it'll go down into others!
</p>

<p>
And at the top level (the <code>index.org</code> file) we have the code that starts it all.
</p>
</div>

<div id="outline-container-org795f017" class="outline-3">
<h3 id="getting-some-html">Getting some HTML</h3>
<div class="outline-text-3" id="text-getting-some-html">
<p>
Once all the files are set up, we have a small bash script right at the top to convert all of that markdown to html.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">!/bin/</span><span style="color: #4f97d7; font-weight: bold;">bash</span>

rm -rf _public
<span style="color: #7590db;">root</span>=<span style="color: #2d9574;">"$(</span><span style="color: #fa8072;">pwd</span><span style="color: #2d9574;">)"</span>

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">emacs --batch -l ./build-assets/build.el</span>
<span style="color: #4f97d7; font-weight: bold;">for</span> folder<span style="color: #4f97d7; font-weight: bold;"> in</span> $<span style="color: #4f97d7;">(</span><span style="color: #fa8072;">find</span> . -type d -not -path <span style="color: #2d9574;">'*/\.*'</span><span style="color: #4f97d7;">)</span>; <span style="color: #4f97d7; font-weight: bold;">do</span>
    <span style="color: #4f97d7;">(</span><span style="color: #4f97d7;">cd</span> $<span style="color: #7590db;">folder</span>
     <span style="color: #4f97d7; font-weight: bold;">for</span> file<span style="color: #4f97d7; font-weight: bold;"> in</span> <span style="color: #fa8072;">`find . -maxdepth 1 -name "*.org"`</span>; <span style="color: #4f97d7; font-weight: bold;">do</span>
         <span style="color: #bc6ec5;">[</span> -e <span style="color: #2d9574;">"$file"</span> <span style="color: #bc6ec5;">]</span> || <span style="color: #4f97d7; font-weight: bold;">continue</span>
         mkdir -p <span style="color: #2d9574;">"$root/_public/${folder#./}"</span>

         pandoc -f org -t html <span style="color: #2d9574;">"$file"</span> <span style="color: #2d9574;">\</span>
                -o <span style="color: #2d9574;">"$root/_public/${folder#./}/`basename "$file" .org`.html"</span><span style="color: #2d9574;">\</span>
                --lua-filter $<span style="color: #7590db;">root</span>/scripts/changeLinks.lua <span style="color: #2d9574;">\</span>
                --lua-filter $<span style="color: #7590db;">root</span>/scripts/task-list.lua <span style="color: #2d9574;">\</span>
                -B $<span style="color: #7590db;">root</span>/static/html/header.html <span style="color: #2d9574;">\</span>
                -H $<span style="color: #7590db;">root</span>/static/html/includes.html <span style="color: #2d9574;">\</span>
                -c <span style="color: #2d9574;">"/static/styles.css"</span> <span style="color: #2d9574;">\</span>
                -s
     <span style="color: #4f97d7; font-weight: bold;">done</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">done</span>

cp -r static _public/
</pre>
</div>

<p>
It's pretty small as the heavy lifting is done by <a href="https://pandoc.html">pandoc</a>. This time however, this script can stay small as we're letting org-babel take the weight.
</p>
</div>
</div>
</div>

<div id="outline-container-org4759aa2" class="outline-2">
<h2 id="whats-next">What's next?</h2>
<div class="outline-text-2" id="text-whats-next">
<p>
Well actually writing for one. I've got the infrastructure in place and now it's time to start using it!
</p>

<p>
Well, there's also some additional infrastructure I'd like to get in of course :)
</p>

<ul class="org-ul">
<li>Get a git-hook in place to run the top level script whenever I commit</li>
<li>Figure out how to handle comments or replies</li>
<li><code>[0/2]</code> Tie my other org files to the site:

<ul class="org-ul">
<li>TODOS,</li>
<li>Links</li>
</ul></li>
</ul>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2018-10-19</span>
            <span title="last modification date" class="post-info">2018-10-19</span>
            <span title="tags" class="post-info">:<a href="https://lujun9972.github.io/emacs-document/tags/raw">raw</a>:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a></span>
        </div>
    <script src="https://lujun9972.github.io/emacs-document/media/js/jquery-2.1.3.min.js"></script>
    <script src="https://lujun9972.github.io/emacs-document/media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="https://lujun9972.github.io/emacs-document/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="https://lujun9972.github.io/emacs-document//instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
