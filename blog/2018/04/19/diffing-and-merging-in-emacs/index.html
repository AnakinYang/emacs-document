<!DOCTYPE html>
<html lang="en">
<head>
  <title>Diffing and merging in Emacs - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="raw" />
  <!-- <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="../../../../../media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="../../../../../years/">Years</a></li>
        <li><a href="../../../../../authors/">Authors</a></li>
        <li><a href="../../../../../tags/">Tags</a></li>
        <li><a href="../../../../../about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document.git">Github</a></li>
        <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Diffing and merging in Emacs</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgbbc3b1a">Diffing files you've got open in your Emacs</a></li>
<li><a href="#org537169e">Diffing revisions of a file</a></li>
<li><a href="#orge9ea776">Inside an ediff session</a></li>
<li><a href="#org077b4e1">Resolving merge conflicts in files with merge conflict markers</a></li>
<li><a href="#org36603ea">Telling Git to give us 3 way diff instead of two way</a></li>
<li><a href="#org704303f">*)</a></li>
<li><a href="#org87a4c31">P4 specific setup</a></li>
<li><a href="#orgb08792a">P4特定设置</a>
<ul>
<li><a href="#org0fc8223">P4 specifc post-merge notes</a></li>
<li><a href="#org0c6a1c2">P4合并后的特别提示</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgbbc3b1a" class="outline-2">
<h2 id="orgbbc3b1a">Diffing files you've got open in your Emacs</h2>
<div class="outline-text-2" id="text-orgbbc3b1a">
<p>
*在Emacs中打开不同的文件
</p>
<p>
属性:
:CUSTOM_ID: diffing-files-youve-got-open-in-your-emacs
:CUSTOM_ID diffing-files-youve-got-open-in-your-emacs
</p>
<p>
结束:
</p>

<pre class="example">
M-x ediff-buffers
</pre>
</div>
</div>

<div id="outline-container-org537169e" class="outline-2">
<h2 id="org537169e">Diffing revisions of a file</h2>
<div class="outline-text-2" id="text-org537169e">
<p>
*文件的不同修订
</p>
<p>
属性:
:CUSTOM_ID: diffing-revisions-of-a-file
:CUSTOM_ID diffing-revisions-of-a-file
</p>
<p>
结束:
</p>

<p>
C-x v = (<code>vc-diff</code>)
C-x v = (<code>vc-diff</code>)
</p>

<p>
You can also view the changes with <code>ediff</code> using M-x
您还可以使用=ediff=使用M-x查看更改
<code>ediff-revision</code>
= ediff-revision =
</p>
</div>
</div>

<div id="outline-container-orge9ea776" class="outline-2">
<h2 id="orge9ea776">Inside an ediff session</h2>
<div class="outline-text-2" id="text-orge9ea776">
<p>
*在ediff会话中
</p>
<p>
属性:
:CUSTOM_ID: inside-an-ediff-session
:CUSTOM_ID inside-an-ediff-session
</p>
<p>
结束:
</p>

<p>
Once inside an ediff session, put focus in the <code>ediff</code> navigator and
进入ediff会话后，将焦点放在=ediff= navigator和
use e.g.:
使用如:
</p>

<ul class="org-ul">
<li>n/p - next/previous hunk</li>
<li>n/p -下一个/前一个</li>
<li>a - apply version A's hunk</li>
<li>a -应用版本a的大块头</li>
<li>b - apply version B's hunk</li>
<li>b -应用版本b的大块</li>
<li>r - revert, undo the applying of the A/B hunk.</li>
<li>r -还原，撤销A/B块的应用。</li>
<li>q - quit ediff session</li>
</ul>
<p>
q编辑会话
</p>
</div>
</div>

<div id="outline-container-org077b4e1" class="outline-2">
<h2 id="org077b4e1">Resolving merge conflicts in files with merge conflict markers</h2>
<div class="outline-text-2" id="text-org077b4e1">
<p>
*使用合并冲突标记解决文件中的合并冲突
</p>
<p>
属性:
:CUSTOM_ID: resolving-merge-conflicts-in-files-with-merge-conflict-markers
:CUSTOM_ID resolving-merge-conflicts-in-files-with-merge-conflict-markers
</p>
<p>
结束:
</p>

<p>
Out of the box Emacs gives us an easy interface to working with merge
开箱即用的Emacs为我们提供了一个使用merge的简单接口
conflicts, called <code>smerge</code> (as in "simple merge").
冲突，称为=smerge=(在“简单合并”中)。
</p>

<p>
When there's a merge conflict, the version control system writes the
当存在合并冲突时，版本控制系统将写入
diff markers into the source files themselves and Emacs will highlight
源文件本身的diff标记和Emacs将突出显示
these automatically. It will recognise which parts are "theirs" and
这些自动。它将识别哪些部分是“他们的”
which are "mine" --- as well as "ancestor" if you've set up 3 way merge.
哪些是“我的”——如果你已经设置了3路合并，那么它们就是“祖先”。
</p>

<p>
<img src="http://www.skybert.net/graphics/2017/2017-01-04-emacs-3-way-diff-git-merge.png" alt="2017-01-04-emacs-3-way-diff-git-merge.png" />
<img src="http://www.skybert.net/graphics/2017/2017-01-04-emacs-3-way-diff-git-merge.png" alt="2017-01-04-emacs-3-way-diff-git-merge.png" />
</p>

<p>
To select the version at the bottom, I just put my pointer on it, and
要选择底部的版本，我只要把我的指针放在它上面，然后
run M-x <code>smerge-keep-current</code>.
运行m x = smerge-keep-current =。
</p>
</div>
</div>

<div id="outline-container-org36603ea" class="outline-2">
<h2 id="org36603ea">Telling Git to give us 3 way diff instead of two way</h2>
<div class="outline-text-2" id="text-org36603ea">
<p>
*告诉Git给我们3条路，而不是2条路
</p>
<p>
属性:
:CUSTOM_ID: telling-git-to-give-us-3-way-diff-instead-of-two-way
:CUSTOM_ID telling-git-to-give-us-3-way-diff-instead-of-two-way
</p>
<p>
结束:
</p>

<p>
By default git sets up 2 way diffs when there's a merge conflict ("my"
默认情况下，当存在合并冲突时，git会设置两种不同的方式(“my”
version of the file and "their" version). However, when resolving
文件的版本和“他们的”版本)。然而,当解决
merge conflicts, it's often useful to in addition see the most recent
合并冲突，它通常是有用的除了看到最近的
common ancestor of the two versions of the file you're merging.
要合并的文件的两个版本的公共祖先。
</p>

<p>
This is so useful, you may just want to set it globally for all your
这是非常有用的，你可能只想把它设置为全局的
projects by adding the following to your <code>~/.gitconfig</code>:
在你的=~/.gitconfig=中添加以下内容:
</p>

<pre class="example">
[merge]
conflictstyle = diff3
</pre>
</div>
</div>

<div id="outline-container-org704303f" class="outline-2">
<h2 id="org704303f">*)</h2>
<div class="outline-text-2" id="text-org704303f">
<p>
属性:
:CUSTOM_ID: section
:CUSTOM_ID:部分
</p>
<p>
结束:
</p>

<p>
Tested on version Emacs version 25.1
在版本Emacs版本25.1上测试
</p>
</div>
</div>

<div id="outline-container-org87a4c31" class="outline-2">
<h2 id="org87a4c31">P4 specific setup</h2>
</div>
<div id="outline-container-orgb08792a" class="outline-2">
<h2 id="orgb08792a">P4特定设置</h2>
<div class="outline-text-2" id="text-orgb08792a">
<p>
属性:
:CUSTOM_ID: p4-specific-setup
:CUSTOM_ID p4-specific-setup
</p>
<p>
结束:
</p>

<p>
in <code>.p4enviro</code>:
= .p4enviro =:
</p>

<pre class="example">
P4MERGE=/home/torstein/bin/p4-emacs-merge
</pre>

<p>
in <code>.emacs</code>:
在= .emacs =:
</p>

<pre class="example">
(server-start)
</pre>

<p>
in <code>/home/torstein/bin/emerge</code> (Gentoo users, note the full path ;-)
在=/home/torstein/bin/emerge= (Gentoo用户，注意完整的路径;-)
</p>

<pre class="example">
ancestor=$1
theirs=$2
yours=$3
merge_result=$4

emacsclient -e "(ediff-merge-files-with-ancestor "${yours}" "${theirs}" "${ancestor}" () "${merge_result}")"
emacsclient "${merge_result}"
</pre>

<p>
The full source of p4-emacs-merge can be found here:
p4-emacs-merge的完整源代码可以在这里找到:
<a href="https://github.com/skybert/my-little-friends/blob/master/bash/vcs/p4-emacs-merge">https://github.com/skybert/my-little-friends/blob/master/bash/vcs/p4-emacs-merge</a>
<a href="https://github.com/skybert/my-little-friends/blob/master/bash/vcs/p4-emacs-merge">https://github.com/skybert/my-little-friends/blob/master/bash/vcs/p4-emacs-merge</a>
</p>
</div>

<div id="outline-container-org0fc8223" class="outline-3">
<h3 id="org0fc8223">P4 specifc post-merge notes</h3>
</div>
<div id="outline-container-org0c6a1c2" class="outline-3">
<h3 id="org0c6a1c2">P4合并后的特别提示</h3>
<div class="outline-text-3" id="text-org0c6a1c2">
<p>
属性:
:CUSTOM_ID: p4-specifc-post-merge-notes
:CUSTOM_ID p4-specifc-post-merge-notes
</p>
<p>
结束:
</p>

<p>
After you're finished with the <code>ediff</code> session and you're back at the
在您完成了=ediff=会话并返回到
<code>p4=/shell prompt, choose =ae</code> (accept edit) Here's one merge
=p4=/shell提示，选择=ae=(接受编辑)这里有一个合并
conflict, with the two version presented (p4 "yours" is A and p4
冲突，与两个版本提出(p4“你的”是一个和p4
"theirs" is B):
“他们”是B):
</p>

<p>
<img src="http://www.skybert.net/graphics/2016/2016-03-10-ediff-merge-before.png" alt="2016-03-10-ediff-merge-before.png" />
<img src="http://www.skybert.net/graphics/2016/2016-03-10-ediff-merge-before.png" alt="2016-03-10-ediff-merge-before.png" />
</p>

<p>
Now, I want "their" version, so I hit b. Emacs then replaces the
现在，我想要“他们的”版本，所以我点击b
merge conflict markers/block with the contents of the B hunk:
合并冲突标记/块与B块的内容:
</p>

<p>
<img src="http://www.skybert.net/graphics/2016/2016-03-10-ediff-merge-after.png" alt="2016-03-10-ediff-merge-after.png" />
<img src="http://www.skybert.net/graphics/2016/2016-03-10-ediff-merge-after.png" alt="2016-03-10-ediff-merge-after.png" />
</p>
</div>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2018-04-19</span>
            <span title="last modification date" class="post-info">2019-12-21</span>
            <span title="tags" class="post-info">:<a href="../../../../../tags/raw">raw</a>:</span>
            <span title="author" class="post-info"><a href="mailto:travis &lt;at&gt; travis-job-4350ea14-e25e-47dc-9c37-c8f0484961a5">lujun9972</a></span>
        </div>
    <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
    <script src="../../../../../media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="../../../../../media/js/main.js"></script>
        <script>
         var _hmt = _hmt || [];
         (function() {
             var hm = document.createElement("script");
             hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
         })();
        </script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-4350ea14-e25e-47dc-9c37-c8f0484961a5">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="../../../../../instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
