<!DOCTYPE html>
<html lang="en">
<head>
  <title>Command-line solutions to laptop functions - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="raw" />
  <!-- <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="../../../../../media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="../../../../../years/">Years</a></li>
        <li><a href="../../../../../authors/">Authors</a></li>
        <li><a href="../../../../../tags/">Tags</a></li>
        <li><a href="../../../../../about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Command-line solutions to laptop functions</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#controlling-the-power-key">Controlling the power key</a></li>
<li><a href="#toggling-the-touchpad">Toggling the touchpad</a></li>
<li><a href="#lock-screen">Lock Screen</a></li>
<li><a href="#battery-status">Battery Status</a></li>
<li><a href="#simple-wifi-management">Simple Wifi management</a></li>
<li><a href="#simple-quick-transitions-to-multiple-monitors">Simple Quick Transitions to Multiple Monitors</a></li>
<li><a href="#audio-volume">Audio Volume</a></li>
<li><a href="#screen-brightness">Screen Brightness</a></li>
<li><a href="#screenshot">Screenshot</a></li>
<li><a href="#alt-tab-buffer-swapping">Alt-Tab Buffer-swapping</a></li>
<li><a href="#my-full-setup">My Full Setup</a></li>
</ul>
</div>
</div>
<p>
<b>Edits &amp; Additions:</b>
</p>

<ul class="org-ul">
<li>2018.03.28 I've supplemented the Network section since I now use nm-applet. I also added Alt+Tab buffer swapping and a copy of the exwm portion of my emacs.el.</li>
</ul>

<p>
Trying to make the jump to exwm, which is a similar experience (though considerably less documented) than switching to i3wm, there are a number of core laptop functionalities that the heavier-weight window managers take care of for you. I'm using this on a laptop that is often used that way -- travelling, connecting to multiple different wifi networks daily, connecting to docking stations and extra monitors and devices, toggling touchpad, etc. In my quest to get this figured out, here are some of the major things I've dealt with.
</p>

<div id="outline-container-org058dff4" class="outline-2">
<h2 id="controlling-the-power-key"><a id="org058dff4"></a>Controlling the power key</h2>
<div class="outline-text-2" id="text-controlling-the-power-key">
<p>
The power button isn't handled by the window manager, it's handled by systemd
</p>

<p>
For example this is in my /etc/systemd/logind.conf
</p>

<pre class="example">
[Login]
HandlePowerKey=hibernate
HandleLidSwitch=ignore
IdleAction=suspend
IdleActionSec=20min
</pre>
</div>
</div>

<div id="outline-container-org7db94ea" class="outline-2">
<h2 id="toggling-the-touchpad"><a id="org7db94ea"></a>Toggling the touchpad</h2>
<div class="outline-text-2" id="text-toggling-the-touchpad">
<p>
This was solved by implementing the following shell script:
</p>

<pre class="example">
#!/bin/bash

declare -i ID
ID=`xinput list | grep -Eo 'Touchpad\s*id\=[0-9]{1,2}' | grep -Eo '[0-9]{1,2}'`
declare -i STATE
STATE=`xinput list-props $ID|grep 'Device Enabled'|awk '{print $4}'`
if [ $STATE -eq 1 ]
then
 xinput disable $ID
 echo "Touchpad disabled."
 # notify-send -a 'Touchpad' 'Disabled' -i /usr/share/icons/Adwaita/48x48/devices/input-touchpad.png
else
 xinput enable $ID
 echo "Touchpad enabled."
 # notify-send -a 'Touchpad' 'Enabled' -i /usr/share/icons/Adwaita/48x48/devices/input-touchpad.png
fi
</pre>

<p>
I then bound this to my desired key (since I'm using exwm, I bound it in my emacs.el, with <code>touchpad_toggle</code> being the name of the script I created above):
</p>

<pre class="example">
(exwm-input-set-key (kbd "s-&lt;f7&gt;")
 (lambda () (interactive) 
 (shell-command (executable-find "touchpad_toggle"))))
</pre>
</div>
</div>

<div id="outline-container-org3488316" class="outline-2">
<h2 id="lock-screen"><a id="org3488316"></a>Lock Screen</h2>
<div class="outline-text-2" id="text-lock-screen">
<p>
xscreensaver took care of this. Once I'd installed xscreensaver from my repos -- including the extras to get the gl-slideshow that I wanted as my lockscreen -- I ran <code>xscreensaver-demo</code> to set it up to my desires. Then I created a one-liner that I named <code>lockscreen</code>, and bound it in my emacs file:
</p>

<pre class="example">
#!/bin/bash

xscreensaver-command -lock

(exwm-input-set-key (kbd "s-l") (lambda () (interactive) (shell-command (executable-find "lockscreen"))))
</pre>

<p>
Then it was a matter of also locking on screen shutdown:
<a href="https://unix.stackexchange.com/questions/81692/suspend-and-lock-screen-on-closing-lid-in-arch-systemd">https://unix.stackexchange.com/questions/81692/suspend-and-lock-screen-on-closing-lid-in-arch-systemd</a>
</p>
</div>
</div>

<div id="outline-container-org5ea7dfa" class="outline-2">
<h2 id="battery-status"><a id="org5ea7dfa"></a>Battery Status</h2>
<div class="outline-text-2" id="text-battery-status">
<p>
Simple with fancy-battery mode (it says it is unmaintained, but it works for me from melpa)
</p>

<pre class="example">
(use-package fancy-battery
 :ensure t
 (fancy-battery-mode))
</pre>
</div>
</div>

<div id="outline-container-orgea17dfc" class="outline-2">
<h2 id="simple-wifi-management"><a id="orgea17dfc"></a>Simple Wifi management</h2>
<div class="outline-text-2" id="text-simple-wifi-management">
<p>
nmtui is the simplest, a good text-interface to NetworkManager. The trick was in the fact that it isn't usable in any of the Emacs terminals, wich have been my shell solution for a long while.
</p>

<p>
Abandoning the CLI effort, I have found <code>nm-applet</code> to be good. The icon docks in the bottom of my screen and it has the password-remembering and auto-connecting I had hoped for.
</p>
</div>
</div>

<div id="outline-container-orgb768b00" class="outline-2">
<h2 id="simple-quick-transitions-to-multiple-monitors"><a id="orgb768b00"></a>Simple Quick Transitions to Multiple Monitors</h2>
<div class="outline-text-2" id="text-simple-quick-transitions-to-multiple-monitors">
<p>
When I plug in an external monitor, under KDE it simply connects (though I might have to do some resolution tweaking). In my exwm setup, nothing happens. However, exwm has solutions for this, which go into my emacs.el file:
</p>

<pre class="example">
(require 'exwm-randr)
(setq exwm-randr-workspace-output-plist '(0 "DP-1")) ;; DP-1 being the name of my new monitor as shown by `randr'
(add-hook 'exwm-randr-screen-change-hook
 (lambda ()
 (start-process-shell-command
 "xrandr" nil "xrandr --output DP-1 --left-of eDP-1 --auto"))) ;; eDP-1 being the name of my original (laptop) monitor
(exwm-enable)
(exwm-randr-enable)
</pre>
</div>
</div>

<div id="outline-container-org81765fd" class="outline-2">
<h2 id="audio-volume"><a id="org81765fd"></a>Audio Volume</h2>
<div class="outline-text-2" id="text-audio-volume">
<p>
I was lucky enough that I was already using Alsa for my sound, so didn't even have to install anything. In previous attempts on different devices sound was much harder to deal with. Here I could get it going with nothing but my exwm config.
</p>

<pre class="example">
(exwm-input-set-key (kbd "&lt;XF86AudioLowerVolume&gt;")
 (lambda () (interactive) (shell-command "amixer set Master 5%-")))
(exwm-input-set-key (kbd "&lt;XF86AudioRaiseVolume&gt;")
 (lambda () (interactive) (shell-command "amixer set Master 5%+")))
(exwm-input-set-key (kbd "&lt;XF86AudioMute&gt;")
 (lambda () (interactive) (shell-command "amixer set Master 1+ toggle")))
</pre>
</div>
</div>

<div id="outline-container-orge464984" class="outline-2">
<h2 id="screen-brightness"><a id="orge464984"></a>Screen Brightness</h2>
<div class="outline-text-2" id="text-screen-brightness">
<p>
I have hardware keys that worked wonderfully under kde to dim and brighten my screen. How can I regain this functionality? The answer is in the light package (which works far more easily than xbacklight, which always told me ‘No outputs have backlight property'.
</p>

<p>
<a href="https://github.com/haikarainen/light">https://github.com/haikarainen/light</a>
</p>

<p>
Following the instructions to install, I then set my keys appropriately:
</p>

<pre class="example">
(exwm-input-set-key (kbd "&lt;XF86MonBrightnessDown&gt;") (lambda () (interactive) (shell-command "light -U 5; light")))
(exwm-input-set-key (kbd "&lt;XF86MonBrightnessUp&gt;") (lambda () (interactive) (shell-command "light -A 5; light")))
</pre>
</div>
</div>

<div id="outline-container-orge7e5766" class="outline-2">
<h2 id="screenshot"><a id="orge7e5766"></a>Screenshot</h2>
<div class="outline-text-2" id="text-screenshot">
<p>
The last thing I realized I needed when writing this post was the ability to make a screenshot. My favorite screenshot tool is that which ships with KDE, <b>Spectacle</b>. Since it is already installed for me, I just bound it to my Printscreen key:
</p>

<pre class="example">
(exwm-input-set-key (kbd "&lt;print&gt;") (lambda () (interactive) (start-process-shell-command "spectacle" nil "spectacle")))
</pre>
</div>
</div>

<div id="outline-container-orgc8b1e9b" class="outline-2">
<h2 id="alt-tab-buffer-swapping"><a id="orgc8b1e9b"></a>Alt-Tab Buffer-swapping</h2>
<div class="outline-text-2" id="text-alt-tab-buffer-swapping">
<p>
The library iflipb makes short work of regaining the <code>alt+tab</code> functionality that I work with heavily on every other system. Once it was downloaded, I just set the configuration:
</p>

<pre class="example">
(exwm-input-set-key (kbd "M-&lt;tab&gt;") 'iflipb-next-buffer)
(exwm-input-set-key (kbd "M-&lt;iso-lefttab&gt;") 'iflipb-previous-buffer)
</pre>
</div>
</div>

<div id="outline-container-orgcd1ecae" class="outline-2">
<h2 id="my-full-setup"><a id="orgcd1ecae"></a>My Full Setup</h2>
<div class="outline-text-2" id="text-my-full-setup">
<p>
use-package makes configuration easy and clean. Here's from my emacs.el, which includes a few snippets that I haven't described here:
</p>

<pre class="example">
(use-package exwm
 :ensure t
 :init
 (setq mouse-autoselect-window t
 focus-follows-mouse t)
 (use-package exwm-config)
 (require 'exwm-randr)
 (setq exwm-workspace-show-all-buffers t)
 (setq exwm-layout-show-all-buffers t)
 (setq exwm-randr-workspace-output-plist '(0 "DP1"))
 (add-hook 'exwm-randr-screen-change-hook
 (lambda ()
 (start-process-shell-command
 "xrandr" nil "xrandr --output DP1 --left-of eDP1 --auto")))
 (exwm-enable)
 (exwm-randr-enable) ; https://github.com/ch11ng/exwm/wiki
 (require 'exwm-systemtray)
 (exwm-systemtray-enable)
 :config
 (add-hook 'exwm-update-class-hook
 (lambda () (unless (or (string-prefix-p "sun-awt-X11-" exwm-instance-name) (string= "gimp" exwm-instance-name))
 (exwm-workspace-rename-buffer exwm-class-name))))
 (defun tsa/exwm-rename ()
 (interactive)
 (exwm-workspace-rename-buffer (concat exwm-class-name " : " exwm-title)))
(add-hook 'exwm-update-title-hook 'tsa/exwm-rename)
(setq tsa/default-simulation-keys
 '(
 ;; move
 ([?\C-b] . left)
 ([?\M-b] . C-left)
 ([?\C-f] . right)
 ([?\M-f] . C-right)
 ([?\C-p] . up)
 ([?\C-n] . down)
 ([?\M-&lt;] . C-home)
 ([?\M-&gt;] . C-end)
 ([?\C-a] . home) 
 ([?\C-e] . end) ;; in spreadsheets: C-e C-p - go to top; C-e C-n - go to bottom
 ([?\M-v] . prior)
 ([?\C-v] . next)
 ;; delete
 ([?\C-d] . delete)
 ([?\C-k] . (S-end delete))
 ([?\M-d] . (C-S-right delete))
 ;; cut/copy/paste.
 ;([?\C-w] . ?\C-x)
 ([?\M-w] . ?\C-c)
 ([?\C-y] . ?\C-v)
 ;; search
 ([?\C-s] . ?\C-f)
 ))
(exwm-input-set-simulation-keys tsa/default-simulation-keys)
(exwm-input-set-key (kbd "s-r") 'exwm-reset)
(exwm-input-set-key (kbd "s-n") 'tsa/exwm-rename)
(exwm-input-set-key (kbd "s-N") 'rename-buffer)
(exwm-input-set-key (kbd "s-w") #'exwm-workspace-switch)
(exwm-input-set-key (kbd "s-f")
 (lambda ()
 (interactive)
 (start-process-shell-command "firefox" nil "firefox")))
(exwm-input-set-key (kbd "s-t")
 (lambda ()
 (interactive)
 (start-process-shell-command "Telegram" nil "Telegram")))
(exwm-input-set-key (kbd "s-&lt;f7&gt;") (lambda () (interactive) (shell-command (executable-find "touchpad_toggle"))))
(exwm-input-set-key (kbd "C-c o") 'hydra-global-org/body)
(exwm-input-set-key (kbd "C-M-o") 'hydra-window/body)
(exwm-input-set-key (kbd "s-l") (lambda () (interactive) (shell-command (executable-find "lockscreen"))))
(exwm-input-set-key (kbd "&lt;f8&gt;") 'tsa/go-or-make-agenda)
(exwm-input-set-key (kbd "&lt;f11&gt;") 'helm-org-capture-templates)
(exwm-input-set-key (kbd "&lt;f9&gt;") 'tsa/quick-gnus)
(exwm-input-set-key (kbd "&lt;XF86AudioLowerVolume&gt;") (lambda () (interactive) (shell-command "amixer set Master 2%-")))
(exwm-input-set-key (kbd "&lt;XF86AudioRaiseVolume&gt;") (lambda () (interactive) (shell-command "amixer set Master 2%+")))
(exwm-input-set-key (kbd "&lt;XF86AudioMute&gt;") (lambda () (interactive) (shell-command "amixer set Master 1+ toggle")))
(exwm-input-set-key (kbd "&lt;XF86MonBrightnessDown&gt;") (lambda () (interactive) (shell-command "light -U 5; light")))
(exwm-input-set-key (kbd "&lt;XF86MonBrightnessUp&gt;") (lambda () (interactive) (shell-command "light -A 5; light")))
(exwm-input-set-key (kbd "&lt;print&gt;") (lambda () (interactive) (start-process-shell-command "spectacle" nil "spectacle")))
(exwm-input-set-key (kbd "s-&lt;f9&gt;") (lambda () (interactive) (shell-command "/home/torysa/bin/get-mail &amp;" nil nil)))
(exwm-input-set-key (kbd "M-&lt;tab&gt;") 'iflipb-next-buffer)
(exwm-input-set-key (kbd "M-&lt;iso-lefttab&gt;") 'iflipb-previous-buffer))
</pre>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2018-04-16</span>
            <span title="last modification date" class="post-info">2018-04-16</span>
            <span title="tags" class="post-info">:<a href="../../../../../tags/raw">raw</a>:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T520">lujun9972</a></span>
        </div>
    <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
    <script src="../../../../../media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="../../../../../media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T520">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="../../../../../instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
