<!DOCTYPE html>
<html lang="en">
<head>
  <title>Use org-radiobutton to select an option from a list - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="raw" />
  <!-- <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="https://lujun9972.github.io/emacs-document/media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="https://lujun9972.github.io/emacs-document/">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="https://lujun9972.github.io/emacs-document/years/">Years</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/authors/">Authors</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/tags/">Tags</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="https://lujun9972.github.io/emacs-document/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Use org-radiobutton to select an option from a list</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2f65501"><span class="done DONE">DONE</span> Use org-radiobutton to select an option from a list&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ignore">ignore</span></span></a></li>
</ul>
</div>
</div>

<div id="outline-container-org2f65501" class="outline-2">
<h2 id="org2f65501"><span class="done DONE">DONE</span> Use org-radiobutton to select an option from a list&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ignore">ignore</span></span></h2>
<div class="outline-text-2" id="text-org2f65501">
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">use-package</span> <span style="color: #a45bad;">org-radiobutton</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
Ever since I've come across the <a href="http://howardism.org/Technical/Emacs/literate-devops.html">Literate DevOps</a> article I was hooked
and immediately started writing down "org notebooks" every time an
incident occured along with all the code and steps on how to fix it in
case it might happen in the future (protip: it <i>will</i> happen again).
</p>

<p>
Recently we had some problems with webhook requests behaving weird and
so I created a little notebook to query the mongo database where we
store all the requests and some more functions (ranging from elisp to
jq to ruby) to process the results.  As you sure know, threading data
between code blocks in different languages is painless with <code>org-mode</code>
and babel.
</p>

<p>
So imagine a block like this (using <a href="https://github.com/krisajenkins/ob-mongo">ob-mongo</a>):
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: query</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC mongo :db logs :host localhost :port 27017</span>
db.webhookLogs.find({endpoint: "AddCustomer"}).sort({_id: -1}).limit(1)
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
This gives me the most recent request to the <code>AddCustomer</code> endpoint.
The results of this block are then piped into other code blocks to
process the request, you can imagine how that looks.
</p>

<p>
Usually I run the entire app stack locally but we also have separate
staging and production environments.  So after I run the notebook on
my own local stack I want to try it out in staging.
</p>

<p>
I use <a href="https://github.com/rejeep/prodigy.el">prodigy</a> to manage my ssh tunnels and so all I need to do is
change the port to one pointing to staging and re-run the notebook.
The problem is that I have multiple query blocks and so I have to go
and change all of the <code>:port</code> arguments.
</p>

<p>
I have solved this by creating a block that would work as a source for
the port and then reference it dynamically in the header line:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #9f8766;">#+NAME: port</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC elisp</span>
<span style="color: #a45bad; background-color: #2f2b33;">27017</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+NAME: query</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC mongo :db logs :host localhost :port (org-babel-ref-resolve "port")</span>
db.webhookLogs.find({endpoint: "AddCustomer"}).sort({_id: -1}).limit(1)
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
Since we can call elisp in the header I use <code>org-babel-ref-resolve</code> and
give it the name of the source block and babel will automatically
replace it with the value of the block.
</p>

<p>
This solves the problem of changing the constant at one place but as I
got to work with more environments I tended to forget what port was
what.  So I created a list above the block to remind me of the
available values:
</p>

<div class="org-src-container">
<pre class="src src-org">Use one of the following ports to operate on the given environment:

- <span style="font-weight: bold;">localhost ::</span> 27017
- <span style="font-weight: bold;">staging ::</span> 27004
- <span style="font-weight: bold;">production ::</span> 27005

<span style="color: #9f8766;">#+NAME: port</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC elisp</span>
<span style="color: #a45bad; background-color: #2f2b33;">27017</span>
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>

<span style="color: #9f8766;">#+NAME: query</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC mongo :db logs :host localhost :port (org-babel-ref-resolve "port")</span>
db.webhookLogs.find({endpoint: "AddCustomer"}).sort({_id: -1}).limit(1)
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
We can use the org mode list description syntax <code>foo ::</code> to attach a
label to each item and leave the number as the "value".
</p>

<p>
This is starting to look an awful lot like a list of choices I could
pick from.  So my thinking goes like this: let's make it a checkbox
list and then select the option by checking the option.  The trouble
there is that toggling the input would require me to un-toggle the
current one and then toggle the desired option.  Ideally, toggling one
checkbox would uncheck the other so that there is always exactly one
option selected: in other words, I wanted a radiobutton list.
</p>

<p>
After a quick google session I've found (via <a href="http://irreal.org/blog/?p=4644">Irreal</a>) that <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/10/05/A-checkbox-list-in-org-mode-with-one-value/">John Kitchin</a>
already figured this out.  I took his code and cleaned it up a bit to
work with "modern" org mode (the post is three years old) and packaged
it as <a href="https://github.com/Fuco1/org-radiobutton">org-radiobutton</a>.
</p>

<p>
Now I have a nice menu I can go to and with a single <code>C-c C-c</code> on the
option I want I can select the environment where to run the notebook.
Org mode is so cool!
</p>

<div class="org-src-container">
<pre class="src src-org">Check one of the following ports to operate on the given environment:

<span style="color: #9f8766;">#+attr_org: :radio</span>
<span style="color: #9f8766;">#+NAME: port</span>
- <span style="font-weight: bold;">[ ]</span><span style="font-weight: bold;"> localhost ::</span> 27017
- <span style="font-weight: bold;">[X]</span><span style="font-weight: bold;"> staging ::</span> 27004
- <span style="font-weight: bold;">[ ]</span><span style="font-weight: bold;"> production ::</span> 27005

<span style="color: #9f8766;">#+NAME: query</span>
<span style="color: #827591; background-color: #373040;">#+BEGIN_SRC mongo :db logs :host localhost :port (org-radiobutton-value "port")</span>
db.webhookLogs.find({endpoint: "AddCustomer"}).sort({_id: -1}).limit(1)
<span style="color: #827591; background-color: #373040;">#+END_SRC</span>
</pre>
</div>

<p>
I'm going over all of my notebooks converting all the ugly option
hacks to this setup and it is so damn pleasing! :D
</p>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2018-03-11</span>
            <span title="last modification date" class="post-info">2019-04-26</span>
            <span title="tags" class="post-info">:<a href="https://lujun9972.github.io/emacs-document/tags/raw">raw</a>:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a></span>
        </div>
    <script src="https://lujun9972.github.io/emacs-document/media/js/jquery-2.1.3.min.js"></script>
    <script src="https://lujun9972.github.io/emacs-document/media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="https://lujun9972.github.io/emacs-document/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T430S">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="https://lujun9972.github.io/emacs-document//instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
