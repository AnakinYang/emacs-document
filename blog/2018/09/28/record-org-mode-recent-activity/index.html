<!DOCTYPE html>
<html lang="en">
<head>
  <title>Record Org-mode Recent Activity - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="raw" />
  <!-- <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css"/>
       <link rel="stylesheet" href="../../../../../media/css/comment.css" type="text/css"/> -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <ul class="trigger">
        <li><a href="../../../../../years/">Years</a></li>
        <li><a href="../../../../../authors/">Authors</a></li>
        <li><a href="../../../../../tags/">Tags</a></li>
        <li><a href="../../../../../about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="https://www.bing.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Record Org-mode Recent Activity</h1>
<p>
So I checked the <a href="https://www.notion.so/">notion</a> tool recently. It's pretty good if everyone around use it. But as an emacs user, I still prefer org-mode.
</p>

<p>
It's just there's one functionality I never thought about when I was using org-mode, the ability to record your activity. Like when you reschedule somthing or change the state of tasks.
</p>

<p>
I did some search online and came up with a solution. I'm pretty sure there's better ways to do so. I'll just put the codes here. It leverages the <code>org-agenda-custom-commands</code> and the <code>:LOGBOOK:</code> feature. And the code is mainly from <a href="https://stackoverflow.com/questions/8039416/custom-searches-using-timestamps-in-logbook-in-org-mode">here</a> with some modification.
</p>

<pre class="example">
 ;; enable the log feature
(setq org-log-into-drawer t)
(setq org-log-reschedule 'time)
(setq org-log-redeadline 'note)
(setq org-log-note-clock-out t)

;; add T: before timestamp for easy regex search
(setq org-log-note-headings '((done . "CLOSING NOTE T:%t")
 (state . "State %-12s from %-12S T:%t")
 (note . "Note taken on T:%t")
 (reschedule . "Rescheduled from %S on T:%t")
 (delschedule . "Not scheduled, was %S on T:%t")
 (redeadline . "New deadline from %S on T:%t")
 (deldeadline . "Removed deadline, was %S on T:%t")
 (refile . "Refiled on T:%t")
 (clock-out . "Clocked out on T:%t")))

(defun +org/find-state (&amp;optional end)
 "Used to search through the logbook of subtrees.

 Looking for T:[2018-09-14 Fri 10:50] kind of time stamp in logbook."
 (let* ((closed (re-search-forward "^CLOSED: \\[" end t))
 (created (if (not closed) (re-search-forward "^:CREATED: \\[" end t)))
 (logbook (if (not closed) (re-search-forward ".*T:\\[" end t)))
 (result (or closed logbook created)))
 result))

(defun +org/date-diff (start end &amp;optional compare)
 "Calculate difference between selected timestamp to current date.

 The difference between the dates is calculated in days.
 START and END define the region within which the timestamp is found.
 Optional argument COMPARE allows for comparison to a specific date rather than to current date."
 (let* ((start-date (if compare compare (calendar-current-date))))
 (- (calendar-absolute-from-gregorian start-date) (org-time-string-to-absolute (buffer-substring-no-properties start end)))))

(defun +org/last-update-before (since)
 "List Agenda items that updated before SINCE day."
 (let ((next-headline (save-excursion (or (outline-next-heading) (point-max)))))
 (let* ((subtree-end (save-excursion (org-end-of-subtree t)))
 (subtree-valid (save-excursion
 (forward-line 1)
 (if (and (&lt; (point) subtree-end)
 ;; Find the timestamp to test
 (+org/find-state subtree-end))
 (let ((startpoint (point)))
 (forward-word 3)
 ;; Convert timestamp into days difference from today
 (+org/date-diff startpoint (point)))
 (point-max)))))
 (if (and subtree-valid (&gt;= subtree-valid since))
 next-headline
 nil))))

(defun +org/has-child-and-last-update-before (day)
 (if (+org/has-child-p) (point)
 (+org/last-update-before day))) 

</pre>

<p>
So now we can use the <code>+org/last-update-before</code> or <code>+org/has-child-and-last-update-before</code> function in <code>org-agenda-custom-commands</code> to filter activities updated since <code>SINCE</code> days ago. Like this.
</p>

<pre class="example">
(setq org-agenda-custom-commands
'(("R" "Recent activity"
((tags "*"
((org-agenda-overriding-header "Recent Activity")
(org-agenda-skip-function '(+org/has-child-and-last-update-before 7)))))
nil nil))) 

</pre>

<p>
The code will only search for timestamps in ":LOGBOOK:" prefexd with <code>T:</code> or <code>:CREATED:</code> or <code>:CLOSED</code> timestamps. It works fine and helps me sometimes. Maybe I should write a agenda sort function to let them ordered by changed time. Fine for me right now.
</p>

<p>
UPDATE: 2018-09-24 If anyone intrested in automatically recoding changes of headings, you may want check <a href="https://emacs.stackexchange.com/questions/39348/org-auto-add-update-date-of-last-modification-of-heading-and-or-its-body-to#">this</a> stackoverflow question. The answer gives a method using hash to record last modification time of any changes in headings or even bodys.
</p>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2018-09-28</span>
            <span title="last modification date" class="post-info">2018-09-28</span>
            <span title="tags" class="post-info">:<a href="../../../../../tags/raw">raw</a>:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; T520">lujun9972</a></span>
        </div>
    <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
    <script src="../../../../../media/js/md5.min.js"></script>
        <section>
            <div id="gitalk-container"></div>
            <script type="text/javascript">
             var gitalk = new Gitalk({
                 clientID: 'fdcb5d9da3f4acb4862c',
                 clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
                 repo: 'lujun9972.github.com',
                 owner: 'lujun9972',
                 admin: ['lujun9972'],
                 id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                 distractionFreeMode: false  // Facebook-like distraction free mode
             })
             gitalk.render('gitalk-container')
            </script>
        </section>
    <script src="../../../../../media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T520">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div>
  <!-- https://instant.page/
       Make your site’s pages instant in 1 minute and improve your conversion rate by 1%  -->
  <script src="../../../../../instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
  </body>
</html>
